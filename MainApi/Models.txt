namespace DataAccessLayer.Models.Auth;

public class LoginRequestDto
{
    [Required]
    [Phone]
    public string PhoneNumber { get; set; } = string.Empty;
}

public class VerifyOtpRequestDto
{
    [Required]
    [Phone]
    public string PhoneNumber { get; set; } = string.Empty;

    [Required]
    [Length(4,4)]
    public string Code { get; set; } = string.Empty;
}

public class AuthResponseDto
{
    public string Token { get; set; } = string.Empty;
    public UserProfileDto User { get; set; } = new();
    public DateTime ExpiresAt { get; set; }
    public string RefreshToken { get; set; } = string.Empty;
}

public class UserProfileDto
{
    public int Id { get; set; }
    public string PhoneNumber { get; set; } = string.Empty;
    public DateTime? CreatedAt { get; set; }
}

public class RefreshRequestDto
{
    [Required]
    public string RefreshToken { get; set; } = string.Empty;
}


namespace DataAccessLayer.Models.Auth;

public class TRefreshToken
{
    [Key]
    public int Id { get; set; }
    public int UserId { get; set; }
    public string TokenHash { get; set; } = string.Empty;
    public DateTime ExpiresAt { get; set; }
    public DateTime CreatedAt { get; set; }
    public string CreatedByIp { get; set; } = string.Empty;
    public DateTime? RevokedAt { get; set; }
    public string? ReplacedByTokenHash { get; set; }
    public string? UserAgent { get; set; }
}


namespace DataAccessLayer.Models.Cart;

public class TCartItems
{
    [Key]
    public int Id { get; set; }

    [Required]
    public int CartId { get; set; }

    [Required]
    public int ProductId { get; set; }

    [Required]
    [Range(1, int.MaxValue)]
    public int Quantity { get; set; }

    public virtual TCarts? Cart { get; set; }
    public virtual TProducts? Product { get; set; }
}


namespace DataAccessLayer.Models.Cart;

public class TCarts
{
    [Key]
    public int Id { get; set; }

    [Required]
    public int UserId { get; set; }

    public int TotalItems { get; set; }

    public int TotalPrice { get; set; }

    public virtual TUsers? User { get; set; }

    public virtual ICollection<TCartItems> CartItems { get; set; } = new List<TCartItems>();
}


namespace DataAccessLayer.Models.DTO;

public class AddToCartDto
{
    [Required]
    [Range(1, int.MaxValue, ErrorMessage = "ProductId must be greater than 0")]
    public int ProductId { get; set; }

    [Required]
    [Range(1, int.MaxValue, ErrorMessage = "Quantity must be at least 1")]
    public int Quantity { get; set; } = 1;
}

public class UpdateCartItemDto
{
    [Required]
    [Range(1, int.MaxValue, ErrorMessage = "Quantity must be at least 1")]
    public int Quantity { get; set; }
}

public class CartDto
{
    public int Id { get; set; }
    public int UserId { get; set; }
    public List<CartItemDto> CartItems { get; set; } = new();
    public int TotalItems { get; set; }
    public int TotalPrice { get; set; }
}

public class CartItemDto
{
    public int Id { get; set; }

    [Required]
    public int ProductId { get; set; }

    [Required]
    public string ProductName { get; set; } = string.Empty;

    [Range(0, int.MaxValue)]
    public int SellingPrice { get; set; }

    [Range(1, int.MaxValue)]
    public int Quantity { get; set; }

    public int TotalPrice { get; set; }
}


namespace DataAccessLayer.Models.DTO;

public class CreateOrderDto
{
    public int UserId { get; set; }
    public string? Name { get; set; }
    public string? Address { get; set; }
    public string? PostalCode { get; set; }
    public int OrderStatusId { get; set; }
    public DateTime? DeliveryDate { get; set; }
    public List<CreateOrderItemDto> OrderItems { get; set; } = new();
}

public class UpdateOrderDto
{
    public string? Name { get; set; }
    public string? Address { get; set; }
    public string? PostalCode { get; set; }
    public int? OrderStatusId { get; set; }
    public DateTime? DeliveryDate { get; set; }
}

public class CreateOrderStatusDto
{
    public string? Name { get; set; }
    public string? Icon { get; set; }
}

public class UpdateOrderStatusDto
{
    public int OrderStatusId { get; set; }
    public string? Name { get; set; }
    public string? Icon { get; set; }
}

public class CreateOrderItemDto
{
    public int UserOrderId { get; set; }
    public int ProductId { get; set; }
    public int SellingPrice { get; set; }
    public int Quantity { get; set; }
}

public class UpdateOrderItemDto
{
    public int? SellingPrice { get; set; }
    public int? Quantity { get; set; }
}


namespace DataAccessLayer.Models.DTO;

public class ProductDto
{
    public int Id { get; set; }
    [Required]
    [StringLength(200)]
    public string Name { get; set; }
    public string? Icon { get; set; }
    [Range(0, int.MaxValue)]
    public int? PurchasePrice { get; set; }
    [Range(0, int.MaxValue)]
    public int? SellingPrice { get; set; }
    [Range(0, int.MaxValue)]
    public int? Count { get; set; }
    public int? ProductTypeId { get; set; }
}

public class ProductTypeDto
{
    public int Id { get; set; }
    [Required]
    [StringLength(100)]
    public string Name { get; set; }
    public string? Icon { get; set; }
}

public class ProductSearchDto
{
    public string? Name { get; set; }
    public int? ProductTypeId { get; set; }
    public int? MinPrice { get; set; }
    public int? MaxPrice { get; set; }
    public bool? InStock { get; set; }
    public int Page { get; set; } = 1;
    public int PageSize { get; set; } = 10;
}

public class ProductStockDto
{
    [Required]
    public int ProductId { get; set; }
    [Required]
    [Range(1, int.MaxValue)]
    public int Quantity { get; set; }
    public string? Notes { get; set; }
}


namespace DataAccessLayer.Models.Order;

public class TOrderItems
{
    [Key]
    public int Id { get; set; }
    public virtual TOrders? UserOrder { get; set; }
    public int UserOrderId { get; set; }
    public virtual TProducts? Product { get; set; }
    public int ProductId { get; set; }
    public int PurchasePrice { get; set; }
    public int SellingPrice { get; set; }
    public int Quantity { get; set; }
    public int Amount { get; set; }
    public int Profit { get; set; }
}


namespace DataAccessLayer.Models.Order;

public class TOrders
{
    [Key]
    public int Id { get; set; }

    public virtual TUsers? User { get; set; }
    public int UserId { get; set; }
    public string? Name { get; set; }

    public string? Address { get; set; }
    public string? PostalCode { get; set; }

    public virtual ICollection<TOrderItems> OrderItems 
    { get; set; } = new List<TOrderItems>();

    public int TotalAmount { get; set; }
    public int TotalProfit { get; set; }

    public DateTime CreatedAt { get; set; }
    public DateTime? DeliveryDate { get; set; }

    public virtual TOrderStatus? OrderStatus { get; set; }
    public int OrderStatusId { get; set; }
}


namespace DataAccessLayer.Models.Order;

public class TOrderStatus
{
    public int Id { get; set; }
    public string? Name { get; set; }
    public string? Icon { get; set; }

    public virtual ICollection<TOrders>? Orders { get; set; }
}


namespace DataAccessLayer.Models.Product;

public class TProducts
{
    [Key]
    public int Id { get; set; }

    public string? Name { get; set; }
    public string? Icon { get; set; }

    public int? PurchasePrice { get; set; }
    public int? OriginalPrice { get; set; }

    public int? SellingPrice { get; set; }

    public int? Count { get; set; }

    public virtual TProductTypes? ProductType { get; set; }
    public int? ProductTypeId { get; set; }

    public virtual ICollection<TOrderItems>? OrderDetails { get; set; }

    [Timestamp]
    public byte[]? RowVersion { get; set; }
}


namespace DataAccessLayer.Models.Product;

public class TProductTypes
{
    [Key]
    public int Id { get; set; }

    public string? Name { get; set; }
    public string? Icon { get; set; }

    public virtual ICollection<TProducts>? Products { get; set; }
}


namespace DataAccessLayer.Models.User;

public class TUserOtp
{
    [Key]
    public int Id { get; set; }

    public int UserId { get; set; }
    public virtual TUsers User { get; set; }

    [Required]
    public string OtpHash { get; set; }

    [Required]
    public DateTime ExpiresAt { get; set; }

    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

    public bool IsUsed { get; set; } = false;

    public int AttemptCount { get; set; } = 0;
}


namespace DataAccessLayer.Models.User;

public class TUsers
{
    [Key]
    public int Id { get; set; }

    [Required]
    [Phone]
    public string PhoneNumber { get; set; } = string.Empty;
    public string? FirstName { get; set; }
    public string? LastName { get; set; }

    public DateTime CreatedAt { get; set; }
    public bool IsActive { get; set; } = true;
    public bool IsAdmin { get; set; } = false;

    public virtual ICollection<TOrders> UserOrders 
    { get; set; } = new List<TOrders>();

    public virtual ICollection<TUserOtp> UserOtps { get; set; } = new List<TUserOtp>();

}