import{a as X}from"./chunk-FVWIFECI.js";import{b as J}from"./chunk-N4ILYDNY.js";import{a as H}from"./chunk-U4BXHFS4.js";import"./chunk-HEUSUCDJ.js";import{A as K,G as W,c as D,d as N,e as Q,g as R,h as z,i as G}from"./chunk-QOTKPPKC.js";import{Ab as d,B as P,Bb as I,Ca as a,Cb as f,F as E,K as T,L as U,M as x,Na as v,Nb as p,Ob as _,Qb as B,Sa as V,Xa as s,Yb as O,aa as b,ba as h,ca as $,f as C,gb as l,hb as i,ib as r,j as g,jb as w,n as F,nb as A,ob as q,pb as L,sb as y,tb as m,xb as M,z as S,za as j}from"./chunk-6VZDFBBI.js";import"./chunk-4CLCTAJ7.js";function Y(t,u){t&1&&(i(0,"span"),d(1," / "),r())}function Z(t,u){if(t&1&&(A(0),i(1,"span"),d(2),r(),s(3,Y,2,0,"span",2),q()),t&2){let n=u.$implicit,e=u.last;a(2),I(n.value.displayValue),a(),l("ngIf",!e)}}function ee(t,u){t&1&&(i(0,"span",34),d(1,"add"),r())}function te(t,u){t&1&&(i(0,"span",35),d(1,"sync"),r())}function ie(t,u){t&1&&(i(0,"span",34),d(1,"remove"),r())}function ne(t,u){t&1&&(i(0,"span",35),d(1,"sync"),r())}function re(t,u){t&1&&(i(0,"span",34),d(1,"delete"),r())}function ae(t,u){t&1&&(i(0,"span",35),d(1,"sync"),r())}function de(t,u){if(t&1){let n=L();i(0,"div",17)(1,"div",18),w(2,"img",19),r(),i(3,"div",20)(4,"div",15)(5,"h3",21),d(6),r(),i(7,"p",22),d(8),p(9,"number"),i(10,"span",23),d(11,"\u062A\u0648\u0645\u0627\u0646"),r()()(),i(12,"div",24),s(13,Z,4,2,"ng-container",25),p(14,"keyvalue"),r(),i(15,"p",24),d(16),p(17,"number"),r(),i(18,"div",26)(19,"div",27)(20,"button",28),y("click",function(){let o=b(n).$implicit,c=m(3);return h(c.increaseQuantity(o))}),s(21,ee,2,0,"span",29)(22,te,2,0,"span",30),r(),i(23,"span",31),d(24),r(),i(25,"button",32),y("click",function(){let o=b(n).$implicit,c=m(3);return h(c.decreaseQuantity(o))}),s(26,ie,2,0,"span",29)(27,ne,2,0,"span",30),r()(),i(28,"button",33),y("click",function(){let o=b(n).$implicit,c=m(3);return h(c.removeItem(o))}),s(29,re,2,0,"span",29)(30,ae,2,0,"span",30),r()()()()}if(t&2){let n=u.$implicit,e=m(3);a(2),l("src",e.getProductIcon(n),j)("alt",n.productName),a(4),I(n.productName),a(2),f("",_(9,16,n.totalPrice)," "),a(5),l("ngForOf",_(14,18,n.attributes)),a(3),f("",_(17,20,n.sellingPrice)," \u062A\u0648\u0645\u0627\u0646"),a(4),l("disabled",e.isItemUpdating(n.id)),a(),l("ngIf",!e.isItemUpdating(n.id)),a(),l("ngIf",e.isItemUpdating(n.id)),a(2),I(n.quantity),a(),l("disabled",e.isItemUpdating(n.id)),a(),l("ngIf",!e.isItemUpdating(n.id)),a(),l("ngIf",e.isItemUpdating(n.id)),a(),l("disabled",e.isItemUpdating(n.id)),a(),l("ngIf",!e.isItemUpdating(n.id)),a(),l("ngIf",e.isItemUpdating(n.id))}}function ue(t,u){if(t&1&&(i(0,"div")(1,"h1",5),d(2,"\u0633\u0628\u062F \u062E\u0631\u06CC\u062F \u0634\u0645\u0627"),r(),i(3,"div",6)(4,"div",7)(5,"div",8),s(6,de,31,22,"div",9),r()(),i(7,"div",10)(8,"div",11)(9,"h2",12),d(10,"\u062E\u0644\u0627\u0635\u0647 \u0633\u0641\u0627\u0631\u0634"),r(),i(11,"div",13)(12,"span"),d(13),r(),i(14,"span"),d(15),p(16,"number"),r()(),i(17,"div",14)(18,"div",15)(19,"p"),d(20,"\u0645\u0628\u0644\u063A \u0642\u0627\u0628\u0644 \u067E\u0631\u062F\u0627\u062E\u062A"),r(),i(21,"p"),d(22),p(23,"number"),r()()(),i(24,"a",16),d(25," \u0627\u062F\u0627\u0645\u0647 \u0641\u0631\u0622\u06CC\u0646\u062F \u062E\u0631\u06CC\u062F "),r()()()()()),t&2){let n=m().ngIf;a(6),l("ngForOf",n.cart.cartItems),a(7),f("\u0645\u062C\u0645\u0648\u0639 \u0642\u06CC\u0645\u062A (",n.cart.totalItems," \u06A9\u0627\u0644\u0627)"),a(2),f("",_(16,4,n.cart.totalPrice)," \u062A\u0648\u0645\u0627\u0646"),a(7),f("",_(23,6,n.cart.totalPrice)," \u062A\u0648\u0645\u0627\u0646")}}function oe(t,u){t&1&&(i(0,"div",37)(1,"div",38)(2,"span",39),d(3,"shopping_cart"),r()(),i(4,"h3",40),d(5,"\u0633\u0628\u062F \u062E\u0631\u06CC\u062F \u0634\u0645\u0627 \u062E\u0627\u0644\u06CC \u0627\u0633\u062A"),r(),i(6,"p",41),d(7,"\u0628\u0647 \u0646\u0638\u0631 \u0645\u06CC\u200C\u0631\u0633\u062F \u0647\u0646\u0648\u0632 \u0645\u062D\u0635\u0648\u0644\u06CC \u0628\u0647 \u0633\u0628\u062F \u062E\u0648\u062F \u0627\u0636\u0627\u0641\u0647 \u0646\u06A9\u0631\u062F\u0647\u200C\u0627\u06CC\u062F."),r(),i(8,"a",42),d(9," \u0634\u0631\u0648\u0639 \u062E\u0631\u06CC\u062F "),r()())}function le(t,u){if(t&1&&s(0,oe,10,0,"div",36),t&2){let n=m().ngIf;l("ngIf",!n.isLoading)}}function ce(t,u){t&1&&(i(0,"div",43),$(),i(1,"svg",44),w(2,"circle",45)(3,"path",46),r()())}function se(t,u){if(t&1&&(i(0,"div"),s(1,ue,26,8,"div",3)(2,le,1,1,"ng-template",null,0,B)(4,ce,4,0,"div",4),r()),t&2){let n=u.ngIf,e=M(3);a(),l("ngIf",!n.isLoading&&n.cart&&n.cart.cartItems.length>0)("ngIfElse",e),a(3),l("ngIf",n.isLoading)}}var Ie=(()=>{let u=class u{constructor(e,o,c,k){this.cartService=e,this.notificationService=o,this.mediaService=c,this.cdr=k,this.destroy$=new C,this.quantityUpdate$=new C,this.updatingItems=new Set}ngOnInit(){this.vm$=this.cartService.cart$.pipe(F(e=>({cart:e,isLoading:!1,error:null})),T({cart:this.cartService.currentCartValue,isLoading:!0,error:null}),S(e=>{let o=e?.error?.message||"Failed to load cart.";return this.notificationService.show(o,"error"),g({cart:null,isLoading:!1,error:o})})),this.cartService.getMyCart().pipe(x(this.destroy$)).subscribe(),this.quantityUpdate$.pipe(P(500),U(({item:e,quantity:o})=>{if(!this.lockItem(e.id))return g(null);let c={quantity:o,rowVersion:e.rowVersion};return this.cartService.updateCartItem(e.id,c).pipe(E(()=>this.unlockItem(e.id)),S(k=>g(null)))}),x(this.destroy$)).subscribe()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.updatingItems.clear()}getProductIcon(e){return e.productIcon?this.mediaService.getMediaUrl(e.productIcon):"https://via.placeholder.com/150"}isItemUpdating(e){return this.updatingItems.has(e)}lockItem(e){return this.isItemUpdating(e)?!1:(this.updatingItems.add(e),this.cdr.markForCheck(),!0)}unlockItem(e){this.updatingItems.delete(e),this.cdr.markForCheck()}increaseQuantity(e){this.quantityUpdate$.next({item:e,quantity:e.quantity+1})}decreaseQuantity(e){let o=e.quantity-1;o>0?this.quantityUpdate$.next({item:e,quantity:o}):this.removeItem(e)}removeItem(e){this.lockItem(e.id)&&this.cartService.removeFromCart(e.id).pipe(x(this.destroy$),E(()=>this.unlockItem(e.id))).subscribe({error:o=>{}})}};u.\u0275fac=function(o){return new(o||u)(v(J),v(H),v(X),v(O))},u.\u0275cmp=V({type:u,selectors:[["app-cart-page"]],decls:3,vars:3,consts:[["emptyCart",""],[1,"container","py-8"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["class","flex items-center justify-center min-h-[400px]",4,"ngIf"],[1,"text-3xl","font-bold","tracking-tight","mb-8","text-foreground"],[1,"grid","grid-cols-1","gap-8","md:grid-cols-3"],[1,"md:col-span-2"],[1,"card","divide-y","divide-border"],["class","flex items-start gap-4 p-4",4,"ngFor","ngForOf"],[1,"md:col-span-1"],[1,"card","p-6","space-y-4","sticky","top-24"],[1,"text-lg","font-semibold","text-foreground"],[1,"flex","justify-between","text-sm","text-muted-foreground"],[1,"border-t","border-border","pt-4"],[1,"flex","justify-between","text-base","font-medium","text-foreground"],["routerLink","/checkout",1,"btn","btn-primary","btn-md","w-full"],[1,"flex","items-start","gap-4","p-4"],[1,"h-24","w-24","flex-shrink-0","overflow-hidden","rounded-md","border","border-border"],[1,"h-full","w-full","object-cover","object-center","aspect-square",3,"src","alt"],[1,"flex-1"],[1,"text-foreground","font-semibold"],[1,"ms-4","text-foreground","font-bold"],[1,"text-sm","font-normal"],[1,"mt-1","text-sm","text-muted-foreground"],[4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","mt-4"],[1,"flex","items-center","rounded-md","border","border-input"],["aria-label","\u0627\u0641\u0632\u0627\u06CC\u0634 \u062A\u0639\u062F\u0627\u062F",1,"btn","btn-ghost","h-10","w-10","rounded-r-md","rounded-l-none","border-l","border-input","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["class","material-icons text-base",4,"ngIf"],["class","material-icons animate-spin text-sm",4,"ngIf"],[1,"w-10","text-center","text-sm","font-medium","tabular-nums","text-foreground"],["aria-label","\u06A9\u0627\u0647\u0634 \u062A\u0639\u062F\u0627\u062F",1,"btn","btn-ghost","h-10","w-10","rounded-l-md","rounded-r-none","border-r","border-input","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["type","button",1,"btn","btn-ghost","text-destructive","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"material-icons","text-base"],[1,"material-icons","animate-spin","text-sm"],["class","card flex flex-col items-center justify-center border-2 border-dashed border-border p-12 text-center min-h-[400px]",4,"ngIf"],[1,"card","flex","flex-col","items-center","justify-center","border-2","border-dashed","border-border","p-12","text-center","min-h-[400px]"],[1,"flex","h-20","w-20","items-center","justify-center","rounded-full","bg-muted"],[1,"material-icons","text-4xl","text-muted-foreground"],[1,"mt-6","text-xl","font-semibold","text-foreground"],[1,"mb-6","mt-2","text-sm","text-muted-foreground"],["routerLink","/products",1,"btn","btn-primary","btn-lg"],[1,"flex","items-center","justify-center","min-h-[400px]"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-8","w-8","text-primary"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V4a.5.5 0 01.5.5v3.5a.5.5 0 01-1 0V5.7a7 7 0 00-7 7 .5.5 0 01-1 0z",1,"opacity-75"]],template:function(o,c){o&1&&(i(0,"div",1),s(1,se,5,3,"div",2),p(2,"async"),r()),o&2&&(a(),l("ngIf",_(2,1,c.vm$)))},dependencies:[G,D,N,W,K,Q,z,R],encapsulation:2});let t=u;return t})();export{Ie as CartPage};
