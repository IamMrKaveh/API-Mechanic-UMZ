import{a as E}from"./chunk-VWB6FTBM.js";import{C as q,b as P,c as p,d as U,e as V,f as D,g as M,i as j,m as $,p as L,v as Y,w as G,x as B,y as Z}from"./chunk-34BYHSYA.js";import{b as X}from"./chunk-4HBBO3GX.js";import{a as I}from"./chunk-GRXHOR55.js";import"./chunk-5KULSLMJ.js";import{b as W,d as w,i as A,w as k,y as T}from"./chunk-XC2V2DTE.js";import{Bb as u,Cb as y,D as v,Da as r,Db as b,F as x,L as O,Lb as Q,M as S,Oa as l,Ta as N,Ya as h,aa as z,ba as H,ca as J,f as _,hb as m,ib as t,jb as i,kb as f,qb as K,tb as g,ub as C,w as R,za as F}from"./chunk-YUH66BVO.js";import"./chunk-4CLCTAJ7.js";var me=n=>({"border-destructive focus:ring-destructive":n});function le(n,s){n&1&&(t(0,"span"),u(1,"\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0627\u0644\u0632\u0627\u0645\u06CC \u0627\u0633\u062A"),i())}function ce(n,s){n&1&&(t(0,"span"),u(1,"\u0641\u0631\u0645\u062A \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0635\u062D\u06CC\u062D \u0646\u06CC\u0633\u062A"),i())}function pe(n,s){if(n&1&&(t(0,"div",23),h(1,le,2,0,"span",24)(2,ce,2,0,"span",24),i()),n&2){let c=C();r(),m("ngIf",c.phoneNumber==null||c.phoneNumber.errors==null?null:c.phoneNumber.errors.required),r(),m("ngIf",c.phoneNumber==null||c.phoneNumber.errors==null?null:c.phoneNumber.errors.pattern)}}function de(n,s){n&1&&(t(0,"span",25),u(1,"sync"),i())}var ee=(()=>{let s=class s{constructor(o,a,e,d){this.authService=o,this.router=a,this.notificationService=e,this.route=d,this.destroy$=new _,this.logoUrl="/assets/icons/ledka-icon.jpg",this.title="\u0648\u0631\u0648\u062F | \u062B\u0628\u062A\u200C\u0646\u0627\u0645",this.submitButtonText="\u0648\u0631\u0648\u062F",this.isSubmitting=!1,this.returnUrl="/"}ngOnInit(){this.route.queryParams.pipe(v(1)).subscribe(o=>{this.returnUrl=o.returnUrl||"/"}),this.loginForm=new D({phoneNumber:new M("",[p.required,p.pattern(/^09\d{9}$/)])}),this.isSubmitting=!1}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get phoneNumber(){return this.loginForm.get("phoneNumber")}goBack(){this.router.navigate(["/"])}onSubmit(){if(this.loginForm.invalid||this.isSubmitting){this.loginForm.markAllAsTouched();return}this.isSubmitting=!0;let o=this.loginForm.value.phoneNumber;this.authService.login({phoneNumber:o}).pipe(x(()=>this.isSubmitting=!1),S(this.destroy$)).subscribe({next:()=>{this.router.navigate(["/auth/token"],{queryParams:{phoneNumber:o,returnUrl:this.returnUrl}})},error:a=>{let e=a?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u06A9\u062F. \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.";this.notificationService.show(e,"error")}})}};s.\u0275fac=function(a){return new(a||s)(l(E),l(T),l(I),l(k))},s.\u0275cmp=N({type:s,selectors:[["app-auth-page"]],decls:33,vars:10,consts:[[1,"flex","min-h-screen","items-center","justify-center","bg-muted/40","p-4"],[1,"w-full","max-w-[400px]","animate-fade-in-up"],[1,"card","border-border","shadow-xl"],[1,"flex","flex-col","items-center","p-8","pb-6","text-center","space-y-2"],[1,"mb-6","rounded-2xl","bg-primary/10","p-3","ring-1","ring-primary/20"],["alt","\u0644\u0648\u06AF\u0648",1,"h-12","w-auto",3,"src"],[1,"text-2xl","font-bold","tracking-tight","text-foreground"],[1,"text-sm","text-muted-foreground"],[1,"p-8","pt-0"],[1,"space-y-5",3,"ngSubmit","formGroup"],[1,"space-y-2"],[1,"relative"],["type","tel","id","phone","formControlName","phoneNumber","placeholder","09*********","minlength","11","maxlength","11","inputmode","tel","autocomplete","tel","autofocus","",1,"input","h-12","text-center","text-lg","tracking-widest","transition-all","focus:ring-primary",3,"ngClass"],[1,"absolute","inset-y-0","right-3","flex","items-center","text-muted-foreground"],[1,"material-icons","text-lg"],["class","text-xs font-medium text-destructive text-center animate-pulse",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-lg","w-full","font-bold","shadow-md","transition-transform","active:scale-[0.98]",3,"disabled"],["class","material-icons animate-spin mr-2 text-lg",4,"ngIf"],[1,"border-t","border-border","bg-muted/20","p-6","text-center"],[1,"text-xs","text-muted-foreground","leading-relaxed"],["href","#",1,"font-medium","underline","underline-offset-4","hover:text-primary","transition-colors"],[1,"mt-4","btn","btn-link","btn-sm","text-muted-foreground","hover:text-foreground","no-underline",3,"click"],[1,"material-icons","text-sm","mr-1"],[1,"text-xs","font-medium","text-destructive","text-center","animate-pulse"],[4,"ngIf"],[1,"material-icons","animate-spin","mr-2","text-lg"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),f(5,"img",5),i(),t(6,"h3",6),u(7),i(),t(8,"p",7),u(9," \u0644\u0637\u0641\u0627 \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u062E\u0648\u062F \u0631\u0627 \u0628\u0631\u0627\u06CC \u0648\u0631\u0648\u062F \u06CC\u0627 \u062B\u0628\u062A\u200C\u0646\u0627\u0645 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F "),i()(),t(10,"div",8)(11,"form",9),g("ngSubmit",function(){return e.onSubmit()}),t(12,"div",10)(13,"div",11),f(14,"input",12),t(15,"span",13)(16,"span",14),u(17,"smartphone"),i()()(),h(18,pe,3,2,"div",15),i(),t(19,"button",16),h(20,de,2,0,"span",17),t(21,"span"),u(22),i()()()(),t(23,"div",18)(24,"p",19),u(25," \u0648\u0631\u0648\u062F \u0634\u0645\u0627 \u0628\u0647 \u0645\u0639\u0646\u0627\u06CC \u067E\u0630\u06CC\u0631\u0634 "),t(26,"a",20),u(27,"\u0634\u0631\u0627\u06CC\u0637 \u0648 \u0642\u0648\u0627\u0646\u06CC\u0646"),i(),u(28," \u0641\u0631\u0648\u0634\u06AF\u0627\u0647 \u0627\u0633\u062A. "),i(),t(29,"button",21),g("click",function(){return e.goBack()}),t(30,"span",22),u(31,"arrow_forward"),i(),u(32," \u0628\u0627\u0632\u06AF\u0634\u062A \u0628\u0647 \u062E\u0627\u0646\u0647 "),i()()()()()),a&2&&(r(5),m("src",e.logoUrl,F),r(2),b(" ",e.title," "),r(4),m("formGroup",e.loginForm),r(3),m("ngClass",Q(8,me,(e.phoneNumber==null?null:e.phoneNumber.invalid)&&(e.phoneNumber==null?null:e.phoneNumber.touched))),r(4),m("ngIf",(e.phoneNumber==null?null:e.phoneNumber.invalid)&&((e.phoneNumber==null?null:e.phoneNumber.dirty)||(e.phoneNumber==null?null:e.phoneNumber.touched))),r(),m("disabled",!e.loginForm.valid||e.isSubmitting),r(),m("ngIf",e.isSubmitting),r(2),y(e.isSubmitting?"\u062F\u0631 \u062D\u0627\u0644 \u067E\u0631\u062F\u0627\u0632\u0634...":e.submitButtonText))},dependencies:[A,W,w,q,j,P,U,V,G,B,$,L],encapsulation:2});let n=s;return n})();function he(n,s){if(n&1&&(t(0,"span",20),u(1),i()),n&2){let c=C();r(),b(" ",c.formattedTime," \u0645\u0627\u0646\u062F\u0647 \u062A\u0627 \u062F\u0631\u06CC\u0627\u0641\u062A \u0645\u062C\u062F\u062F \u06A9\u062F ")}}function fe(n,s){if(n&1){let c=K();t(0,"button",21),g("click",function(){z(c);let a=C();return H(a.resendCode())}),u(1," \u062F\u0631\u06CC\u0627\u0641\u062A \u0645\u062C\u062F\u062F \u06A9\u062F "),i()}}function ge(n,s){n&1&&(J(),t(0,"svg",22),f(1,"circle",23)(2,"path",24),i())}var te=(()=>{let s=class s{constructor(o,a,e,d,ie){this.route=o,this.router=a,this.authService=e,this.cartService=d,this.notificationService=ie,this.logoUrl="/assets/icons/ledka-icon.jpg",this.title="\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F",this.descriptionPrefix="\u06A9\u062F \u067E\u06CC\u0627\u0645\u06A9 \u0634\u062F\u0647 \u0628\u0647 \u0634\u0645\u0627\u0631\u0647",this.descriptionSuffix="\u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F.",this.phoneNumber="",this.isSubmitting=!1,this.returnUrl="/",this.destroy$=new _,this.codeLength=6,this.timerDuration=120,this.isTimerActive=!1,this.formattedTime=""}ngOnInit(){this.route.queryParams.pipe(v(1)).subscribe(o=>{this.phoneNumber=o.phoneNumber,this.returnUrl=o.returnUrl||"/",this.phoneNumber||this.router.navigate(["/auth"])}),this.codeForm=new D({verificationCode:new M("",[p.required,p.minLength(this.codeLength),p.maxLength(this.codeLength),p.pattern("^[0-9]*$")])}),this.startTimer()}startTimer(){this.isTimerActive=!0;let o=this.timerDuration;R(1e3).pipe(S(this.destroy$),v(this.timerDuration)).subscribe({next:()=>{o--;let a=Math.floor(o/60),e=o%60;this.formattedTime=`${a.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`},complete:()=>{this.isTimerActive=!1}})}goBack(){this.router.navigate(["/auth"])}submitCode(){if(this.codeForm.invalid)return;this.isSubmitting=!0;let o=this.codeForm.get("verificationCode")?.value;this.authService.verifyOtp({phoneNumber:this.phoneNumber,code:o}).pipe(O(()=>this.cartService.getMyCart()),x(()=>this.isSubmitting=!1),S(this.destroy$)).subscribe({next:()=>{this.notificationService.show("\u0648\u0631\u0648\u062F \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u0627\u0646\u062C\u0627\u0645 \u0634\u062F.","success"),this.router.navigateByUrl(this.returnUrl)},error:a=>{let e=a.status===429?"\u062A\u0639\u062F\u0627\u062F \u062A\u0644\u0627\u0634\u200C\u0647\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u06A9\u062F \u062C\u062F\u06CC\u062F \u062F\u0631\u06CC\u0627\u0641\u062A \u06A9\u0646\u06CC\u062F.":a.error?.message||"\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0646\u0627\u0645\u0639\u062A\u0628\u0631 \u0627\u0633\u062A.";this.notificationService.show(e,"error")}})}resendCode(){this.isTimerActive||(this.isSubmitting=!0,this.authService.login({phoneNumber:this.phoneNumber}).pipe(x(()=>this.isSubmitting=!1)).subscribe({next:()=>{this.notificationService.show("\u06A9\u062F \u062C\u062F\u06CC\u062F \u0627\u0631\u0633\u0627\u0644 \u0634\u062F","success"),this.startTimer()},error:()=>this.notificationService.show("\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u0645\u062C\u062F\u062F \u06A9\u062F","error")}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};s.\u0275fac=function(a){return new(a||s)(l(k),l(T),l(E),l(X),l(I))},s.\u0275cmp=N({type:s,selectors:[["app-token-page"]],decls:28,vars:13,consts:[[1,"flex","min-h-screen","items-center","justify-center","bg-muted","p-4"],[1,"card","w-full","max-w-sm"],[1,"flex","flex-col","p-6","space-y-1"],[1,"flex","justify-between","items-center","mb-4"],["alt","\u0644\u0648\u06AF\u0648",1,"h-10","mx-auto",3,"src"],["aria-label","\u0628\u0627\u0632\u06AF\u0634\u062A",1,"btn","btn-ghost","btn-icon","rounded-full",3,"click"],[1,"material-icons","text-muted-foreground"],[1,"font-semibold","tracking-tight","text-2xl","text-center","text-foreground"],[1,"text-sm","text-muted-foreground","text-center"],[1,"font-bold","text-foreground"],[1,"p-6","pt-0"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"space-y-2"],["for","verificationCode",1,"sr-only"],["type","tel","inputmode","numeric","id","verificationCode","formControlName","verificationCode","pattern","^[0-9]*$","autocomplete","one-time-code","autofocus","","required","",1,"input","h-12","text-2xl","text-center","tracking-[0.5em]",3,"maxlength","minlength"],[1,"text-center","text-sm","h-6"],["class","text-muted-foreground",4,"ngIf"],["type","button","class","btn-link",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-md","w-full",3,"disabled"],["class","animate-spin me-2 h-5 w-5","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",4,"ngIf"],[1,"text-muted-foreground"],["type","button",1,"btn-link",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","me-2","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V4a.5.5 0 01.5.5v3.5a.5.5 0 01-1 0V5.7a7 7 0 00-7 7 .5.5 0 01-1 0z",1,"opacity-75"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),f(4,"img",4),t(5,"button",5),g("click",function(){return e.goBack()}),t(6,"span",6),u(7,"arrow_forward"),i()()(),t(8,"h3",7),u(9),i(),t(10,"p",8),u(11),t(12,"span",9),u(13),i(),u(14),i()(),t(15,"div",10)(16,"form",11),g("ngSubmit",function(){return e.submitCode()}),t(17,"div",12)(18,"label",13),u(19,"\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F"),i(),f(20,"input",14),i(),t(21,"div",15),h(22,he,2,1,"span",16)(23,fe,2,0,"button",17),i(),t(24,"button",18),h(25,ge,3,0,"svg",19),t(26,"span"),u(27),i()()()()()()),a&2&&(r(4),m("src",e.logoUrl,F),r(5),b(" ",e.title," "),r(2),b(" ",e.descriptionPrefix," "),r(2),y(e.phoneNumber),r(),b(" ",e.descriptionSuffix," "),r(2),m("formGroup",e.codeForm),r(4),m("maxlength",e.codeLength)("minlength",e.codeLength),r(2),m("ngIf",e.isTimerActive),r(),m("ngIf",!e.isTimerActive),r(),m("disabled",e.codeForm.invalid||e.isSubmitting),r(),m("ngIf",e.isSubmitting),r(2),y(e.isSubmitting?"\u062F\u0631 \u062D\u0627\u0644 \u062A\u0627\u06CC\u06CC\u062F...":"\u062A\u0627\u06CC\u06CC\u062F \u0648 \u0627\u062F\u0627\u0645\u0647"))},dependencies:[A,w,q,j,P,U,V,Y,G,B,Z,$,L],encapsulation:2});let n=s;return n})();var Te=[{path:"",component:ee},{path:"token",component:te}];export{Te as AUTH_ROUTES};
