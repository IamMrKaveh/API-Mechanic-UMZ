import{a as Me}from"./chunk-ES5H2UWX.js";import{a as he,b as V}from"./chunk-MSKRCVIX.js";import{a as ve,b as te}from"./chunk-227NDQCQ.js";import{a as be}from"./chunk-ML4G76YC.js";import{A as $e,B as Ne,a as ye,b as Ce,d as Ie,e as Se,f as Pe,g as I,i as we,j as Ve,m as Fe,p as Ee,q as ke,r as Ae,s as Te}from"./chunk-6R33SLKE.js";import{b as xe}from"./chunk-H442PVK2.js";import{a as _e}from"./chunk-U4BXHFS4.js";import"./chunk-ISFWZGBK.js";import{G as ee,b as J,c as H,d as K,e as X,h as ge,i as Y,x as Z,z as fe}from"./chunk-QOTKPPKC.js";import{Ab as s,B as G,Bb as w,Ca as c,Cb as C,Db as de,E as oe,F as z,Jb as pe,K as ae,L as T,M as E,Mb as me,N as ue,Na as h,Nb as S,Ob as P,Qb as O,Sa as Q,Xa as g,Yb as q,aa as x,ba as v,ca as ce,db as W,f as j,g as U,gb as p,hb as a,ib as o,j as k,jb as F,n as A,nb as $,o as R,ob as N,pb as y,sb as b,tb as d,xb as M,yb as se,z as B,za as le,zb as D}from"./chunk-6VZDFBBI.js";import{a as L,b as re}from"./chunk-4CLCTAJ7.js";var Re=()=>[1,2,3,4,5,6],Be=(n,u,t)=>({"btn-primary":n,"btn-ghost":u,"cursor-default":t});function Ge(n,u){if(n&1&&(a(0,"option",35),s(1),o()),n&2){let t=u.$implicit;p("value",t.id),c(),w(t.name)}}function ze(n,u){if(n&1&&(a(0,"option",35),s(1),o()),n&2){let t=u.$implicit;p("value",t.id),c(),w(t.name)}}function Qe(n,u){if(n&1&&(a(0,"div")(1,"label",36),s(2,"\u06AF\u0631\u0648\u0647 \u062F\u0633\u062A\u0647\u200C\u0628\u0646\u062F\u06CC"),o(),a(3,"select",37)(4,"option",12),s(5,"\u0647\u0645\u0647 \u06AF\u0631\u0648\u0647\u200C\u0647\u0627"),o(),g(6,ze,2,2,"option",13),o()()),n&2){let t=u.ngIf;c(4),p("ngValue",null),c(2),p("ngForOf",t)}}function We(n,u){if(n&1){let t=y();a(0,"button",38),b("click",function(){let i=x(t).$implicit,r=d();return v(r.setSort(i.value))}),s(1),o()}if(n&2){let t,e,i=u.$implicit,r=d();D("bg-accent",((t=r.searchForm.get("sortBy"))==null?null:t.value)===i.value)("text-accent-foreground",((e=r.searchForm.get("sortBy"))==null?null:e.value)===i.value),c(),C(" ",i.label," ")}}function qe(n,u){if(n&1&&(a(0,"div",29),s(1),o()),n&2){let t=u.ngIf;c(),de(" \u0646\u0645\u0627\u06CC\u0634 ",t.items.length," \u0627\u0632 ",t.totalItems," \u06A9\u0627\u0644\u0627 ")}}function Je(n,u){if(n&1&&F(0,"app-product-card",42),n&2){let t=u.$implicit;p("product",t)}}function He(n,u){if(n&1&&(a(0,"div",40),g(1,Je,1,1,"app-product-card",41),o()),n&2){let t=d().ngIf;c(),p("ngForOf",t)}}function Ke(n,u){if(n&1){let t=y();a(0,"div",43)(1,"div",44)(2,"span",45),s(3,"search_off"),o()(),a(4,"h3",46),s(5,"\u0645\u062D\u0635\u0648\u0644\u06CC \u06CC\u0627\u0641\u062A \u0646\u0634\u062F"),o(),a(6,"p",47),s(7,"\u0628\u0627 \u0627\u06CC\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627 \u0645\u062D\u0635\u0648\u0644\u06CC \u067E\u06CC\u062F\u0627 \u0646\u06A9\u0631\u062F\u06CC\u0645. \u0641\u06CC\u0644\u062A\u0631\u0647\u0627 \u0631\u0627 \u062A\u063A\u06CC\u06CC\u0631 \u062F\u0647\u06CC\u062F. "),o(),a(8,"button",48),b("click",function(){x(t);let i=d(2);return v(i.clearFilters())}),s(9,"\u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627"),o()()}}function Xe(n,u){if(n&1&&($(0),g(1,He,2,1,"div",39)(2,Ke,10,0,"ng-template",null,1,O),N()),n&2){let t=u.ngIf,e=M(3);c(),p("ngIf",t.length>0)("ngIfElse",e)}}function Ye(n,u){n&1&&(a(0,"div",50)(1,"div",51),F(2,"div",52)(3,"div",53)(4,"div",54),o()())}function Ze(n,u){n&1&&(a(0,"div",40),g(1,Ye,5,0,"div",49),o()),n&2&&(c(),p("ngForOf",pe(1,Re)))}function et(n,u){if(n&1){let t=y();$(0),a(1,"button",62),b("click",function(){let i=x(t).$implicit,r=d(3);return v(r.onPageNumberClick(i))}),s(2),o(),N()}if(n&2){let t=u.$implicit,e=d(2).ngIf;c(),p("disabled",t==="...")("ngClass",me(4,Be,e.page===t,e.page!==t&&t!=="...",t==="...")),W("aria-current",e.page===t?"page":null),c(),C(" ",t," ")}}function tt(n,u){if(n&1){let t=y();a(0,"nav",57)(1,"button",58),b("click",function(){x(t);let i=d().ngIf,r=d();return v(r.onPageChange(i.page-1))}),a(2,"span",59),s(3,"chevron_right"),o()(),g(4,et,3,8,"ng-container",60),a(5,"button",61),b("click",function(){x(t);let i=d().ngIf,r=d();return v(r.onPageChange(i.page+1))}),a(6,"span",59),s(7,"chevron_left"),o()()()}if(n&2){let t=d().ngIf,e=d();c(),p("disabled",t.page===1),c(3),p("ngForOf",e.getPages(t.totalPages,t.page)),c(),p("disabled",t.page===t.totalPages)}}function it(n,u){if(n&1&&(a(0,"div",55),g(1,tt,8,3,"nav",56),o()),n&2){let t=u.ngIf;c(),p("ngIf",t&&t.totalPages>1)}}var ne=(()=>{let u=class u{constructor(e,i,r,l,m,f){this.productService=e,this.categoryService=i,this.categoryGroupService=r,this.cdr=l,this.route=m,this.router=f,this.destroy$=new j,this.paginatedResultSubject=new U(null),this.paginatedResult$=this.paginatedResultSubject.asObservable(),this.sortOptions=[{label:"\u062C\u062F\u06CC\u062F\u062A\u0631\u06CC\u0646",value:V.newest},{label:"\u0642\u062F\u06CC\u0645\u06CC\u200C\u062A\u0631\u06CC\u0646",value:V.oldest},{label:"\u0627\u0631\u0632\u0627\u0646\u200C\u062A\u0631\u06CC\u0646",value:V.priceAsc},{label:"\u06AF\u0631\u0627\u0646\u200C\u062A\u0631\u06CC\u0646",value:V.priceDesc},{label:"\u0628\u06CC\u0634\u062A\u0631\u06CC\u0646 \u062A\u062E\u0641\u06CC\u0641",value:V.discountDesc}],this.searchForm=new Pe({name:new I(null),minPrice:new I(null),maxPrice:new I(null),inStock:new I(null),hasDiscount:new I(null),isUnlimited:new I(null),categoryId:new I(null),categoryGroupId:new I(null),sortBy:new I(V.newest),page:new I(1),pageSize:new I(12)}),this.products$=this.paginatedResult$.pipe(A(_=>_?.items??[])),this.categories$=this.categoryService.getCategories(void 0,1,50).pipe(A(_=>_.items??[])),this.categoryGroups$=this.searchForm.get("categoryId").valueChanges.pipe(ae(this.searchForm.get("categoryId").value),T(_=>_?this.categoryGroupService.getCategoryGroups(_,void 0,1,100).pipe(A(ie=>ie.items)):k(null)))}ngOnInit(){R([this.route.params,this.route.queryParams]).pipe(E(this.destroy$)).subscribe(([e,i])=>{let r=e.groupId?Number(e.groupId):null,l={name:i.name||null,minPrice:i.minPrice?Number(i.minPrice):null,maxPrice:i.maxPrice?Number(i.maxPrice):null,inStock:i.inStock==="true"?!0:null,hasDiscount:i.hasDiscount==="true"?!0:null,categoryId:i.categoryId?Number(i.categoryId):null,categoryGroupId:r||(i.categoryGroupId?Number(i.categoryGroupId):null),sortBy:i.sortBy||V.newest,page:i.page?Number(i.page):1,pageSize:i.pageSize?Number(i.pageSize):12};this.searchForm.patchValue(l,{emitEvent:!1}),this.loadProducts(this.searchForm.value).subscribe(m=>{this.paginatedResultSubject.next(m)})}),this.searchForm.valueChanges.pipe(G(400),oe((e,i)=>JSON.stringify(e)===JSON.stringify(i)),ue(e=>this.updateUrl(e)),T(e=>this.loadProducts(e)),E(this.destroy$)).subscribe(e=>{this.paginatedResultSubject.next(e),this.cdr.markForCheck()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateUrl(e){let i={},r=this.route.snapshot.paramMap.get("groupId");Object.keys(e).forEach(m=>{let f=e[m];if(!(m==="categoryGroupId"&&r&&f==r)&&f!==null&&f!==""&&f!==void 0&&f!==!1){if(m==="page"&&f===1||m==="pageSize"&&f===12||m==="sortBy"&&f===V.newest)return;i[m]=f}});let l=this.searchForm.value.categoryGroupId&&!r?["/products","category-group",this.searchForm.value.categoryGroupId]:["/products"];this.router.navigate(l,{queryParams:i,replaceUrl:!0})}loadProducts(e){let i={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let l=e[r];l!==null&&l!==""&&l!==void 0&&l!==!1&&(i[r]=l)}return this.productService.getProducts(i)}onPageChange(e){this.searchForm.patchValue({page:e})}setSort(e){this.searchForm.patchValue({sortBy:e,page:1})}getPages(e,i){if(e<=7)return Array.from({length:e},(_,ie)=>ie+1);let r=[],l=1,m=i-1-l,f=e-i-l;r.push(1),m>1&&r.push("...");for(let _=Math.max(2,i-l);_<=Math.min(e-1,i+l);_++)r.push(_);return f>1&&r.push("..."),r.push(e),r}onPageNumberClick(e){typeof e=="number"&&this.onPageChange(e)}toggleInStock(){let e=this.searchForm.get("inStock");e&&e.setValue(e.value?null:!0)}clearFilters(){this.searchForm.reset({sortBy:V.newest,page:1,pageSize:12}),this.router.navigate(["/products"])}};u.\u0275fac=function(i){return new(i||u)(h(te),h(ve),h(Me),h(q),h(Z),h(fe))},u.\u0275cmp=Q({type:u,selectors:[["app-product-list-page"]],decls:53,vars:20,consts:[["loadingState",""],["noProducts",""],[1,"container","py-8"],[1,"grid","grid-cols-1","items-start","gap-8","md:grid-cols-4"],[1,"md:col-span-1","md:sticky","top-24"],[1,"card","p-6","space-y-6",3,"formGroup"],[1,"text-xl","font-semibold","text-foreground"],[1,"space-y-4"],["for","name",1,"text-sm","font-medium","text-foreground"],["type","text","id","name","formControlName","name","placeholder","\u062C\u0633\u062A\u062C\u0648\u06CC \u0645\u062D\u0635\u0648\u0644...",1,"input","mt-2"],["for","category",1,"text-sm","font-medium","text-foreground"],["id","category","formControlName","categoryId",1,"input","mt-2"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"text-sm","font-medium","text-foreground"],[1,"mt-2","grid","grid-cols-2","gap-2"],["type","number","formControlName","minPrice","placeholder","\u062D\u062F\u0627\u0642\u0644",1,"input"],["type","number","formControlName","maxPrice","placeholder","\u062D\u062F\u0627\u06A9\u062B\u0631",1,"input"],[1,"space-y-3","border-t","border-border","pt-4"],[1,"flex","items-center"],["type","checkbox","id","in-stock",1,"h-4","w-4","shrink-0","rounded-sm","border-primary","text-primary","ring-offset-background","focus:ring-2","focus:ring-primary","focus:ring-offset-2",3,"change","checked"],["for","in-stock",1,"mr-3","text-sm","font-medium","text-foreground","cursor-pointer"],["type","checkbox","formControlName","hasDiscount","id","has-discount",1,"h-4","w-4","shrink-0","rounded-sm","border-primary","text-primary","ring-offset-background","focus:ring-2","focus:ring-primary","focus:ring-offset-2"],["for","has-discount",1,"mr-3","text-sm","font-medium","text-foreground","cursor-pointer"],["type","button",1,"btn","btn-outline","w-full",3,"click"],[1,"md:col-span-3"],[1,"card","flex","flex-col","sm:flex-row","items-center","justify-between","p-4","mb-6","gap-4"],[1,"flex","items-center","gap-2","overflow-x-auto","pb-2","sm:pb-0"],[1,"text-sm","text-muted-foreground","whitespace-nowrap"],[1,"flex","items-center","gap-1"],["class","btn btn-ghost btn-sm",3,"bg-accent","text-accent-foreground","click",4,"ngFor","ngForOf"],["class","text-sm text-muted-foreground whitespace-nowrap",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","mt-8 flex justify-center",4,"ngIf"],[3,"value"],["for","categoryGroup",1,"text-sm","font-medium","text-foreground"],["id","categoryGroup","formControlName","categoryGroupId",1,"input","mt-2"],[1,"btn","btn-ghost","btn-sm",3,"click"],["class","grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","gap-4"],[3,"product",4,"ngFor","ngForOf"],[3,"product"],[1,"card","flex","flex-col","items-center","justify-center","border-2","border-dashed","border-border","p-12","text-center","min-h-[400px]"],[1,"flex","h-20","w-20","items-center","justify-center","rounded-full","bg-muted"],[1,"material-icons","text-4xl","text-muted-foreground"],[1,"mt-6","text-xl","font-semibold","text-foreground"],[1,"mb-6","mt-2","text-sm","text-muted-foreground"],[1,"btn","btn-primary","btn-lg",3,"click"],["class","card p-4",4,"ngFor","ngForOf"],[1,"card","p-4"],[1,"animate-pulse"],[1,"bg-muted","aspect-square","w-full","rounded-md"],[1,"mt-4","h-4","w-3/4","rounded","bg-muted"],[1,"mt-2","h-6","w-1/2","rounded","bg-muted"],[1,"mt-8","flex","justify-center"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2"],["aria-label","\u0635\u0641\u062D\u0647 \u0642\u0628\u0644",1,"btn","btn-outline","btn-icon",3,"click","disabled"],[1,"material-icons"],[4,"ngFor","ngForOf"],["aria-label","\u0635\u0641\u062D\u0647 \u0628\u0639\u062F",1,"btn","btn-outline","btn-icon",3,"click","disabled"],[1,"btn","btn-icon",3,"click","disabled","ngClass"]],template:function(i,r){if(i&1){let l=y();a(0,"div",2)(1,"div",3)(2,"aside",4)(3,"form",5)(4,"h3",6),s(5,"\u0641\u06CC\u0644\u062A\u0631\u0647\u0627"),o(),a(6,"div",7)(7,"div")(8,"label",8),s(9,"\u0646\u0627\u0645 \u0645\u062D\u0635\u0648\u0644"),o(),F(10,"input",9),o(),a(11,"div")(12,"label",10),s(13,"\u062F\u0633\u062A\u0647\u200C\u0628\u0646\u062F\u06CC"),o(),a(14,"select",11)(15,"option",12),s(16,"\u0647\u0645\u0647 \u062F\u0633\u062A\u0647\u200C\u0647\u0627"),o(),g(17,Ge,2,2,"option",13),S(18,"async"),o()(),g(19,Qe,7,2,"div",14),S(20,"async"),a(21,"div")(22,"label",15),s(23,"\u0645\u062D\u062F\u0648\u062F\u0647 \u0642\u06CC\u0645\u062A"),o(),a(24,"div",16),F(25,"input",17)(26,"input",18),o()(),a(27,"div",19)(28,"div",20)(29,"input",21),b("change",function(){return x(l),v(r.toggleInStock())}),o(),a(30,"label",22),s(31,"\u0641\u0642\u0637 \u06A9\u0627\u0644\u0627\u0647\u0627\u06CC \u0645\u0648\u062C\u0648\u062F"),o()(),a(32,"div",20),F(33,"input",23),a(34,"label",24),s(35,"\u0641\u0642\u0637 \u0645\u062D\u0635\u0648\u0644\u0627\u062A \u062A\u062E\u0641\u06CC\u0641\u200C\u062F\u0627\u0631"),o()()()(),a(36,"button",25),b("click",function(){return x(l),v(r.clearFilters())}),s(37,"\u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627"),o()()(),a(38,"main",26)(39,"div",27)(40,"div",28)(41,"span",29),s(42,"\u0645\u0631\u062A\u0628\u200C\u0633\u0627\u0632\u06CC:"),o(),a(43,"div",30),g(44,We,2,5,"button",31),o()(),g(45,qe,2,2,"div",32),S(46,"async"),o(),g(47,Xe,4,2,"ng-container",33),S(48,"async"),g(49,Ze,2,2,"ng-template",null,0,O)(51,it,2,1,"div",34),S(52,"async"),o()()()}if(i&2){let l,m=M(50);c(3),p("formGroup",r.searchForm),c(12),p("ngValue",null),c(2),p("ngForOf",P(18,10,r.categories$)),c(2),p("ngIf",P(20,12,r.categoryGroups$)),c(10),p("checked",(l=r.searchForm.get("inStock"))==null?null:l.value),c(15),p("ngForOf",r.sortOptions),c(),p("ngIf",P(46,14,r.paginatedResult$)),c(2),p("ngIf",P(48,16,r.products$))("ngIfElse",m),c(4),p("ngIf",P(52,18,r.paginatedResult$))}},dependencies:[Y,J,H,K,ee,Ne,we,Ae,Te,Ce,Ve,ye,ke,Ie,Se,Fe,Ee,he,X],encapsulation:2});let n=u;return n})();function nt(n,u){if(n&1&&(a(0,"div",28)(1,"p",29),s(2),S(3,"number"),o(),a(4,"span",30),s(5),o()()),n&2){let t=d(2).ngIf,e=d();c(2),C(" ",P(3,2,t.selectedVariant==null?null:t.selectedVariant.originalPrice)," "),c(3),C(" ",e.getDiscountPercentage(t.selectedVariant),"% ")}}function rt(n,u){if(n&1){let t=y();a(0,"button",37),b("click",function(){let i=x(t).$implicit,r=d(2).$implicit,l=d(3);return v(l.selectAttribute(r.name,i.id))}),o()}if(n&2){let t=u.$implicit,e=d(2).$implicit,i=d(2).ngIf;se("background-color",t.hexCode),D("ring-2",i.selectedAttributes[e.name]===t.id)("ring-primary",i.selectedAttributes[e.name]===t.id)("ring-offset-2",i.selectedAttributes[e.name]===t.id)("ring-offset-background",i.selectedAttributes[e.name]===t.id),W("aria-label","\u0627\u0646\u062A\u062E\u0627\u0628 \u0631\u0646\u06AF "+t.displayValue)("aria-pressed",i.selectedAttributes[e.name]===t.id)}}function ot(n,u){if(n&1&&(a(0,"div",35),g(1,rt,1,12,"button",36),o()),n&2){let t=d().$implicit;c(),p("ngForOf",t.values)}}function at(n,u){if(n&1){let t=y();a(0,"button",39),b("click",function(){let i=x(t).$implicit,r=d(2).$implicit,l=d(3);return v(l.selectAttribute(r.name,i.id))}),s(1),o()}if(n&2){let t=u.$implicit,e=d(2).$implicit,i=d(2).ngIf;D("bg-primary",i.selectedAttributes[e.name]===t.id)("text-primary-foreground",i.selectedAttributes[e.name]===t.id)("btn-outline",i.selectedAttributes[e.name]!==t.id),c(),C(" ",t.displayValue," ")}}function ut(n,u){if(n&1&&(a(0,"div",35),g(1,at,2,7,"button",38),o()),n&2){let t=d().$implicit;c(),p("ngForOf",t.values)}}function ct(n,u){if(n&1&&(a(0,"div",31)(1,"h3",32),s(2),a(3,"span",33),s(4),o()(),g(5,ot,2,1,"div",34)(6,ut,2,1,"div",34),o()),n&2){let t=u.$implicit,e=d(2).ngIf;c(2),C("",t.displayName,": "),c(2),w(e.selectedVariant==null||e.selectedVariant.attributes==null||e.selectedVariant.attributes[t.name]==null?null:e.selectedVariant.attributes[t.name].displayValue),c(),p("ngIf",t.name==="color"),c(),p("ngIf",t.name!=="color")}}function lt(n,u){if(n&1&&(a(0,"span",45),s(1),o()),n&2){let t=d(3).ngIf;c(),C(" \u0645\u0648\u062C\u0648\u062F\u06CC \u0627\u0646\u0628\u0627\u0631: ",t.selectedVariant.stock," ")}}function st(n,u){if(n&1){let t=y();a(0,"div",40)(1,"span",32),s(2,"\u062A\u0639\u062F\u0627\u062F \u062F\u0631 \u0633\u0628\u062F:"),o(),a(3,"div",41)(4,"button",42),b("click",function(){x(t);let i=d(2).ngIf,r=d();return v(r.decreaseQuantity(i.cartItem))}),s(5,"\u2212"),o(),a(6,"span",43),s(7),o(),a(8,"button",42),b("click",function(){x(t);let i=d(2).ngIf,r=d();return v(r.increaseQuantity(i.cartItem,i.product,i.selectedVariant))}),s(9,"+"),o()(),g(10,lt,2,1,"span",44),o()}if(n&2){let t=d(2).ngIf,e=d();c(4),p("disabled",t.isUpdatingCart),c(3),w(t.cartItem.quantity),c(),p("disabled",t.isUpdatingCart||!e.isStockAvailableForIncrease(t.selectedVariant,t.cartItem)),c(2),p("ngIf",!t.selectedVariant.isUnlimited)}}function dt(n,u){if(n&1&&($(0),a(1,"span",48),s(2,"add_shopping_cart"),o(),a(3,"span"),s(4),o(),N()),n&2){let t=d(3).ngIf,e=d();c(4),w(e.isInStock(t.selectedVariant)?"\u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F":"\u0646\u0627\u0645\u0648\u062C\u0648\u062F")}}function pt(n,u){if(n&1){let t=y();a(0,"div")(1,"button",46),b("click",function(){x(t);let i=d(2).ngIf,r=d();return v(r.addToCart(i.product,i.selectedVariant))}),g(2,dt,5,1,"ng-container",47),o()()}if(n&2){let t=d(2).ngIf,e=d(),i=M(6);c(),p("disabled",t.isUpdatingCart||!e.isInStock(t.selectedVariant)||!t.selectedVariant),c(),p("ngIf",!t.isUpdatingCart)("ngIfElse",i)}}function mt(n,u){if(n&1&&(a(0,"div",49),s(1),o()),n&2){let t=d(2).ngIf;c(),w(t.error)}}function gt(n,u){if(n&1&&(a(0,"div",6)(1,"div",7)(2,"div",8),F(3,"img",9),o()(),a(4,"div",10)(5,"div",11)(6,"div",12)(7,"h1",13),s(8),o(),a(9,"button",14)(10,"span",15),s(11,"favorite_border"),o()()(),a(12,"div",16)(13,"p",17),s(14),S(15,"number"),a(16,"span",18),s(17,"\u062A\u0648\u0645\u0627\u0646"),o()(),g(18,nt,6,4,"div",19),o(),a(19,"div",20)(20,"span",21),s(21),o(),a(22,"span"),s(23),o()()(),a(24,"div",22),g(25,ct,7,4,"div",23),o(),a(26,"div",24),g(27,st,11,4,"div",25)(28,pt,3,3,"div",26)(29,mt,2,1,"div",27),o()()()),n&2){let t=d().ngIf,e=d();c(3),p("src",e.getProductIcon(t.product),le)("alt",t.product.name),c(5),w(t.product.name),c(6),C(" ",P(15,12,(t.selectedVariant==null?null:t.selectedVariant.sellingPrice)||t.product.minPrice)," "),c(4),p("ngIf",e.hasDiscount(t.selectedVariant)),c(),p("ngClass",e.isInStock(t.selectedVariant)?"text-success":"text-destructive"),c(2),C(" ",e.isInStock(t.selectedVariant)?"check_circle":"cancel"," "),c(2),C(" ",t.selectedVariant!=null&&t.selectedVariant.isUnlimited?"\u0645\u0648\u062C\u0648\u062F\u06CC \u0646\u0627\u0645\u062D\u062F\u0648\u062F":e.isInStock(t.selectedVariant)?"\u062F\u0631 \u0627\u0646\u0628\u0627\u0631 \u0645\u0648\u062C\u0648\u062F \u0627\u0633\u062A":"\u0646\u0627\u0645\u0648\u062C\u0648\u062F"," "),c(2),p("ngForOf",e.attributeTypes),c(2),p("ngIf",t.cartItem&&t.selectedVariant),c(),p("ngIf",!t.cartItem),c(),p("ngIf",t.error)}}function ft(n,u){if(n&1&&(a(0,"div",4),g(1,gt,30,14,"div",5),o()),n&2){let t=u.ngIf;c(),p("ngIf",t.product&&!t.isLoading)}}function _t(n,u){n&1&&(a(0,"div",52),ce(),a(1,"svg",53),F(2,"circle",54)(3,"path",55),o()())}function xt(n,u){if(n&1){let t=y();a(0,"div",56)(1,"span",57),s(2,"error_outline"),o(),a(3,"h2",58),s(4,"\u062E\u0637\u0627 \u062F\u0631 \u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0645\u062D\u0635\u0648\u0644"),o(),a(5,"p",59),s(6),o(),a(7,"button",60),b("click",function(){x(t);let i=d(3);return v(i.reloadProduct())}),s(8,"\u062A\u0644\u0627\u0634 \u0645\u062C\u062F\u062F"),o()()}if(n&2){let t=d().ngIf;c(6),w(t.error)}}function vt(n,u){if(n&1&&($(0),g(1,_t,4,0,"div",50)(2,xt,9,1,"div",51),N()),n&2){let t=u.ngIf;c(),p("ngIf",t.isLoading),c(),p("ngIf",!t.isLoading&&t.error)}}function bt(n,u){if(n&1&&(g(0,vt,3,2,"ng-container",26),S(1,"async")),n&2){let t=d();p("ngIf",P(1,1,t.vm$))}}function ht(n,u){n&1&&(a(0,"span",61),s(1,"sync"),o())}var Oe=(()=>{let u=class u{constructor(e,i,r,l,m,f){this.route=e,this.productService=i,this.cartService=r,this.notificationService=l,this.mediaService=m,this.cdr=f,this.destroy$=new j,this.quantityUpdate$=new j,this.state={product:null,selectedVariant:null,selectedAttributes:{},cartItem:null,isLoading:!0,isUpdatingCart:!1,error:null},this.attributeTypes=[]}ngOnInit(){this.vm$=new U(this.state),R([this.route.paramMap,this.cartService.cart$]).pipe(T(([e,i])=>(this.id=e.get("id"),this.updateViewModel({isLoading:!0}),this.productService.getProductById(Number(this.id)).pipe(A(r=>({product:r,cart:i})),B(r=>{let l=r?.error?.message||"\u0645\u062D\u0635\u0648\u0644 \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F.";return this.updateViewModel({isLoading:!1,error:l}),k(null)})))),E(this.destroy$)).subscribe(e=>{if(e){let{product:i,cart:r}=e;this.extractAttributes(i);let l={};this.attributeTypes.forEach(_=>{l[_.name]=_.values[0]?.id||null});let m=this.findVariant(i,l),f=m&&r?.cartItems.find(_=>_.variantId===m.id)||null;this.updateViewModel({product:i,selectedVariant:m,selectedAttributes:l,cartItem:f,isLoading:!1,error:null})}}),this.quantityUpdate$.pipe(G(500),T(({item:e,quantity:i})=>(this.updateViewModel({isUpdatingCart:!0}),this.cartService.updateCartItem(e.id,{quantity:i,rowVersion:e.rowVersion}).pipe(z(()=>this.updateViewModel({isUpdatingCart:!1})),B(()=>k(null))))),E(this.destroy$)).subscribe()}updateViewModel(e){this.state=L(L({},this.state),e),this.vm$.next(this.state),this.cdr.markForCheck()}extractAttributes(e){let i=new Map;e.variants.forEach(r=>{for(let l in r.attributes){let m=r.attributes[l];i.has(m.typeName)||i.set(m.typeName,{id:0,name:m.typeName,displayName:m.typeDisplayName,values:[]});let f=i.get(m.typeName);f.values.some(_=>_.id===m.id)||f.values.push({id:m.id,value:m.value,displayValue:m.displayValue,hexCode:m.hexCode})}}),this.attributeTypes=Array.from(i.values())}findVariant(e,i){return e.variants.find(r=>Object.keys(i).every(l=>{let m=i[l];return m===null?!0:r.attributes[l]?.id===m}))||e.variants[0]||null}selectAttribute(e,i){let r=re(L({},this.state.selectedAttributes),{[e]:i}),l=this.findVariant(this.state.product,r),m=l&&this.cartService.currentCartValue?.cartItems.find(f=>f.variantId===l.id)||null;this.updateViewModel({selectedAttributes:r,selectedVariant:l,cartItem:m})}getProductIcon(e){let r=e.images?.find(l=>l.isPrimary)?.url||e.iconUrl||e.images?.[0]?.url;return this.mediaService.getMediaUrl(r)}hasDiscount(e){return!!e&&e.originalPrice>e.sellingPrice}getDiscountPercentage(e){return e?Math.round((e.originalPrice-e.sellingPrice)/e.originalPrice*100):0}isInStock(e){return!!e&&(e.isUnlimited||e.stock>0)}isStockAvailableForIncrease(e,i){return e.isUnlimited?!0:i?e.stock>i.quantity:e.stock>0}addToCart(e,i){this.updateViewModel({isUpdatingCart:!0});let r=i.rowVersion||i.RowVersion;this.cartService.addToCart({variantId:i.id,quantity:1,variantRowVersion:r}).pipe(z(()=>this.updateViewModel({isUpdatingCart:!1}))).subscribe({error:l=>{l.status===409?(this.notificationService.show("\u0645\u0648\u062C\u0648\u062F\u06CC \u06CC\u0627 \u0642\u06CC\u0645\u062A \u0645\u062D\u0635\u0648\u0644 \u062A\u063A\u06CC\u06CC\u0631 \u06A9\u0631\u062F\u0647 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.","info"),this.reloadProduct()):this.notificationService.show(l?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F","error")}})}increaseQuantity(e,i,r){this.isStockAvailableForIncrease(r,e)&&this.quantityUpdate$.next({item:e,quantity:e.quantity+1})}decreaseQuantity(e){e.quantity>1?this.quantityUpdate$.next({item:e,quantity:e.quantity-1}):(this.updateViewModel({isUpdatingCart:!0}),this.cartService.removeFromCart(e.id).pipe(z(()=>this.updateViewModel({isUpdatingCart:!1}))).subscribe())}reloadProduct(){this.updateViewModel({isLoading:!0,error:null}),this.productService.getProductById(Number(this.id)).pipe(E(this.destroy$),B(e=>{let i=e?.error?.message||"\u0645\u062D\u0635\u0648\u0644 \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F.";return this.updateViewModel({isLoading:!1,error:i}),k(null)})).subscribe(e=>{if(e){let i=this.cartService.currentCartValue;this.extractAttributes(e);let r=this.findVariant(e,this.state.selectedAttributes),l=r&&i?.cartItems.find(m=>m.variantId===r.id)||null;this.updateViewModel({product:e,selectedVariant:r,cartItem:l,isLoading:!1})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};u.\u0275fac=function(i){return new(i||u)(h(Z),h(te),h(xe),h(_e),h(be),h(q))},u.\u0275cmp=Q({type:u,selectors:[["app-product-page"]],inputs:{id:"id"},decls:7,vars:4,consts:[["loadingOrError",""],["spinnerIcon",""],[1,"bg-background"],["class","container mx-auto px-4 py-10",4,"ngIf","ngIfElse"],[1,"container","mx-auto","px-4","py-10"],["class","grid gap-10 grid-cols-1 md:grid-cols-2",4,"ngIf"],[1,"grid","gap-10","grid-cols-1","md:grid-cols-2"],[1,"flex","flex-col","gap-6"],[1,"aspect-square","w-full","overflow-hidden","rounded-2xl","border","border-border","bg-muted/50","shadow-sm"],[1,"h-full","w-full","object-contain","transition-transform","duration-300","hover:scale-105",3,"src","alt"],[1,"space-y-8"],[1,"space-y-4","border-b","border-border","pb-6"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-extrabold","text-foreground"],["aria-label","\u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0639\u0644\u0627\u0642\u0647\u200C\u0645\u0646\u062F\u06CC\u200C\u0647\u0627",1,"btn","btn-ghost","btn-icon","rounded-full"],[1,"material-icons-outlined","text-muted-foreground"],[1,"flex","items-baseline","gap-4"],[1,"text-3xl","font-bold","text-foreground"],[1,"text-lg","font-normal"],["class","flex items-center gap-2",4,"ngIf"],[1,"flex","items-center","gap-2","text-sm",3,"ngClass"],[1,"material-icons-outlined","text-base"],[1,"space-y-6"],["class","space-y-3",4,"ngFor","ngForOf"],[1,"border-t","border-border","pt-6","space-y-4"],["class","flex items-center gap-4",4,"ngIf"],[4,"ngIf"],["class","text-destructive text-sm mt-2",4,"ngIf"],[1,"flex","items-center","gap-2"],[1,"text-xl","text-muted-foreground","line-through"],[1,"px-2","py-1","bg-destructive","text-destructive-foreground","text-sm","font-bold","rounded-full"],[1,"space-y-3"],[1,"text-sm","font-medium","text-foreground"],[1,"font-bold"],["class","flex flex-wrap gap-3",4,"ngIf"],[1,"flex","flex-wrap","gap-3"],["class","w-8 h-8 rounded-full cursor-pointer border-2 border-border transition-all duration-200 focus:outline-none",3,"ring-2","ring-primary","ring-offset-2","ring-offset-background","backgroundColor","click",4,"ngFor","ngForOf"],[1,"w-8","h-8","rounded-full","cursor-pointer","border-2","border-border","transition-all","duration-200","focus:outline-none",3,"click"],["class","btn btn-md text-base px-4 py-2",3,"bg-primary","text-primary-foreground","btn-outline","click",4,"ngFor","ngForOf"],[1,"btn","btn-md","text-base","px-4","py-2",3,"click"],[1,"flex","items-center","gap-4"],[1,"flex","items-center","border","border-input","rounded-md","overflow-hidden"],[1,"w-10","h-10","flex","items-center","justify-center","hover:bg-accent","text-xl","font-bold","disabled:opacity-50",3,"click","disabled"],[1,"w-12","text-center","text-base","font-medium","text-foreground"],["class","text-xs text-muted-foreground",4,"ngIf"],[1,"text-xs","text-muted-foreground"],["aria-label","\u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F",1,"btn","btn-primary","btn-lg","w-full","max-w-xs","font-semibold","text-base","flex","items-center","justify-center","gap-2",3,"click","disabled"],[4,"ngIf","ngIfElse"],[1,"material-icons"],[1,"text-destructive","text-sm","mt-2"],["class","flex justify-center items-center h-[60vh]",4,"ngIf"],["class","flex flex-col items-center justify-center h-[60vh] text-center px-4",4,"ngIf"],[1,"flex","justify-center","items-center","h-[60vh]"],["viewBox","0 0 24 24",1,"animate-spin","h-10","w-10","text-primary"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8v8z",1,"opacity-75"],[1,"flex","flex-col","items-center","justify-center","h-[60vh]","text-center","px-4"],[1,"material-icons","text-6xl","text-destructive","mb-4"],[1,"text-2xl","font-bold","text-foreground","mb-2"],[1,"text-muted-foreground","mb-6"],[1,"btn","btn-primary",3,"click"],[1,"material-icons","animate-spin"]],template:function(i,r){if(i&1&&(a(0,"div",2),g(1,ft,2,1,"div",3),S(2,"async"),o(),g(3,bt,2,3,"ng-template",null,0,O)(5,ht,2,0,"ng-template",null,1,O)),i&2){let l=M(4);c(),p("ngIf",P(2,2,r.vm$))("ngIfElse",l)}},dependencies:[Y,J,H,K,ee,$e,X,ge],encapsulation:2});let n=u;return n})();var zt=[{path:"",component:ne},{path:"category-group/:groupId",component:ne},{path:":id",component:Oe}];export{zt as PRODUCTS_ROUTES};
