import{a as Ne}from"./chunk-T5AJRVWH.js";import{a as ii}from"./chunk-C4USK2LC.js";import{c as de,d as G,f as O,g as Xe,h as W}from"./chunk-CJPLD6EO.js";import{a as ni,b as $e,d as Ve,e as ri,f as oi,g as oe,i as ai,j as si,m as li,p as ci,q as ui,r as di,s as mi,t as pi,v as hi,y as fi,z as je}from"./chunk-BAR23WDL.js";import{a as gi}from"./chunk-INUD7PLR.js";import{a as Q}from"./chunk-GAYMAGXT.js";import{b as he}from"./chunk-KL5Q5BU5.js";import{a as q}from"./chunk-NKWORGOE.js";import{a as J}from"./chunk-WNMS36QR.js";import{A as Xt,B as Zt,C as Jt,D as ei,E as ti,F as B,b as Fe,c as Oe,d as jt,g as ue,h as Y,i as zt,j as Ut,l as Ae,m as Ht,n as Ke,o as Se,p as Bt,q as qt,r as Gt,s as Wt,t as Yt,u as Le,v as Qt,w as De,x as Kt,y as X,z as Z}from"./chunk-PMZJQWMM.js";import{$a as kt,A as ve,Ab as ie,B as st,Bb as ne,C as se,Cb as Rt,D as Te,Db as x,Eb as Pt,G as lt,Hb as h,Ib as Ft,J as We,Jb as u,M as te,Ma as ce,N as w,Na as Pe,Nb as Ot,O as R,Oa as Ie,Ob as Lt,P as ct,Pb as Dt,Q as ut,Qa as bt,Ra as pe,Rb as Nt,Sa as c,Sb as z,T as V,Ub as l,Vb as F,W as dt,Wa as St,Wb as b,X as H,Y as v,Ya as wt,Z as mt,Za as Et,_a as S,ba as _,bc as ye,ca as C,cc as Ye,d as N,da as pt,db as k,e as me,ea as ht,ec as Qe,fa as ft,ga as gt,gb as Mt,gc as $,h as A,hc as K,i as E,ic as be,ja as _t,ka as Ct,la as vt,lb as Tt,lc as re,m as ge,na as j,oa as xt,oc as $t,pb as It,pc as Vt,qb as m,rb as At,sb as p,t as ae,tb as M,u as _e,ua as xe,ub as T,v as ot,vb as I,w as at,wb as y,x as Ce,xb as o,y as P,ya as le,yb as a,za as yt,zb as g}from"./chunk-OU7FPMWK.js";import{a as D,b as fe}from"./chunk-4CLCTAJ7.js";var _i=(()=>{class t{constructor(){this.requestRecords=new Map,this.penalties=new Map,this.stats={totalRequests:0,allowedRequests:0,deniedRequests:0},typeof window<"u"&&(this.cleanupInterval=window.setInterval(()=>{this.cleanup()},300*1e3))}checkLimit(e,i){this.stats.totalRequests++;let n=Date.now(),s=this.penalties.get(e);if(s&&n<s.until)return this.stats.deniedRequests++,!1;s&&n>=s.until&&this.penalties.delete(e);let f=(this.requestRecords.get(e)||[]).filter(ee=>n-ee.timestamp<i.timeWindowMs);return f.reduce((ee,ke)=>ee+ke.count,0)>=i.maxRequests?(this.stats.deniedRequests++,i.penaltyMs&&this.penalties.set(e,{until:n+i.penaltyMs,reason:`Exceeded ${i.maxRequests} requests in ${i.timeWindowMs}ms`}),!1):(f.push({timestamp:n,count:1}),this.requestRecords.set(e,f),this.stats.allowedRequests++,!0)}getStats(e,i){let n=Date.now(),f=(this.requestRecords.get(e)||[]).filter(Me=>n-Me.timestamp<i.timeWindowMs).reduce((Me,Re)=>Me+Re.count,0),U=f>=i.maxRequests,ee=this.penalties.get(e),ke=ee&&n<ee.until?ee.until:void 0;return{totalRequests:this.stats.totalRequests,allowedRequests:this.stats.allowedRequests,deniedRequests:this.stats.deniedRequests,currentWindowRequests:f,isLimited:U,penaltyUntil:ke}}getTimeUntilReset(e,i){let n=Date.now(),s=this.penalties.get(e);if(s&&n<s.until)return s.until-n;let d=this.requestRecords.get(e)||[];if(d.length===0)return 0;let U=d[0].timestamp+i.timeWindowMs;return Math.max(0,U-n)}clear(e){this.requestRecords.delete(e),this.penalties.delete(e)}clearAll(){this.requestRecords.clear(),this.penalties.clear(),this.stats={totalRequests:0,allowedRequests:0,deniedRequests:0}}cleanup(){let e=Date.now(),i=3600*1e3;this.requestRecords.forEach((n,s)=>{let d=n.filter(f=>e-f.timestamp<i);d.length===0?this.requestRecords.delete(s):d.length!==n.length&&this.requestRecords.set(s,d)}),this.penalties.forEach((n,s)=>{e>=n.until&&this.penalties.delete(s)})}resetStats(){this.stats={totalRequests:0,allowedRequests:0,deniedRequests:0}}getGlobalStats(){return D({},this.stats)}destroy(){this.cleanupInterval&&clearInterval(this.cleanupInterval),this.clearAll()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=V({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Ze={SEARCH:{maxRequests:60,timeWindowMs:60*1e3},API_PUBLIC:{maxRequests:60,timeWindowMs:60*1e3},API_RESTRICTED:{maxRequests:10,timeWindowMs:60*1e3,penaltyMs:300*1e3},LOGIN:{maxRequests:5,timeWindowMs:900*1e3,penaltyMs:1800*1e3},CART_ADD:{maxRequests:30,timeWindowMs:60*1e3},REVIEW_CREATE:{maxRequests:3,timeWindowMs:3600*1e3}};var ze=class{constructor(r){this.cache=new Map,this.stats={hits:0,misses:0,evictions:0,totalMemoryBytes:0},this.config=D({maxSize:100,ttlMs:300*1e3,strategy:"LRU",enableStats:!0,maxMemoryBytes:10*1024*1024},r)}get(r){let e=this.cache.get(r);if(!e)return this.stats.misses++,null;let i=Date.now();return i-e.timestamp>this.config.ttlMs?(this.cache.delete(r),this.stats.misses++,this.updateMemoryUsage(-1*(e.size||0)),null):(e.lastAccess=i,e.accessCount++,this.stats.hits++,e.data)}set(r,e){let i=this.cache.get(r);i&&this.updateMemoryUsage(-1*(i.size||0));let n=this.estimateSize(e);this.config.maxMemoryBytes&&this.stats.totalMemoryBytes+n>this.config.maxMemoryBytes&&this.evictUntilSpace(n),this.cache.size>=this.config.maxSize&&this.evict();let s=Date.now();this.cache.set(r,{data:e,timestamp:s,accessCount:0,lastAccess:s,size:n}),this.updateMemoryUsage(n)}has(r){return this.cache.has(r)&&this.get(r)!==null}delete(r){let e=this.cache.get(r);return e?(this.updateMemoryUsage(-1*(e.size||0)),this.cache.delete(r)):!1}evict(){switch(this.config.strategy){case"LRU":this.evictLRU();break;case"LFU":this.evictLFU();break;case"FIFO":this.evictFIFO();break}this.stats.evictions++}evictLRU(){let r=null,e=1/0;this.cache.forEach((i,n)=>{i.lastAccess<e&&(e=i.lastAccess,r=n)}),r&&this.delete(r)}evictLFU(){let r=null,e=1/0;this.cache.forEach((i,n)=>{i.accessCount<e&&(e=i.accessCount,r=n)}),r&&this.delete(r)}evictFIFO(){let r=null,e=1/0;this.cache.forEach((i,n)=>{i.timestamp<e&&(e=i.timestamp,r=n)}),r&&this.delete(r)}evictUntilSpace(r){let e=this.config.maxMemoryBytes-r;for(;this.stats.totalMemoryBytes>e&&this.cache.size>0;)this.evict()}clear(){this.cache.clear(),this.stats={hits:0,misses:0,evictions:0,totalMemoryBytes:0}}size(){return this.cache.size}keys(){return Array.from(this.cache.keys())}getStats(){let r=this.stats.hits+this.stats.misses,e=r>0?this.stats.hits/r:0,i,n;return this.cache.forEach(s=>{(!i||s.timestamp<i)&&(i=s.timestamp),(!n||s.timestamp>n)&&(n=s.timestamp)}),{hits:this.stats.hits,misses:this.stats.misses,hitRate:e,size:this.cache.size,memoryUsage:this.stats.totalMemoryBytes,oldestEntry:i,newestEntry:n}}cleanup(){let r=Date.now(),e=[];this.cache.forEach((i,n)=>{r-i.timestamp>this.config.ttlMs&&e.push(n)}),e.forEach(i=>this.delete(i))}estimateSize(r){if(r==null)return 0;try{return JSON.stringify(r).length*2}catch(e){return 1024}}updateMemoryUsage(r){this.stats.totalMemoryBytes=Math.max(0,this.stats.totalMemoryBytes+r)}resetStats(){this.stats.hits=0,this.stats.misses=0,this.stats.evictions=0}updateConfig(r){for(this.config=D(D({},this.config),r);this.cache.size>this.config.maxSize;)this.evict();if(this.config.maxMemoryBytes)for(;this.stats.totalMemoryBytes>this.config.maxMemoryBytes;)this.evict()}forEach(r){this.cache.forEach(r)}};var Ue=(()=>{class t{constructor(){this.http=v(Se),this.rateLimiter=v(_i),this.API_URL=`${J.API_URL}Search`,this.CACHE_TTL=120*1e3,this.DEBOUNCE_TIME=300,this.cache=new ze({maxSize:100,ttlMs:this.CACHE_TTL,strategy:"LRU",enableStats:!0}),this.searchStateSubject=new me({isSearching:!1,error:null}),this.searchState$=this.searchStateSubject.asObservable()}searchGlobal(e){if(typeof navigator<"u"&&!navigator.onLine)return E(()=>new Error("\u0627\u062A\u0635\u0627\u0644 \u0627\u06CC\u0646\u062A\u0631\u0646\u062A \u0628\u0631\u0642\u0631\u0627\u0631 \u0646\u06CC\u0633\u062A."));if(!e||e.trim().length<2)return A({categories:[],categoryGroups:[],products:[],query:""});if(!this.rateLimiter.checkLimit("search",Ze.SEARCH))return E(()=>new Error("\u062A\u0639\u062F\u0627\u062F \u062F\u0631\u062E\u0648\u0627\u0633\u062A\u200C\u0647\u0627\u06CC \u0634\u0645\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627\u064B \u06A9\u0645\u06CC \u0635\u0628\u0631 \u06A9\u0646\u06CC\u062F."));let i=this.normalizePersianChars(e.trim()),n=`global:${i}`;if(this.isCacheValid(n)){let d=this.cache.get(n);if(d)return A(d.data)}this.setSearching(!0),this.setError(null);let s=new Ae().set("q",i);return this.http.get(`${this.API_URL}/global`,{params:s}).pipe(R(d=>this.setCache(n,d)),P(d=>(this.cache.delete(n),this.setError(this.getErrorMessage(d)),A({categories:[],categoryGroups:[],products:[],query:""}))),Te(()=>this.setSearching(!1)),We(1))}searchProducts(e){if(typeof navigator<"u"&&!navigator.onLine)return E(()=>new Error("\u0627\u062A\u0635\u0627\u0644 \u0627\u06CC\u0646\u062A\u0631\u0646\u062A \u0628\u0631\u0642\u0631\u0627\u0631 \u0646\u06CC\u0633\u062A."));if(!this.rateLimiter.checkLimit("search",Ze.SEARCH))return E(()=>new Error("\u062A\u0639\u062F\u0627\u062F \u062F\u0631\u062E\u0648\u0627\u0633\u062A\u200C\u0647\u0627\u06CC \u0634\u0645\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627\u064B \u06A9\u0645\u06CC \u0635\u0628\u0631 \u06A9\u0646\u06CC\u062F."));let i=`products:${JSON.stringify(e)}`;if(this.isCacheValid(i)){let s=this.cache.get(i);if(s)return A(s.data)}this.setSearching(!0),this.setError(null);let n=new Ae;return e.q&&(n=n.set("q",this.normalizePersianChars(e.q.trim()))),e.categoryId&&(n=n.set("categoryId",e.categoryId.toString())),e.categoryGroupId&&(n=n.set("categoryGroupId",e.categoryGroupId.toString())),e.minPrice!==void 0&&(n=n.set("minPrice",e.minPrice.toString())),e.maxPrice!==void 0&&(n=n.set("maxPrice",e.maxPrice.toString())),e.inStockOnly!==void 0&&(n=n.set("inStockOnly",e.inStockOnly.toString())),e.brand&&(n=n.set("brand",e.brand)),e.page&&(n=n.set("page",e.page.toString())),e.pageSize&&(n=n.set("pageSize",e.pageSize.toString())),e.sortBy&&(n=n.set("sortBy",e.sortBy)),this.http.get(`${this.API_URL}/products`,{params:n}).pipe(lt({count:3,delay:(s,d)=>{if(s.status&&s.status>=400&&s.status<500)return E(()=>s);let f=Math.min(1e3*Math.pow(2,d),1e4);return console.log(`Retrying request... Attempt ${d} after ${f}ms`),_e(f)}}),R(s=>this.setCache(i,s)),P(s=>(this.cache.delete(i),this.setError(this.getErrorMessage(s)),E(()=>s))),Te(()=>this.setSearching(!1)),We(1))}getSearchSuggestions(e){return e.pipe(ve(this.DEBOUNCE_TIME),se(),te(i=>!i||i.trim().length<2?A({categories:[],categoryGroups:[],products:[],query:""}):this.searchGlobal(i).pipe(P(n=>(this.setError(n.message||"\u062E\u0637\u0627 \u062F\u0631 \u062C\u0633\u062A\u062C\u0648"),A({categories:[],categoryGroups:[],products:[],query:""}))))))}clearCache(){this.cache.clear()}clearError(){this.setError(null)}setSearching(e){let i=this.searchStateSubject.value;this.searchStateSubject.next(fe(D({},i),{isSearching:e}))}setError(e){let i=this.searchStateSubject.value;this.searchStateSubject.next(fe(D({},i),{error:e}))}isCacheValid(e){let i=this.cache.get(e);return i?Date.now()-i.timestamp<this.CACHE_TTL:!1}setCache(e,i){this.cache.set(e,{data:i,timestamp:Date.now()})}normalizePersianChars(e){return e?e.replace(/ي/g,"\u06CC").replace(/ك/g,"\u06A9").replace(/ى/g,"\u06CC").replace(/٤/g,"\u06F4").replace(/٥/g,"\u06F5").replace(/٦/g,"\u06F6"):""}getErrorMessage(e){return e?.error?.message?e.error.message:e?.message?e.message:"\u062E\u0637\u0627\u06CC\u06CC \u062F\u0631 \u062C\u0633\u062A\u062C\u0648 \u0631\u062E \u062F\u0627\u062F. \u0644\u0637\u0641\u0627\u064B \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F."}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=V({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var we=(()=>{class t{constructor(e){this.sanitizer=e,this.DEFAULT_CONFIG={maxLength:100,minLength:1,allowedPattern:/^[\u0600-\u06FFa-zA-Z0-9\s\-_.()]+$/,dangerousChars:/<|>|script|javascript|onerror|onclick|onload|eval|expression/gi}}validateSearchQuery(e,i={}){let n=D(D({},this.DEFAULT_CONFIG),i),s=[];if(e==null)return{isValid:!1,sanitizedValue:"",errors:["\u062C\u0633\u062A\u062C\u0648 \u0646\u0645\u06CC\u200C\u062A\u0648\u0627\u0646\u062F \u062E\u0627\u0644\u06CC \u0628\u0627\u0634\u062F"]};let f=this.normalizePersianChars(String(e)).trim();if(f.length===0)return{isValid:!1,sanitizedValue:"",errors:["\u0644\u0637\u0641\u0627 \u0639\u0628\u0627\u0631\u062A\u06CC \u0628\u0631\u0627\u06CC \u062C\u0633\u062A\u062C\u0648 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F"]};if(f.length<n.minLength&&s.push(`\u062D\u062F\u0627\u0642\u0644 ${n.minLength} \u06A9\u0627\u0631\u0627\u06A9\u062A\u0631 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F`),f.length>n.maxLength&&s.push(`\u062D\u062F\u0627\u06A9\u062B\u0631 ${n.maxLength} \u06A9\u0627\u0631\u0627\u06A9\u062A\u0631 \u0645\u062C\u0627\u0632 \u0627\u0633\u062A`),n.allowedPattern.test(f)||s.push("\u0641\u0642\u0637 \u062D\u0631\u0648\u0641\u060C \u0627\u0639\u062F\u0627\u062F \u0648 \u0628\u0631\u062E\u06CC \u06A9\u0627\u0631\u0627\u06A9\u062A\u0631\u0647\u0627\u06CC \u062E\u0627\u0635 \u0645\u062C\u0627\u0632 \u0647\u0633\u062A\u0646\u062F"),n.dangerousChars.test(f))return s.push("\u06A9\u0627\u0631\u0627\u06A9\u062A\u0631\u0647\u0627\u06CC \u063A\u06CC\u0631\u0645\u062C\u0627\u0632 \u0634\u0646\u0627\u0633\u0627\u06CC\u06CC \u0634\u062F"),{isValid:!1,sanitizedValue:"",errors:s};let U=this.sanitizer.sanitize(ce.HTML,f)||"";return U!==f&&f.includes("<")?(s.push("\u0645\u062D\u062A\u0648\u0627\u06CC HTML \u0645\u062C\u0627\u0632 \u0646\u06CC\u0633\u062A"),{isValid:!1,sanitizedValue:"",errors:s}):{isValid:s.length===0,sanitizedValue:U,errors:s.length>0?s:void 0}}validateNumericParam(e,i,n){let s=Number(e);return isNaN(s)||!isFinite(s)?null:i!==void 0&&s<i?i:n!==void 0&&s>n?n:Math.floor(s)}validateBooleanParam(e){return e==="true"||e===!0||e===1?!0:e==="false"||e===!1||e===0?!1:null}sanitizeUrlParams(e){let i={};for(let[n,s]of Object.entries(e)){if(s==null)continue;let d=this.sanitizer.sanitize(ce.HTML,String(n))||"";if(d)if(typeof s=="string"){let f=this.sanitizer.sanitize(ce.HTML,s);f&&(i[d]=f)}else(typeof s=="number"||typeof s=="boolean")&&(i[d]=s)}return i}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}normalizePersianChars(e){return e?e.replace(/ي/g,"\u06CC").replace(/ك/g,"\u06A9").replace(/ى/g,"\u06CC").replace(/٤/g,"\u06F4").replace(/٥/g,"\u06F5").replace(/٦/g,"\u06F6"):""}static{this.\u0275fac=function(i){return new(i||t)(H(Le))}}static{this.\u0275prov=V({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Hi=()=>[];function Bi(t,r){if(t&1){let e=x();o(0,"div",1)(1,"span",33),l(2),a(),o(3,"button",34),h("click",function(){_(e);let n=u();return C(n.retryLastSearch())}),o(4,"span",35),l(5,"refresh"),a(),l(6," \u062A\u0644\u0627\u0634 \u0645\u062C\u062F\u062F "),a()()}if(t&2){let e=u();c(2),F(e.error())}}function qi(t,r){if(t&1&&(o(0,"span",5),l(1),a()),t&2){let e=u();c(),b(' \u0628\u0631\u0627\u06CC "',e.currentQuery(),'" ')}}function Gi(t,r){if(t&1&&(o(0,"p",6),l(1),a()),t&2){let e=u();c(),b(" ",e.searchResults().total," \u0645\u062D\u0635\u0648\u0644 \u06CC\u0627\u0641\u062A \u0634\u062F ")}}function Wi(t,r){if(t&1&&(o(0,"option",22),l(1),a()),t&2){let e=r.$implicit;y("value",e.value),c(),b(" ",e.label," ")}}function Yi(t,r){t&1&&(o(0,"div",31)(1,"div",36),g(2,"span",37),o(3,"p",38),l(4,"\u062F\u0631 \u062D\u0627\u0644 \u062C\u0633\u062A\u062C\u0648..."),a()()())}function Qi(t,r){if(t&1){let e=x();o(0,"div",32)(1,"span",39),l(2,"error_outline"),a(),o(3,"h3",40),l(4,"\u062E\u0637\u0627 \u062F\u0631 \u062C\u0633\u062A\u062C\u0648"),a(),o(5,"p",6),l(6),a(),o(7,"button",41),h("click",function(){_(e);let n=u();return C(n.retryLastSearch())}),l(8," \u062A\u0644\u0627\u0634 \u0645\u062C\u062F\u062F "),a()()}if(t&2){let e=u();c(6),F(e.error())}}function Ki(t,r){if(t&1){let e=x();o(0,"div",32)(1,"span",42),l(2,"search_off"),a(),o(3,"h3",40),l(4,"\u0646\u062A\u06CC\u062C\u0647\u200C\u0627\u06CC \u06CC\u0627\u0641\u062A \u0646\u0634\u062F"),a(),o(5,"p",43),l(6," \u0645\u062A\u0623\u0633\u0641\u0627\u0646\u0647 \u0645\u062D\u0635\u0648\u0644\u06CC \u0628\u0627 \u0627\u06CC\u0646 \u0645\u0634\u062E\u0635\u0627\u062A \u067E\u06CC\u062F\u0627 \u0646\u0634\u062F. "),g(7,"br"),l(8," \u0644\u0637\u0641\u0627\u064B \u06A9\u0644\u0645\u0627\u062A \u06A9\u0644\u06CC\u062F\u06CC \u06CC\u0627 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627\u06CC \u062F\u06CC\u06AF\u0631\u06CC \u0631\u0627 \u0627\u0645\u062A\u062D\u0627\u0646 \u06A9\u0646\u06CC\u062F. "),a(),o(9,"button",44),h("click",function(){_(e);let n=u();return C(n.onClearFilters())}),l(10," \u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627 "),a()()}}function Xi(t,r){if(t&1&&g(0,"img",50),t&2){let e=u().$implicit;y("src",e.imageUrl,Ie)("alt",e.name)}}function Zi(t,r){t&1&&(o(0,"div",51)(1,"span",63),l(2,"image"),a()())}function Ji(t,r){t&1&&(o(0,"span",53),l(1," \u062A\u062E\u0641\u06CC\u0641 "),a())}function en(t,r){t&1&&(o(0,"span",54),l(1," \u0646\u0627\u0645\u0648\u062C\u0648\u062F "),a())}function tn(t,r){if(t&1&&(o(0,"a",48)(1,"figure",49),m(2,Xi,1,2,"img",50),m(3,Zi,3,0,"div",51),o(4,"div",52),m(5,Ji,2,0,"span",53),m(6,en,2,0,"span",54),a()(),o(7,"div",55)(8,"h3",56),l(9),a(),o(10,"div",57)(11,"span",58),l(12,"category"),a(),o(13,"span",59),l(14),a()(),o(15,"div",60)(16,"div",61),l(17),a(),o(18,"span",62),l(19," arrow_back "),a()()()()),t&2){let e=r.$implicit,i=u(3);y("routerLink",i.getProductLink(e)),c(2),p(e.imageUrl?2:-1),c(),p(e.imageUrl?-1:3),c(2),p((e.discountPercentage||0)>0?5:-1),c(),p(e.inStock?-1:6),c(3),b(" ",e.name," "),c(5),F(e.categoryGroupName),c(3),b(" ",i.formatPrice(e.price)," ")}}function nn(t,r){if(t&1&&(o(0,"div",45),T(1,tn,20,8,"a",48,M),a()),t&2){let e=u(2);c(),I(e.searchResults().items)}}function rn(t,r){if(t&1&&g(0,"img",50),t&2){let e=u().$implicit;y("src",e.imageUrl,Ie)("alt",e.name)}}function on(t,r){t&1&&(o(0,"div",51)(1,"span",63),l(2,"image"),a()())}function an(t,r){if(t&1&&(o(0,"p",70),l(1),a()),t&2){let e=u().$implicit;c(),b(" ",e.description," ")}}function sn(t,r){t&1&&(o(0,"span",73),l(1," \u062A\u062E\u0641\u06CC\u0641 "),a())}function ln(t,r){t&1&&(o(0,"span",74),l(1," \u0646\u0627\u0645\u0648\u062C\u0648\u062F "),a())}function cn(t,r){if(t&1&&(o(0,"a",64)(1,"figure",65),m(2,rn,1,2,"img",50),m(3,on,3,0,"div",51),a(),o(4,"div",66)(5,"div",67)(6,"div",68)(7,"h3",69),l(8),a(),m(9,an,2,1,"p",70),o(10,"div",71)(11,"div",72)(12,"span",10),l(13,"category"),a(),o(14,"span"),l(15),a()(),o(16,"div",7),m(17,sn,2,0,"span",73),m(18,ln,2,0,"span",74),a()()(),o(19,"div",75)(20,"div",76),l(21),a()()()()()),t&2){let e=r.$implicit,i=u(3);y("routerLink",i.getProductLink(e)),c(2),p(e.imageUrl?2:-1),c(),p(e.imageUrl?-1:3),c(5),b(" ",e.name," "),c(),p(e.description?9:-1),c(6),F(e.categoryGroupName),c(2),p((e.discountPercentage||0)>0?17:-1),c(),p(e.inStock?-1:18),c(3),b(" ",i.formatPrice(e.price)," ")}}function un(t,r){if(t&1&&(o(0,"div",46),T(1,cn,22,9,"a",64,M),a()),t&2){let e=u(2);c(),I(e.searchResults().items)}}function dn(t,r){if(t&1){let e=x();o(0,"button",80),h("click",function(){let n=_(e).$index,s=u(3);return C(s.onPageChange(n+1))}),l(1),a()}if(t&2){let e=r.$index,i=u(3);z("btn-primary",i.currentPage()===e+1)("btn-outline",i.currentPage()!==e+1),c(),b(" ",e+1," ")}}function mn(t,r){if(t&1){let e=x();o(0,"div",47)(1,"button",77),h("click",function(){_(e);let n=u(2);return C(n.onPageChange(n.currentPage()-1))}),o(2,"span",35),l(3,"chevron_right"),a()(),o(4,"div",78),T(5,dn,2,5,"button",79,M),a(),o(7,"button",77),h("click",function(){_(e);let n=u(2);return C(n.onPageChange(n.currentPage()+1))}),o(8,"span",35),l(9,"chevron_left"),a()()()}if(t&2){let e=u(2);c(),y("disabled",e.currentPage()===1),c(4),I(ye(2,Hi).constructor(e.getMin(e.totalPages(),5))),c(2),y("disabled",e.currentPage()===e.totalPages())}}function pn(t,r){if(t&1&&(o(0,"div"),m(1,nn,3,0,"div",45),m(2,un,3,0,"div",46),m(3,mn,10,3,"div",47),a()),t&2){let e=u();c(),p(e.viewMode()==="grid"?1:-1),c(),p(e.viewMode()==="list"?2:-1),c(),p(e.totalPages()>1?3:-1)}}var Ci=(()=>{class t{constructor(){this.route=v(De),this.router=v(X),this.searchService=v(Ue),this.validationService=v(we),this.searchAction$=new N,this.searchControl=new oe("",{nonNullable:!0}),this.filtersForm=new oi({sort:new oe(""),minPrice:new oe(null),maxPrice:new oe(null),inStockOnly:new oe(!1),brand:new oe("")}),this.searchResults=j(null),this.isLoading=j(!1),this.error=j(null),this.currentQuery=j(""),this.currentPage=j(1),this.pageSize=j(20),this.viewMode=j("grid"),this.totalPages=re(()=>{let e=this.searchResults();return!e||e.total===0?0:Math.ceil(e.total/this.pageSize())}),this.hasResults=re(()=>{let e=this.searchResults();return e!==null&&e.items.length>0}),this.isEmpty=re(()=>{let e=this.searchResults();return!this.isLoading()&&e!==null&&e.items.length===0}),this.destroy$=new N,this.sortOptions=[{value:"relevance",label:"\u0645\u0631\u062A\u0628\u0637\u200C\u062A\u0631\u06CC\u0646"},{value:"price_asc",label:"\u0642\u06CC\u0645\u062A \u0635\u0639\u0648\u062F\u06CC"},{value:"price_desc",label:"\u0642\u06CC\u0645\u062A \u0646\u0632\u0648\u0644\u06CC"},{value:"newest",label:"\u062C\u062F\u06CC\u062F\u062A\u0631\u06CC\u0646"},{value:"popular",label:"\u0645\u062D\u0628\u0648\u0628\u200C\u062A\u0631\u06CC\u0646"}]}ngOnInit(){this.searchAction$.pipe(w(this.destroy$),te(e=>(this.isLoading.set(!0),this.error.set(null),this.searchService.searchProducts(e).pipe(P(i=>(this.error.set(i.message||"\u062E\u0637\u0627 \u062F\u0631 \u062C\u0633\u062A\u062C\u0648"),A(null))),Te(()=>this.isLoading.set(!1)))))).subscribe(e=>{e&&this.searchResults.set(e)}),this.route.queryParams.pipe(w(this.destroy$),se((e,i)=>e.q===i.q&&e.page===i.page),ve(100)).subscribe(e=>{let i=e.q||"",n=parseInt(e.page,10)||1;i&&i.length>=2?(this.currentQuery.set(i),this.currentPage.set(n),this.searchControl.setValue(i,{emitEvent:!1}),this.triggerSearch(i,n)):(!i||i.length<2)&&this.searchResults.set(null)}),this.filtersForm.valueChanges.pipe(ve(300),se((e,i)=>JSON.stringify(e)===JSON.stringify(i)),w(this.destroy$)).subscribe(()=>{this.updateUrl(this.currentQuery(),1)}),this.searchControl.valueChanges.pipe(ve(300),se(),w(this.destroy$)).subscribe(e=>{e&&e.length>=2&&this.updateUrl(e,1)})}triggerSearch(e,i){let n=this.validationService.validateSearchQuery(e);if(!n.isValid){this.error.set(n.errors?.[0]||"\u0648\u0631\u0648\u062F\u06CC \u0646\u0627\u0645\u0639\u062A\u0628\u0631 \u0627\u0633\u062A");return}let s={q:n.sanitizedValue,page:i,pageSize:this.pageSize(),sortBy:this.filtersForm.controls.sort.value||void 0,minPrice:this.filtersForm.controls.minPrice.value??void 0,maxPrice:this.filtersForm.controls.maxPrice.value??void 0,inStockOnly:this.filtersForm.controls.inStockOnly.value??void 0,brand:this.filtersForm.controls.brand.value||void 0};this.searchAction$.next(s)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}performSearch(e,i=1){let n=e??this.currentQuery();this.updateUrl(n,i)}onPageChange(e){e<1||e>this.totalPages()||this.updateUrl(this.currentQuery(),e)}updateUrl(e,i){this.router.navigate([],{relativeTo:this.route,queryParams:{q:e,page:i>1?i:null},queryParamsHandling:"merge"})}onSubmitSearch(){let e=this.searchControl.value?.trim();e&&e.length>=2&&this.updateUrl(e,1)}onClearSearch(){this.searchControl.setValue(""),this.searchResults.set(null),this.currentQuery.set(""),this.router.navigate(["/search"])}onClearFilters(){this.filtersForm.reset({sort:"",minPrice:null,maxPrice:null,inStockOnly:!1,brand:""})}getProductLink(e){return`/products/${e.productId}`}formatPrice(e){return new Intl.NumberFormat("fa-IR").format(e)+" \u062A\u0648\u0645\u0627\u0646"}retryLastSearch(){this.error.set(null),this.triggerSearch(this.currentQuery(),this.currentPage())}getMin(e,i){return Math.min(e,i)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=k({type:t,selectors:[["app-search-results"]],decls:52,vars:16,consts:[[1,"container","py-8"],[1,"error-container"],[1,"page-header","mb-6"],[1,"flex","items-center","justify-between","flex-wrap","gap-4"],[1,"text-2xl","font-bold","text-foreground","mb-2"],[1,"text-primary"],[1,"text-sm","text-muted-foreground"],[1,"flex","items-center","gap-2"],[1,"btn-group"],["type","button","aria-label","\u0646\u0645\u0627\u06CC\u0634 \u0634\u0628\u06A9\u0647\u200C\u0627\u06CC",1,"btn","btn-sm",3,"click"],[1,"material-icons","text-base"],["type","button","aria-label","\u0646\u0645\u0627\u06CC\u0634 \u0644\u06CC\u0633\u062A\u06CC",1,"btn","btn-sm",3,"click"],[1,"grid","grid-cols-1","lg:grid-cols-4","gap-6"],[1,"lg:col-span-1"],[1,"card","p-6","space-y-6","sticky","top-20"],[1,"flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-foreground"],["type","button",1,"btn","btn-ghost","btn-sm","text-destructive",3,"click"],[1,"space-y-4",3,"formGroup"],[1,"label"],[1,"label-text"],["formControlName","sort",1,"select","select-bordered","w-full"],[3,"value"],[1,"divider"],[1,"grid","grid-cols-2","gap-2"],["type","number","formControlName","minPrice","placeholder","\u0627\u0632","min","0",1,"input","input-bordered","input-sm"],["type","number","formControlName","maxPrice","placeholder","\u062A\u0627","min","0",1,"input","input-bordered","input-sm"],[1,"form-control"],[1,"label","cursor-pointer","justify-start","gap-3"],["type","checkbox","formControlName","inStockOnly",1,"checkbox","checkbox-primary"],[1,"lg:col-span-3"],[1,"flex","items-center","justify-center","py-20"],[1,"card","p-12","text-center"],[1,"error-message"],[1,"btn","btn-secondary",3,"click"],[1,"material-icons"],[1,"text-center"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"text-sm","text-muted-foreground","mt-4"],[1,"material-icons","text-6xl","text-destructive","mb-4"],[1,"text-lg","font-semibold","text-foreground","mb-2"],["type","button",1,"btn","btn-primary","mt-4",3,"click"],[1,"material-icons","text-6xl","text-muted-foreground/50","mb-4"],[1,"text-sm","text-muted-foreground","mb-4"],["type","button",1,"btn","btn-outline",3,"click"],[1,"grid","grid-cols-1","sm:grid-cols-2","xl:grid-cols-3","gap-4"],[1,"space-y-4"],[1,"flex","items-center","justify-center","gap-2","mt-8"],[1,"card","hover:shadow-lg","transition-shadow","group",3,"routerLink"],[1,"relative","aspect-square","overflow-hidden","bg-muted"],["loading","lazy",1,"w-full","h-full","object-cover","group-hover:scale-105","transition-transform","duration-300",3,"src","alt"],[1,"w-full","h-full","flex","items-center","justify-center"],[1,"absolute","top-2","right-2","flex","flex-col","gap-2"],[1,"badge","badge-destructive"],[1,"badge","badge-outline","bg-background/80","backdrop-blur-sm"],[1,"card-body","p-4"],[1,"card-title","text-base","line-clamp-2","group-hover:text-primary","transition-colors"],[1,"flex","items-center","gap-2","text-xs","text-muted-foreground","mt-2"],[1,"material-icons","text-sm"],[1,"truncate"],[1,"flex","items-center","justify-between","mt-4"],[1,"font-bold","text-primary"],[1,"material-icons","text-muted-foreground","group-hover:text-primary","transition-colors"],[1,"material-icons","text-6xl","text-muted-foreground/30"],[1,"card","card-side","hover:shadow-lg","transition-shadow","group",3,"routerLink"],[1,"w-48","flex-shrink-0","bg-muted"],[1,"card-body"],[1,"flex","items-start","justify-between","gap-4"],[1,"flex-1"],[1,"card-title","text-lg","group-hover:text-primary","transition-colors"],[1,"text-sm","text-muted-foreground","mt-2","line-clamp-2"],[1,"flex","items-center","gap-4","mt-4"],[1,"flex","items-center","gap-2","text-sm","text-muted-foreground"],[1,"badge","badge-destructive","badge-sm"],[1,"badge","badge-outline","badge-sm"],[1,"text-left"],[1,"font-bold","text-xl","text-primary"],["type","button",1,"btn","btn-outline","btn-sm",3,"click","disabled"],[1,"flex","items-center","gap-1"],["type","button",1,"btn","btn-sm",3,"btn-primary","btn-outline"],["type","button",1,"btn","btn-sm",3,"click"]],template:function(i,n){i&1&&(o(0,"div",0),m(1,Bi,7,1,"div",1),o(2,"div",2)(3,"div",3)(4,"div")(5,"h1",4),l(6," \u0646\u062A\u0627\u06CC\u062C \u062C\u0633\u062A\u062C\u0648 "),m(7,qi,2,1,"span",5),a(),m(8,Gi,2,1,"p",6),a(),o(9,"div",7)(10,"div",8)(11,"button",9),h("click",function(){return n.viewMode.set("grid")}),o(12,"span",10),l(13,"grid_view"),a()(),o(14,"button",11),h("click",function(){return n.viewMode.set("list")}),o(15,"span",10),l(16,"view_list"),a()()()()()(),o(17,"div",12)(18,"aside",13)(19,"div",14)(20,"div",15)(21,"h2",16),l(22,"\u0641\u06CC\u0644\u062A\u0631\u0647\u0627"),a(),o(23,"button",17),h("click",function(){return n.onClearFilters()}),l(24," \u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 "),a()(),o(25,"form",18)(26,"div")(27,"label",19)(28,"span",20),l(29,"\u0645\u0631\u062A\u0628\u200C\u0633\u0627\u0632\u06CC"),a()(),o(30,"select",21),T(31,Wi,2,2,"option",22,M),a()(),g(33,"div",23),o(34,"div")(35,"label",19)(36,"span",20),l(37,"\u0645\u062D\u062F\u0648\u062F\u0647 \u0642\u06CC\u0645\u062A (\u062A\u0648\u0645\u0627\u0646)"),a()(),o(38,"div",24),g(39,"input",25)(40,"input",26),a()(),g(41,"div",23),o(42,"div",27)(43,"label",28),g(44,"input",29),o(45,"span",20),l(46,"\u0641\u0642\u0637 \u06A9\u0627\u0644\u0627\u0647\u0627\u06CC \u0645\u0648\u062C\u0648\u062F"),a()()()()()(),o(47,"main",30),m(48,Yi,5,0,"div",31),m(49,Qi,9,1,"div",32),m(50,Ki,11,0,"div",32),m(51,pn,4,3,"div"),a()()()),i&2&&(c(),p(n.error()?1:-1),c(6),p(n.currentQuery()?7:-1),c(),p(n.hasResults()?8:-1),c(3),z("btn-primary",n.viewMode()==="grid")("btn-outline",n.viewMode()!=="grid"),c(3),z("btn-primary",n.viewMode()==="list")("btn-outline",n.viewMode()!=="list"),c(11),y("formGroup",n.filtersForm),c(6),I(n.sortOptions),c(17),p(n.isLoading()?48:-1),c(),p(n.error()&&!n.isLoading()?49:-1),c(),p(n.isEmpty()?50:-1),c(),p(n.hasResults()&&!n.isLoading()?51:-1))},dependencies:[B,Z,je,ai,mi,pi,$e,si,ni,di,Ve,ri,hi,ui,ci],styles:[".page-header[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInDown .3s ease-out}.card[_ngcontent-%COMP%]{transition:all .3s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-4px)}figure[_ngcontent-%COMP%]{position:relative;overflow:hidden}figure[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transition:transform .3s ease}.badge[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.loading-spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_fadeInDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}@media(max-width:1024px){.grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(250px,1fr))}}@media(max-width:768px){.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.card-side[_ngcontent-%COMP%]{flex-direction:column}.card-side[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]{width:100%;aspect-ratio:16/9}}  .highlight{background-color:hsl(var(--primary)/.2);font-weight:600;color:hsl(var(--primary));padding:0 2px;border-radius:2px}*[_ngcontent-%COMP%]{transition-property:color,background-color,border-color,transform,box-shadow;transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,.2,1)}@media(min-width:1024px){aside[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{position:sticky;top:5rem}}.btn-group[_ngcontent-%COMP%]{display:inline-flex;border-radius:.5rem;overflow:hidden}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:0}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:first-child{border-top-right-radius:.5rem;border-bottom-right-radius:.5rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{border-top-left-radius:.5rem;border-bottom-left-radius:.5rem}.material-icons.text-6xl[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.btn-sm[_ngcontent-%COMP%]{min-width:2.5rem}.btn-sm[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})}}return t})();var vi=[{path:"",loadComponent:()=>import("./chunk-MTK5KHP3.js").then(t=>t.Home)},{path:"auth",loadChildren:()=>import("./chunk-33B5MGC6.js").then(t=>t.AUTH_ROUTES)},{path:"cart",loadComponent:()=>import("./chunk-HSEVAELG.js").then(t=>t.CartPage),canActivate:[Ne]},{path:"category",loadChildren:()=>import("./chunk-QY2DK7YK.js").then(t=>t.CATEGORY_ROUTES)},{path:"brand",loadChildren:()=>import("./chunk-62BXB4WO.js").then(t=>t.BRAND_ROUTES)},{path:"products",loadChildren:()=>import("./chunk-U4OONCYP.js").then(t=>t.PRODUCTS_ROUTES)},{path:"discounts",loadChildren:()=>import("./chunk-UWH64HOQ.js").then(t=>t.DISCOUNT_ROUTES)},{path:"checkout",loadChildren:()=>import("./chunk-7BJGKN6T.js").then(t=>t.CHECKOUT_ROUTES),canActivate:[Ne]},{path:"payment",loadChildren:()=>import("./chunk-2NBJHRSQ.js").then(t=>t.PAYMENT_ROUTES)},{path:"dashboard",loadChildren:()=>import("./chunk-33OYS7OO.js").then(t=>t.DASHBOARD_ROUTES),canActivate:[Ne]},{path:"admin",loadChildren:()=>import("./chunk-PD7VIJEH.js").then(t=>t.ADMIN_ROUTES),canActivate:[ii]},{path:"search",component:Ci,title:"\u0646\u062A\u0627\u06CC\u062C \u062C\u0633\u062A\u062C\u0648"},{path:"**",redirectTo:"",pathMatch:"full"}];var hn="@",fn=(()=>{class t{doc;delegate;zone;animationType;moduleImpl;_rendererFactoryPromise=null;scheduler=null;injector=v(ft);loadingSchedulerFn=v(gn,{optional:!0});_engine;constructor(e,i,n,s,d){this.doc=e,this.delegate=i,this.zone=n,this.animationType=s,this.moduleImpl=d}ngOnDestroy(){this._engine?.flush()}loadImpl(){let e=()=>this.moduleImpl??import("./chunk-A43MI2PK.js").then(n=>n),i;return this.loadingSchedulerFn?i=this.loadingSchedulerFn(e):i=e(),i.catch(n=>{throw new ut(5300,!1)}).then(({\u0275createEngine:n,\u0275AnimationRendererFactory:s})=>{this._engine=n(this.animationType,this.doc);let d=new s(this.delegate,this._engine,this.zone);return this.delegate=d,d})}createRenderer(e,i){let n=this.delegate.createRenderer(e,i);if(n.\u0275type===0)return n;typeof n.throwOnSyntheticProps=="boolean"&&(n.throwOnSyntheticProps=!1);let s=new Je(n);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(d=>{let f=d.createRenderer(e,i);s.use(f),this.scheduler??=this.injector.get(xt,null,{optional:!0}),this.scheduler?.notify(10)}).catch(d=>{s.use(n)}),s}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}componentReplaced(e){this._engine?.flush(),this.delegate.componentReplaced?.(e)}static \u0275fac=function(i){kt()};static \u0275prov=V({token:t,factory:t.\u0275fac})}return t})(),Je=class{delegate;replay=[];\u0275type=1;constructor(r){this.delegate=r}use(r){if(this.delegate=r,this.replay!==null){for(let e of this.replay)e(r);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(r,e){return this.delegate.createElement(r,e)}createComment(r){return this.delegate.createComment(r)}createText(r){return this.delegate.createText(r)}get destroyNode(){return this.delegate.destroyNode}appendChild(r,e){this.delegate.appendChild(r,e)}insertBefore(r,e,i,n){this.delegate.insertBefore(r,e,i,n)}removeChild(r,e,i,n){this.delegate.removeChild(r,e,i,n)}selectRootElement(r,e){return this.delegate.selectRootElement(r,e)}parentNode(r){return this.delegate.parentNode(r)}nextSibling(r){return this.delegate.nextSibling(r)}setAttribute(r,e,i,n){this.delegate.setAttribute(r,e,i,n)}removeAttribute(r,e,i){this.delegate.removeAttribute(r,e,i)}addClass(r,e){this.delegate.addClass(r,e)}removeClass(r,e){this.delegate.removeClass(r,e)}setStyle(r,e,i,n){this.delegate.setStyle(r,e,i,n)}removeStyle(r,e,i){this.delegate.removeStyle(r,e,i)}setProperty(r,e,i){this.shouldReplay(e)&&this.replay.push(n=>n.setProperty(r,e,i)),this.delegate.setProperty(r,e,i)}setValue(r,e){this.delegate.setValue(r,e)}listen(r,e,i,n){return this.shouldReplay(e)&&this.replay.push(s=>s.listen(r,e,i,n)),this.delegate.listen(r,e,i,n)}shouldReplay(r){return this.replay!==null&&r.startsWith(hn)}},gn=new dt("");function xi(t="animations"){return St("NgAsyncAnimations"),mt([{provide:wt,useFactory:()=>new fn(v(gt),v(zt),v(Ct),t)},{provide:yt,useValue:t==="noop"?"NoopAnimations":"BrowserAnimations"}])}var He=!1,et=new me(null),Be=()=>{if(typeof window>"u")return!1;let t=window.location.pathname.toLowerCase(),r=window.location.search.toLowerCase();return t.includes("/payment")||t.includes("/callback")||r.includes("authority=")||r.includes("status=")},_n=t=>{let r=t.toLowerCase();return r.includes("/verify-payment")||r.includes("/orders/verify-payment")||r.includes("payment")},qe=(t,r)=>{let e=Q.getAuthToken();if(e&&!t.url.includes("/refresh"))return t.clone({setHeaders:{Authorization:`Bearer ${e}`}});if(!r.isAuthenticated()){let i=he.getGuestToken();if(i)return t.clone({setHeaders:{"X-Guest-Token":i}})}return t},Cn=(t,r,e,i)=>He?et.pipe(Ce(n=>n!=null),st(1),te(()=>r(qe(t,e)))):(He=!0,et.next(null),e.refreshToken().pipe(te(n=>(He=!1,n&&n.token?(et.next(n.token),r(qe(t,e))):(Be()||(e.logout(),i.clearLocalCart()),E(()=>new Error("Session expired."))))),P(n=>(He=!1,Be()||(e.logout(!1),i.clearLocalCart()),E(()=>n))))),yi=(t,r)=>{let e=v(Q),i=v(he),n=t.url.startsWith(J.API_URL),s=t;return Be()||_n(t.url)?(n&&(s=qe(t,e)),s=s.clone({withCredentials:!0})):n&&(s=qe(t,e),s=s.clone({withCredentials:!0})),r(s).pipe(P(d=>{let f=t.url.includes("/login")||t.url.includes("/refresh")||t.url.includes("/verify-otp");return d instanceof Ke&&d.status===401&&f?(Be()||e.logout(!1),E(()=>d)):d instanceof Ke&&d.status===401&&n?Cn(t,r,e,i):E(()=>d)}))};var vn=t=>{let r=t.url.toLowerCase(),e=t.headers.has("X-Payment-Verification");return r.includes("/verify-payment")||r.includes("/payment")||r.includes("/checkout")||e},xn=()=>{if(typeof window>"u")return!1;let t=window.location.pathname.toLowerCase(),r=window.location.search.toLowerCase();return t.includes("/payment/callback")||t.includes("/payment/success")||t.includes("/payment/failure")||t.includes("/payment")||r.includes("authority=")||r.includes("status=")},bi=(t,r)=>{let e=v(q),i=v(Q);return r(t).pipe(P(n=>{let s=t.url.includes("/login")||t.url.includes("/refresh")||t.url.includes("/verify-otp");if(vn(t)||xn())return E(()=>n);if(n.status===401&&s)return i.logout(!1),E(()=>n);if(n.status===401&&!s)return E(()=>n);let f="\u06CC\u06A9 \u062E\u0637\u0627\u06CC \u067E\u06CC\u0634\u200C\u0628\u06CC\u0646\u06CC \u0646\u0634\u062F\u0647 \u0631\u062E \u062F\u0627\u062F.  \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.";return n.status===429?f="\u062A\u0639\u062F\u0627\u062F \u062F\u0631\u062E\u0648\u0627\u0633\u062A\u200C\u0647\u0627\u06CC \u0634\u0645\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627\u064B \u0686\u0646\u062F \u0644\u062D\u0638\u0647 \u0628\u0639\u062F \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.":n.status===409?n.error?.message?.includes("modified by another user")||n.error?.message?.includes("Cart was updated")?f="\u0627\u06CC\u0646 \u0631\u06A9\u0648\u0631\u062F \u062A\u0648\u0633\u0637 \u06A9\u0627\u0631\u0628\u0631 \u062F\u06CC\u06AF\u0631\u06CC \u062A\u063A\u06CC\u06CC\u0631 \u06A9\u0631\u062F\u0647 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627\u064B \u0635\u0641\u062D\u0647 \u0631\u0627 \u0631\u0641\u0631\u0634 \u06A9\u0646\u06CC\u062F.":f=n.error?.message||"\u0627\u0637\u0644\u0627\u0639\u0627\u062A \u062A\u0648\u0633\u0637 \u06A9\u0627\u0631\u0628\u0631 \u062F\u06CC\u06AF\u0631\u06CC \u062A\u063A\u06CC\u06CC\u0631 \u06A9\u0631\u062F\u0647 \u0627\u0633\u062A.  \u0644\u0637\u0641\u0627\u064B \u0635\u0641\u062D\u0647 \u0631\u0627 \u0631\u0641\u0631\u0634 \u06A9\u0631\u062F\u0647 \u0648 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.":n.error instanceof ErrorEvent?f=`\u062E\u0637\u0627: ${n.error.message}`:n.error&&typeof n.error.message=="string"?f=n.error.message:typeof n.error=="string"&&n.error.length<200?f=n.error:n.statusText&&(f=`\u062E\u0637\u0627: ${n.statusText}`),e.show(f,"error"),E(()=>n)}))};var Si=(t,r)=>{let e=v(q);return r(t).pipe(P(i=>i.status===429?yn(i,t,r,e):E(()=>i)))};function yn(t,r,e,i){let n=t.headers.get("Retry-After"),s=parseInt(n||"60",10),d=s*1e3,f=n?`\u062F\u0631\u062E\u0648\u0627\u0633\u062A\u200C\u0647\u0627\u06CC \u0634\u0645\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 ${s} \u062B\u0627\u0646\u06CC\u0647 \u0635\u0628\u0631 \u06A9\u0646\u06CC\u062F.`:"\u062F\u0631\u062E\u0648\u0627\u0633\u062A\u200C\u0647\u0627\u06CC \u0634\u0645\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u0686\u0646\u062F \u0644\u062D\u0638\u0647 \u0635\u0628\u0631 \u06A9\u0646\u06CC\u062F.";return i.show(f,"error"),typeof window<"u"&&!window.navigator.onLine&&console.warn("[Rate Limit] Network appears to be offline"),console.warn("[Rate Limit] Too many requests. Retrying after:",s,"seconds"),_e(d).pipe(R(()=>{console.info("[Rate Limit] Retrying request..."),i.show("\u062F\u0631 \u062D\u0627\u0644 \u062A\u0644\u0627\u0634 \u0645\u062C\u062F\u062F...","info")}),te(()=>e(r)),P(U=>U.status===429?(i.show("\u062F\u0631\u062E\u0648\u0627\u0633\u062A \u0634\u0645\u0627 \u0647\u0645\u0686\u0646\u0627\u0646 \u0645\u062D\u062F\u0648\u062F \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u0628\u0639\u062F\u0627\u064B \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.","error"),E(()=>U)):E(()=>U)))}function bn(t){let r=t&&(t.hasOwnProperty("items")||t.hasOwnProperty("Items")),e=t&&(t.hasOwnProperty("totalItems")||t.hasOwnProperty("TotalItems")||t.hasOwnProperty("totalCount")||t.hasOwnProperty("TotalCount"));return r&&e}var wi=(t,r)=>r(t).pipe(ge(e=>{if(e instanceof Ht&&e.body&&bn(e.body)){let i=e.body,n={items:i.items??i.Items??[],totalCount:i.totalItems??i.TotalItems??i.totalCount??i.TotalCount??0,page:i.page??i.Page??i.pageNumber??i.PageNumber??1,pageSize:i.pageSize??i.PageSize??10,totalPages:i.totalPages??i.TotalPages??1,hasNext:i.hasNext??i.HasNext??!1,hasPrevious:i.hasPrevious??i.HasPrevious??!1};return e.clone({body:n})}return e}));var Ei=(t,r)=>{let e=v(Bt);if(!(Sn(t.method)&&wn(t.url)&&!En(t.url)))return r(t);let n=e.getToken();if(n){let s=t.clone({headers:t.headers.set("X-XSRF-TOKEN",n)});return r(s)}return r(t)};function Sn(t){return["POST","PUT","PATCH","DELETE"].includes(t.toUpperCase())}function wn(t){return t.startsWith(J.API_URL)||t.startsWith("/api")}function En(t){return["/api/Users/login","/api/Users/verify-otp","/api/Users/refresh"].some(e=>t.includes(e))}var ki=(()=>{class t{constructor(e,i){this.http=e,this.platformId=i,this.apiUrl=`${J.API_URL}Security/csrf-token`,this.tokenFetched=!1}isPaymentPage(){if(!Y(this.platformId))return!1;let e=window.location.pathname.toLowerCase(),i=window.location.search.toLowerCase();return e.includes("/payment")||e.includes("/callback")||i.includes("authority=")||i.includes("status=")}initializeCsrfToken(){return Y(this.platformId)?this.tokenFetched?A(void 0):this.isPaymentPage()?(console.log("[CSRF] Skipping token fetch on payment page"),A(void 0)):this.http.get(this.apiUrl).pipe(R(e=>{e&&e.token&&(this.tokenFetched=!0,console.log("[CSRF] Token initialized successfully"))}),P(e=>(console.warn("[CSRF] Token fetch failed:",e),A(void 0))),ge(()=>{})):A(void 0)}refreshCsrfToken(){return this.isPaymentPage()?A(void 0):(this.tokenFetched=!1,this.initializeCsrfToken())}static{this.\u0275fac=function(i){return new(i||t)(H(Se),H(le))}}static{this.\u0275prov=V({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Mn(t){return()=>{if(typeof window<"u"){let r=window.location.pathname.toLowerCase(),e=window.location.search.toLowerCase();if(r.includes("/payment")||e.includes("authority=")||e.includes("status="))return A(void 0)}return t.initializeCsrfToken()}}var tt=class{constructor(){this.notificationService=v(q)}isPaymentPage(){if(typeof window>"u")return!1;let r=window.location.pathname.toLowerCase(),e=window.location.search.toLowerCase();return r.includes("/payment")||r.includes("/checkout")||e.includes("authority=")||e.includes("status=")}handleError(r){if(r?.message?.includes("Loading chunk")||r?.message?.includes("ChunkLoadError")||r?.message?.includes("Failed to fetch dynamically imported module")){console.warn("Chunk loading error detected:",r.message),typeof window<"u"&&(sessionStorage.getItem("chunk_reload_attempted")?(sessionStorage.removeItem("chunk_reload_attempted"),this.notificationService.show("\u062E\u0637\u0627 \u062F\u0631 \u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0635\u0641\u062D\u0647. \u0644\u0637\u0641\u0627\u064B \u0635\u0641\u062D\u0647 \u0631\u0627 \u0631\u0641\u0631\u0634 \u06A9\u0646\u06CC\u062F.","error")):(sessionStorage.setItem("chunk_reload_attempted","true"),window.location.reload()));return}console.error("Unhandled error:",r),!r.rejection&&r.status!==401&&!this.isPaymentPage()&&this.notificationService.show("\u06CC\u06A9 \u062E\u0637\u0627\u06CC \u063A\u06CC\u0631\u0645\u0646\u062A\u0638\u0631\u0647 \u0631\u062E \u062F\u0627\u062F. \u0644\u0637\u0641\u0627\u064B \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.","error")}},Mi={providers:[$t({eventCoalescing:!0}),Jt(vi,ti(),ei(Zt)),qt(Yt(),Gt([yi,Si,bi,wi,Ei]),Wt({headerName:"X-XSRF-TOKEN",cookieName:"XSRF-TOKEN"})),xi(),{provide:vt,useClass:tt},{provide:Tt,useFactory:Mn,deps:[ki],multi:!0},we]};var Ti=(()=>{class t{constructor(e){this.http=e,this.apiUrl=`${J.API_URL}Notifications`,this.notificationsSubject=new me([]),this.notifications$=this.notificationsSubject.asObservable(),this.unreadCountSubject=new me(0),this.unreadCount$=this.unreadCountSubject.asObservable()}getNotifications(e=!1,i=1,n=20){let s=new Ae().set("unreadOnly",e.toString()).set("page",i.toString()).set("pageSize",n.toString());return this.http.get(this.apiUrl,{params:s}).pipe(R(d=>{this.notificationsSubject.next(d.items??[])}))}getUnreadCount(){return this.http.get(`${this.apiUrl}/count`).pipe(R(e=>{this.unreadCountSubject.next(e.count)}))}markAsRead(e){return this.http.patch(`${this.apiUrl}/${e}/read`,{}).pipe(R(()=>{this.getUnreadCount().subscribe();let i=this.notificationsSubject.value.map(n=>n.id===e?fe(D({},n),{isRead:!0}):n);this.notificationsSubject.next(i)}))}markAllAsRead(){return this.http.patch(`${this.apiUrl}/read-all`,{}).pipe(R(()=>{this.unreadCountSubject.next(0);let e=this.notificationsSubject.value.map(i=>fe(D({},i),{isRead:!0}));this.notificationsSubject.next(e)}))}deleteNotification(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(R(()=>{let i=this.notificationsSubject.value.filter(n=>n.id!==e);this.notificationsSubject.next(i),this.getUnreadCount().subscribe()}))}static{this.\u0275fac=function(i){return new(i||t)(H(Se))}}static{this.\u0275prov=V({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var In=()=>[1,2,3];function An(t,r){if(t&1&&(o(0,"span",5),l(1),a()),t&2){let e=r;z("hidden",e===0),c(),b(" ",e>9?"9+":e," ")}}function Rn(t,r){t&1&&(o(0,"div",15),g(1,"div",16),o(2,"div",17),g(3,"div",18)(4,"div",19),a()())}function Pn(t,r){t&1&&(o(0,"div",10),T(1,Rn,5,0,"div",15,M),a()),t&2&&(c(),I(ye(0,In)))}function Fn(t,r){t&1&&(o(0,"div",11)(1,"span",20),l(2,"notifications_off"),a(),o(3,"p",21),l(4,"\u0647\u06CC\u0686 \u0627\u0639\u0644\u0627\u0646 \u062C\u062F\u06CC\u062F\u06CC \u0646\u062F\u0627\u0631\u06CC\u062F."),a()())}function On(t,r){t&1&&g(0,"div",24)}function Ln(t,r){if(t&1){let e=x();o(0,"div",12)(1,"a",22),h("click",function(){let n=_(e).$implicit,s=u(2);return C(s.handleNotificationClick(n))}),o(2,"div",23),m(3,On,1,0,"div",24),a(),o(4,"div",25)(5,"p",26),l(6),a(),o(7,"p",27),l(8),a(),o(9,"span",28),l(10),$(11,"date"),a()()()()}if(t&2){let e=r.$implicit;c(3),p(e.isRead?-1:3),c(2),z("text-foreground",!e.isRead)("text-muted-foreground",e.isRead),c(),b(" ",e.title," "),c(2),b(" ",e.message," "),c(2),b(" ",be(11,8,e.createdAt,"short")," ")}}function Dn(t,r){if(t&1){let e=x();o(0,"div",4)(1,"div",6)(2,"h3",7),l(3,"\u0627\u0639\u0644\u0627\u0646\u200C\u0647\u0627"),a(),o(4,"button",8),$(5,"async"),h("click",function(){_(e);let n=u();return C(n.markAllAsRead())}),l(6," \u062E\u0648\u0627\u0646\u062F\u0645 \u0647\u0645\u0647 "),a()(),o(7,"div",9),m(8,Pn,3,1,"div",10),m(9,Fn,5,0,"div",11),$(10,"async"),T(11,Ln,12,11,"div",12,M),$(13,"async"),a(),o(14,"div",13)(15,"a",14),l(16," \u0645\u0634\u0627\u0647\u062F\u0647 \u0647\u0645\u0647 \u0627\u0639\u0644\u0627\u0646\u200C\u0647\u0627 "),a()()()}if(t&2){let e,i=u();y("@slideFade",void 0),c(4),y("disabled",K(5,4,i.unreadCount$)===0),c(4),p(i.isLoading?8:-1),c(),p(!i.isLoading&&((e=K(10,6,i.notifications$))==null?null:e.length)===0?9:-1),c(2),I(K(13,8,i.notifications$))}}var Ii=(()=>{class t{constructor(e,i,n){this.notificationService=e,this.elementRef=i,this.router=n,this.isMenuOpen=!1,this.isLoading=!1,this.destroy$=new N,this.notifications$=this.notificationService.notifications$,this.unreadCount$=this.notificationService.unreadCount$}ngOnInit(){this.notificationService.getUnreadCount().pipe(w(this.destroy$)).subscribe()}toggleMenu(){this.isMenuOpen=!this.isMenuOpen,this.isMenuOpen&&this.loadNotifications()}loadNotifications(){this.isLoading=!0,this.notificationService.getNotifications().pipe(w(this.destroy$)).subscribe(()=>{this.isLoading=!1})}markAllAsRead(){this.notificationService.markAllAsRead().pipe(w(this.destroy$)).subscribe()}handleNotificationClick(e){e.isRead||this.notificationService.markAsRead(e.id).pipe(w(this.destroy$)).subscribe(),e.actionUrl&&this.router.navigateByUrl(e.actionUrl),this.isMenuOpen=!1}onDocumentClick(e){this.elementRef.nativeElement.contains(e.target)||(this.isMenuOpen=!1)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(i){return new(i||t)(S(Ti),S(xe),S(X))}}static{this.\u0275cmp=k({type:t,selectors:[["app-notification-bell"]],hostBindings:function(i,n){i&1&&h("click",function(d){return n.onDocumentClick(d)},pe)},decls:7,vars:4,consts:[[1,"relative",3,"click"],["aria-label","Notifications",1,"btn","btn-ghost","btn-icon","relative","rounded-full","hover:bg-accent","group",3,"click"],[1,"material-icons-outlined","text-xl","text-foreground/80","group-hover:icon-pulse"],[1,"absolute","top-1.5","right-1.5","flex","h-4","w-4","items-center","justify-center","rounded-full","badge-destructive","text-[10px]","font-bold","text-white","ring-2","ring-background","animate-in","zoom-in",3,"hidden"],[1,"dropdown-content","end-0","sm:end-auto","sm:start-1/2","sm:-translate-x-1/2","mt-2","w-80","md:w-96","origin-top-right"],[1,"absolute","top-1.5","right-1.5","flex","h-4","w-4","items-center","justify-center","rounded-full","badge-destructive","text-[10px]","font-bold","text-white","ring-2","ring-background","animate-in","zoom-in"],[1,"flex","items-center","justify-between","p-4","border-b","border-border","bg-muted/30"],[1,"font-semibold","text-sm"],[1,"btn","btn-link","btn-xs","disabled:opacity-50","disabled:no-underline",3,"click","disabled"],[1,"max-h-[400px]","overflow-y-auto","scrollbar-thin"],[1,"p-4","space-y-4"],[1,"p-8","text-center","empty-state"],[1,"divide-y","divide-border"],[1,"p-2","bg-muted/30","border-t","border-border","text-center"],["routerLink","/dashboard/notifications",1,"btn","btn-ghost","btn-sm","w-full"],[1,"flex","gap-3"],[1,"skeleton","skeleton-avatar","w-8","h-8","rounded-full","shrink-0"],[1,"flex-1","space-y-2"],[1,"skeleton","skeleton-text","w-3/4"],[1,"skeleton","skeleton-text","w-1/2"],[1,"material-icons-outlined","icon-4xl","text-muted-foreground/50","mb-2","empty-state-icon"],[1,"text-sm","text-muted-foreground","empty-state-description"],[1,"flex","items-start","gap-3","p-4","hover:bg-accent/50","transition-colors","cursor-pointer","relative","group",3,"click"],[1,"flex-shrink-0","mt-1"],[1,"w-2.5","h-2.5","rounded-full","bg-primary","group-hover:scale-110","transition-transform","badge-dot"],[1,"flex-1","space-y-1"],[1,"text-sm","font-medium","leading-none"],[1,"text-xs","text-muted-foreground","leading-relaxed","line-clamp-2"],[1,"text-[10px]","text-muted-foreground/70","block","pt-1"]],template:function(i,n){if(i&1&&(o(0,"div",0),h("click",function(d){return n.onDocumentClick(d)},pe),o(1,"button",1),h("click",function(){return n.toggleMenu()}),o(2,"span",2),l(3,"notifications"),a(),m(4,An,2,3,"span",3),$(5,"async"),a(),m(6,Dn,17,10,"div",4),a()),i&2){let s;c(4),p((s=K(5,2,n.unreadCount$))?4:-1,s),c(2),p(n.isMenuOpen?6:-1)}},dependencies:[ue,B,Z,Oe,jt],encapsulation:2,data:{animation:[de("slideFade",[W(":enter",[O({opacity:0,transform:"translateY(-10px)"}),G("150ms ease-out",O({opacity:1,transform:"translateY(0)"}))]),W(":leave",[G("150ms ease-in",O({opacity:0,transform:"translateY(-10px)"}))])])]}})}}return t})();var Nn=t=>["/category",t],$n=t=>["/products/category-group",t];function Vn(t,r){if(t&1){let e=x();o(0,"li")(1,"button",4),h("mouseenter",function(){let n=_(e).$implicit,s=u();return C(s.setActiveCategory(n.id))}),o(2,"span",5),l(3),a(),o(4,"span",6),l(5," chevron_left "),a()()()}if(t&2){let e=r.$implicit,i=u();c(),y("ngClass",i.activeCategoryId===e.id?"bg-background text-primary font-bold shadow-sm":"text-foreground hover:bg-background/50 hover:text-primary"),c(2),F(e.title),c(),y("ngClass",i.activeCategoryId===e.id?"text-primary":"opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0")}}function jn(t,r){if(t&1){let e=x();o(0,"a",15),h("click",function(){_(e);let n=u(3);return C(n.onItemClick())}),g(1,"span",16),l(2),a()}if(t&2){let e=r.$implicit;y("routerLink",Ye(2,$n,e.id)),c(2),b(" ",e.title," ")}}function zn(t,r){if(t&1){let e=x();o(0,"div",7)(1,"div",8)(2,"h3",9),g(3,"span",10),l(4),a(),o(5,"a",11),h("click",function(){_(e);let n=u(2);return C(n.onItemClick())}),l(6," \u0645\u0634\u0627\u0647\u062F\u0647 \u0647\u0645\u0647 "),o(7,"span",12),l(8,"arrow_back"),a()()(),o(9,"div",13),T(10,jn,3,4,"a",14,M),a()()}if(t&2){let e=u().$implicit;c(4),b(" ",e.title," "),c(),y("routerLink",Ye(2,Nn,e.id)),c(5),I(e.groups)}}function Un(t,r){if(t&1&&m(0,zn,12,4,"div",7),t&2){let e=r.$implicit,i=u();p(i.activeCategoryId===e.id?0:-1)}}var Ai=(()=>{class t{constructor(e){this.categoryService=e,this.categories=[],this.activeCategoryId=null,this.itemClicked=new _t}ngOnInit(){this.categoryService.getCategoryHierarchy().subscribe({next:e=>{this.categories=e,this.categories.length>0&&(this.activeCategoryId=this.categories[0].id)}})}setActiveCategory(e){this.activeCategoryId=e}onItemClick(){this.itemClicked.emit()}static{this.\u0275fac=function(i){return new(i||t)(S(gi))}}static{this.\u0275cmp=k({type:t,selectors:[["app-brand-menu"]],outputs:{itemClicked:"itemClicked"},decls:8,vars:0,consts:[[1,"flex","w-full","min-h-[400px]","bg-popover","text-popover-foreground","rounded-xl","overflow-hidden","shadow-inner","border","border-border",3,"click"],[1,"w-1/4","border-l","border-border","bg-muted/50","py-4","overflow-y-auto"],[1,"space-y-1","px-2"],[1,"w-3/4","p-8","bg-background","overflow-y-auto"],[1,"w-full","text-right","px-4","py-3","text-sm","rounded-lg","transition-all","duration-200","flex","items-center","justify-between","group",3,"mouseenter","ngClass"],[1,"truncate"],[1,"material-icons","text-base","transition-transform","duration-200",3,"ngClass"],[1,"animate-fade-in","space-y-6"],[1,"flex","items-center","justify-between","pb-4","border-b","border-border"],[1,"font-bold","text-xl","text-foreground","flex","items-center","gap-2"],[1,"w-1.5","h-6","bg-primary","rounded-full"],[1,"text-sm","font-medium","text-primary","hover:text-primary/80","flex","items-center","gap-1","transition-colors",3,"click","routerLink"],[1,"material-icons","text-sm"],[1,"grid","grid-cols-3","gap-x-6","gap-y-3"],[1,"text-sm","text-foreground","hover:text-primary","hover:translate-x-1","transition-all","duration-200","flex","items-center","gap-2","py-1.5",3,"routerLink"],[1,"text-sm","text-foreground","hover:text-primary","hover:translate-x-1","transition-all","duration-200","flex","items-center","gap-2","py-1.5",3,"click","routerLink"],[1,"w-1","h-1","rounded-full","bg-border","group-hover:bg-primary","transition-colors"]],template:function(i,n){i&1&&(o(0,"div",0),h("click",function(d){return d.stopPropagation()}),o(1,"div",1)(2,"ul",2),T(3,Vn,6,3,"li",null,M),a()(),o(5,"div",3),T(6,Un,1,1,null,null,M),a()()),i&2&&(c(3),I(n.categories),c(3),I(n.categories))},dependencies:[ue,Fe,B,Z],encapsulation:2})}}return t})();var Ri=(()=>{class t{constructor(e){this.sanitizer=e,this.cache=new Map,this.MAX_CACHE_SIZE=100}transform(e,i){if(!e||!i)return e||"";if(i.length>100)return console.warn("Search query too long for highlighting"),e;let n=`${e}_${i}`;if(this.cache.has(n))return this.cache.get(n);try{let s=this.sanitizer.sanitize(ce.HTML,e),d=this.sanitizer.sanitize(ce.HTML,i);if(!s||!d)return s||e||"";let f=this.normalizePersianChars(d),ee=this.escapeRegex(f).replace(/ی/g,"[\u06CC\u064A\u0649]").replace(/ک/g,"[\u06A9\u0643]").replace(/۴/g,"[\u06F4\u0664]").replace(/۵/g,"[\u06F5\u0665]").replace(/۶/g,"[\u06F6\u0666]"),ke=new RegExp(ee,"gi"),Me=s.replace(ke,nt=>{let rt=this.sanitizer.sanitize(ce.HTML,nt);return rt?`<mark class="search-highlight">${rt}</mark>`:nt}),Re=this.sanitizer.bypassSecurityTrustHtml(Me);return this.addToCache(n,Re),Re}catch(s){return console.error("Highlight pipe error:",s),e}}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}normalizePersianChars(e){return e?e.replace(/ي/g,"\u06CC").replace(/ك/g,"\u06A9").replace(/ى/g,"\u06CC").replace(/٤/g,"\u06F4").replace(/٥/g,"\u06F5").replace(/٦/g,"\u06F6"):""}addToCache(e,i){if(this.cache.size>=this.MAX_CACHE_SIZE){let n=this.cache.keys().next().value;n!==void 0&&this.cache.delete(n)}this.cache.set(e,i)}clearCache(){this.cache.clear()}static{this.\u0275fac=function(i){return new(i||t)(S(Le,16))}}static{this.\u0275pipe=Mt({name:"highlight",type:t,pure:!0})}}return t})();var Hn=["searchInput"];function Bn(t,r){t&1&&(o(0,"div",5),g(1,"span",8),a())}function qn(t,r){if(t&1){let e=x();o(0,"button",9),h("click",function(){_(e);let n=u();return C(n.onClearSearch())}),o(1,"span",10),l(2,"close"),a()()}}function Gn(t,r){t&1&&(o(0,"div",11),g(1,"span",12),o(2,"p",13),l(3,"\u062F\u0631 \u062D\u0627\u0644 \u062C\u0633\u062A\u062C\u0648..."),a()())}function Wn(t,r){if(t&1&&(o(0,"div",11)(1,"span",14),l(2,"error_outline"),a(),o(3,"p",15),l(4),a()()),t&2){let e=u(2);c(4),F(e.error())}}function Yn(t,r){t&1&&(o(0,"div",11)(1,"span",16),l(2,"search_off"),a(),o(3,"p",17),l(4,"\u0646\u062A\u06CC\u062C\u0647\u200C\u0627\u06CC \u06CC\u0627\u0641\u062A \u0646\u0634\u062F"),a(),o(5,"p",18),l(6,"\u0644\u0637\u0641\u0627\u064B \u06A9\u0644\u0645\u0627\u062A \u06A9\u0644\u06CC\u062F\u06CC \u062F\u06CC\u06AF\u0631\u06CC \u0631\u0627 \u0627\u0645\u062A\u062D\u0627\u0646 \u06A9\u0646\u06CC\u062F"),a()())}function Qn(t,r){if(t&1){let e=x();o(0,"button",27),h("click",function(){let n=_(e).$implicit,s=u(4);return C(s.onSelectItem({type:"category",data:n}))}),o(1,"span",28),l(2," category "),a(),o(3,"div",29),g(4,"span",30),$(5,"highlight"),o(6,"span",31),l(7),a()()()}if(t&2){let e=r.$implicit,i=r.$index,n=u(4);z("active",n.activeIndex()===i),c(4),y("innerHTML",be(5,4,e.name,n.searchControl.value),Pe),c(3),b("(",e.productCount," \u0645\u062D\u0635\u0648\u0644)")}}function Kn(t,r){if(t&1&&(o(0,"div",19)(1,"div",23)(2,"span",24)(3,"span",22),l(4,"category"),a(),l(5," \u062F\u0633\u062A\u0647\u200C\u0628\u0646\u062F\u06CC\u200C\u0647\u0627 "),a()(),o(6,"div",25),T(7,Qn,8,7,"button",26,M),a()()),t&2){let e=u(3);c(7),I(e.searchResults().categories)}}function Xn(t,r){if(t&1){let e=x();o(0,"button",27),h("click",function(){let n=_(e).$implicit,s=u(4);return C(s.onSelectItem({type:"group",data:n}))}),o(1,"span",28),l(2," label "),a(),o(3,"div",29),g(4,"div",32),$(5,"highlight"),o(6,"div",33),l(7),o(8,"span",34),l(9),a()()()()}if(t&2){let e=r.$implicit,i=r.$index,n=u(4);z("active",n.activeIndex()===(n.searchResults().categories.length||0)+i),c(4),y("innerHTML",be(5,5,e.name,n.searchControl.value),Pe),c(3),b(" ",e.categoryName," "),c(2),b("(",e.productCount," \u0645\u062D\u0635\u0648\u0644)")}}function Zn(t,r){if(t&1&&(o(0,"div",19)(1,"div",23)(2,"span",24)(3,"span",22),l(4,"label"),a(),l(5," \u06AF\u0631\u0648\u0647\u200C\u0647\u0627 "),a()(),o(6,"div",25),T(7,Xn,10,8,"button",26,M),a()()),t&2){let e=u(3);c(7),I(e.searchResults().categoryGroups)}}function Jn(t,r){if(t&1&&g(0,"img",36),t&2){let e=u().$implicit;y("src",e.imageUrl,Ie)("alt",e.name)}}function er(t,r){t&1&&(o(0,"div",37)(1,"span",40),l(2,"image"),a()())}function tr(t,r){t&1&&(o(0,"div",39)(1,"span",41),l(2,"\u062A\u062E\u0641\u06CC\u0641"),a()())}function ir(t,r){t&1&&(o(0,"div",39)(1,"span",42),l(2,"\u0646\u0627\u0645\u0648\u062C\u0648\u062F"),a()())}function nr(t,r){if(t&1){let e=x();o(0,"button",27),h("click",function(){let n=_(e).$implicit,s=u(4);return C(s.onSelectItem({type:"product",data:n}))}),o(1,"div",35),m(2,Jn,1,2,"img",36),m(3,er,3,0,"div",37),a(),o(4,"div",29),g(5,"div",32),$(6,"highlight"),o(7,"div",33),l(8),a(),o(9,"div",38),l(10),a()(),m(11,tr,3,0,"div",39),m(12,ir,3,0,"div",39),a()}if(t&2){let e=r.$implicit,i=r.$index,n=u(4);z("active",n.activeIndex()===(n.searchResults().categories.length||0)+(n.searchResults().categoryGroups.length||0)+i),c(2),p(e.imageUrl?2:-1),c(),p(e.imageUrl?-1:3),c(2),y("innerHTML",be(6,9,e.name,n.searchControl.value),Pe),c(3),b(" ",e.categoryGroupName," "),c(2),b(" ",n.formatPrice(e.price)," "),c(),p((e.discountPercentage||0)>0?11:-1),c(),p(e.inStock?-1:12)}}function rr(t,r){if(t&1&&(o(0,"div")(1,"div",23)(2,"span",24)(3,"span",22),l(4,"inventory_2"),a(),l(5," \u0645\u062D\u0635\u0648\u0644\u0627\u062A "),a()(),o(6,"div",25),T(7,nr,13,12,"button",26,M),a()()),t&2){let e=u(3);c(7),I(e.searchResults().products)}}function or(t,r){if(t&1){let e=x();o(0,"div"),m(1,Kn,9,0,"div",19),m(2,Zn,9,0,"div",19),m(3,rr,9,0,"div"),o(4,"div",20)(5,"button",21),h("click",function(){_(e);let n=u(2);return C(n.onSubmitSearch())}),o(6,"span",22),l(7,"arrow_back"),a(),l(8),a()()()}if(t&2){let e,i,n,s=u(2);c(),p((e=s.searchResults())!=null&&e.categories&&s.searchResults().categories.length>0?1:-1),c(),p((i=s.searchResults())!=null&&i.categoryGroups&&s.searchResults().categoryGroups.length>0?2:-1),c(),p((n=s.searchResults())!=null&&n.products&&s.searchResults().products.length>0?3:-1),c(5),b(" \u0645\u0634\u0627\u0647\u062F\u0647 \u0647\u0645\u0647 \u0646\u062A\u0627\u06CC\u062C (",s.totalResults(),") ")}}function ar(t,r){if(t&1&&(o(0,"div",7),m(1,Gn,4,0,"div",11),m(2,Wn,5,1,"div",11),m(3,Yn,7,0,"div",11),m(4,or,9,4,"div"),a()),t&2){let e=u();c(),p(e.isSearching()?1:-1),c(),p(e.error()&&!e.isSearching()?2:-1),c(),p(e.isEmpty()?3:-1),c(),p(e.hasResults()&&!e.isSearching()?4:-1)}}var Pi=(()=>{class t{constructor(){this.searchService=v(Ue),this.validationService=v(we),this.router=v(X),this.route=v(De),this.el=v(xe),this.cdr=v(Vt),this.searchControl=new oe("",{nonNullable:!0}),this.searchResults=j(null),this.isSearching=j(!1),this.isOpen=j(!1),this.error=j(null),this.activeIndex=j(-1),this.destroy$=new N,this.flatResults=re(()=>{let e=this.searchResults();return e?[...(e.categories??[]).map(i=>({type:"category",data:i})),...(e.categoryGroups??[]).map(i=>({type:"group",data:i})),...(e.products??[]).map(i=>({type:"product",data:i}))]:[]}),this.totalResults=re(()=>this.flatResults().length),this.hasResults=re(()=>this.totalResults()>0),this.isEmpty=re(()=>!this.isSearching()&&this.searchControl.value.length>=2&&this.totalResults()===0)}ngOnInit(){this.bindAutocomplete(),this.bindSearchState(),this.syncFromUrl()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.scrollTimer&&clearTimeout(this.scrollTimer)}bindAutocomplete(){this.searchService.getSearchSuggestions(this.searchControl.valueChanges).pipe(R(()=>{this.error.set(null),this.isOpen.set(!0)}),w(this.destroy$)).subscribe(e=>{this.searchResults.set(e),this.activeIndex.set(-1),this.cdr.markForCheck()})}bindSearchState(){this.searchService.searchState$.pipe(w(this.destroy$)).subscribe(e=>{this.isSearching.set(e.isSearching),e.error&&this.error.set(e.error),this.cdr.markForCheck()})}syncFromUrl(){this.route.queryParams.pipe(w(this.destroy$)).subscribe(e=>{let i=e.q;i&&i!==this.searchControl.value&&this.searchControl.setValue(i,{emitEvent:!1})})}onInputFocus(){this.searchControl.value.length>=2&&this.isOpen.set(!0)}onClearSearch(){this.searchControl.setValue(""),this.searchResults.set(null),this.error.set(null),this.isOpen.set(!1),this.activeIndex.set(-1),this.searchInput.nativeElement.focus()}onSubmitSearch(){let e=this.searchControl.value.trim();if(e.length<2)return;let i=this.validationService.validateSearchQuery(e);if(!i.isValid){this.error.set(i.errors?.[0]??null);return}this.isOpen.set(!1),this.router.navigate(["/search"],{queryParams:{q:i.sanitizedValue}})}onSelectItem(e){this.isOpen.set(!1),e.type==="category"&&this.router.navigate(["/category",e.data.categoryId]),e.type==="group"&&this.router.navigate(["/products/category-group",e.data.categoryGroupId]),e.type==="product"&&this.router.navigate(["/products",e.data.productId])}onOutsideClick(e){this.el.nativeElement.contains(e.target)||(this.isOpen.set(!1),this.activeIndex.set(-1))}onKey(e){let i=this.flatResults();if(!(!this.isOpen()||i.length===0)){if(e.key==="ArrowDown"&&(e.preventDefault(),this.activeIndex.set((this.activeIndex()+1)%i.length),this.scrollToActive()),e.key==="ArrowUp"&&(e.preventDefault(),this.activeIndex.set((this.activeIndex()-1+i.length)%i.length),this.scrollToActive()),e.key==="Enter"){e.preventDefault();let n=this.activeIndex();n>=0?this.onSelectItem(i[n]):this.onSubmitSearch()}e.key==="Escape"&&(this.isOpen.set(!1),this.activeIndex.set(-1))}}scrollToActive(){this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(()=>{this.el.nativeElement.querySelector(".search-item.active")?.scrollIntoView({block:"nearest"})})}formatPrice(e){return new Intl.NumberFormat("fa-IR").format(e)+" \u062A\u0648\u0645\u0627\u0646"}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=k({type:t,selectors:[["app-search"]],viewQuery:function(i,n){if(i&1&&Ot(Hn,5),i&2){let s;Lt(s=Dt())&&(n.searchInput=s.first)}},hostBindings:function(i,n){i&1&&h("click",function(d){return n.onOutsideClick(d)},pe)("keydown",function(d){return n.onKey(d)})},decls:9,vars:4,consts:[["searchInput",""],[1,"relative","w-full","search-container"],[1,"relative"],["type","text","placeholder","\u062C\u0633\u062A\u062C\u0648 \u062F\u0631 \u0645\u062D\u0635\u0648\u0644\u0627\u062A...","aria-label","\u062C\u0633\u062A\u062C\u0648","autocomplete","off",1,"input","input-md","w-full","pr-10","pl-10","bg-muted/50","border-border","focus:bg-background","focus:border-primary","transition-all",3,"focus","keydown.enter","formControl"],[1,"material-icons","absolute","right-3","top-1/2","-translate-y-1/2","text-muted-foreground","pointer-events-none"],[1,"absolute","left-3","top-1/2","-translate-y-1/2"],["type","button","aria-label","\u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u062C\u0633\u062A\u062C\u0648",1,"absolute","left-3","top-1/2","-translate-y-1/2","btn","btn-ghost","btn-icon","btn-sm","hover:bg-accent"],[1,"search-dropdown","absolute","top-full","left-0","right-0","mt-2","bg-popover","border","border-border","rounded-xl","shadow-dropdown","overflow-hidden","z-50","animate-fade-in-down","max-h-[500px]","overflow-y-auto"],[1,"loading","loading-spinner","loading-sm","text-primary"],["type","button","aria-label","\u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u062C\u0633\u062A\u062C\u0648",1,"absolute","left-3","top-1/2","-translate-y-1/2","btn","btn-ghost","btn-icon","btn-sm","hover:bg-accent",3,"click"],[1,"material-icons","text-lg"],[1,"p-8","text-center"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"text-sm","text-muted-foreground","mt-3"],[1,"material-icons","text-4xl","text-destructive","mb-2"],[1,"text-sm","text-destructive"],[1,"material-icons","text-4xl","text-muted-foreground","mb-2"],[1,"text-sm","text-muted-foreground"],[1,"text-xs","text-muted-foreground","mt-2"],[1,"border-b","border-border"],[1,"p-3","border-t","border-border","bg-muted/20"],["type","button",1,"w-full","btn","btn-outline","btn-sm","hover:bg-primary","hover:text-primary-foreground","hover:border-primary","transition-colors",3,"click"],[1,"material-icons","text-base"],[1,"px-4","py-2","bg-muted/30","sticky","top-0","backdrop-blur-sm","z-10"],[1,"text-xs","font-semibold","text-muted-foreground","flex","items-center","gap-2"],[1,"p-2"],["type","button",1,"search-item","w-full","text-right","px-3","py-2.5","hover:bg-accent","rounded-lg","transition-colors","flex","items-center","gap-3","group",3,"active"],["type","button",1,"search-item","w-full","text-right","px-3","py-2.5","hover:bg-accent","rounded-lg","transition-colors","flex","items-center","gap-3","group",3,"click"],[1,"material-icons-outlined","text-muted-foreground","group-hover:text-accent-foreground"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-foreground","group-hover:text-accent-foreground",3,"innerHTML"],[1,"text-xs","text-muted-foreground","mr-2"],[1,"text-sm","font-medium","text-foreground","group-hover:text-accent-foreground","truncate",3,"innerHTML"],[1,"text-xs","text-muted-foreground","truncate"],[1,"mr-1"],[1,"w-12","h-12","rounded-lg","overflow-hidden","flex-shrink-0","bg-muted","border","border-border"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"w-full","h-full","flex","items-center","justify-center"],[1,"text-xs","font-semibold","text-primary","mt-1"],[1,"flex-shrink-0"],[1,"material-icons","text-muted-foreground"],[1,"badge","badge-sm","badge-destructive"],[1,"badge","badge-sm","badge-outline"]],template:function(i,n){if(i&1){let s=x();o(0,"div",1)(1,"div",2)(2,"input",3,0),h("focus",function(){return _(s),C(n.onInputFocus())})("keydown.enter",function(){return _(s),C(n.onSubmitSearch())}),a(),o(4,"span",4),l(5," search "),a(),m(6,Bn,2,0,"div",5),m(7,qn,3,0,"button",6),a(),m(8,ar,5,4,"div",7),a()}i&2&&(c(2),y("formControl",n.searchControl),c(4),p(n.isSearching()?6:-1),c(),p(n.searchControl.value&&!n.isSearching()?7:-1),c(),p(n.isOpen()&&n.searchControl.value&&n.searchControl.value.length>=2?8:-1))},dependencies:[je,$e,Ve,li,B,Ri],styles:['.search-container[_ngcontent-%COMP%]{position:relative;z-index:100}.search-dropdown[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInDown .2s ease-out;box-shadow:0 10px 25px -5px #0000001a,0 10px 10px -5px #0000000a}.search-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.search-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.search-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:hsl(var(--border));border-radius:4px}.search-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:hsl(var(--muted-foreground)/.3)}.search-item.active[_ngcontent-%COMP%]{background-color:hsl(var(--accent));color:hsl(var(--accent-foreground))}.search-item.active[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%], .search-item.active[_ngcontent-%COMP%]   .material-icons-outlined[_ngcontent-%COMP%]{color:hsl(var(--accent-foreground))}.search-item[_ngcontent-%COMP%]:focus-visible{outline:2px solid hsl(var(--primary));outline-offset:-2px}@keyframes _ngcontent-%COMP%_fadeInDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_spin-slow{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-fade-in-down[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInDown .2s ease-out}.loading-spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin-slow 1s linear infinite}@media(max-width:768px){.search-dropdown[_ngcontent-%COMP%]{max-height:400px}}  .highlight{background-color:hsl(var(--primary)/.2);font-weight:600;color:hsl(var(--primary));padding:0 2px;border-radius:2px}.search-container[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{transition-property:color,background-color,border-color;transition-duration:.15s;transition-timing-function:cubic-bezier(.4,0,.2,1)}img[src=""][_ngcontent-%COMP%], img[_ngcontent-%COMP%]:not([src]){background:hsl(var(--muted))}'],changeDetection:0})}}return t})();var lr=()=>({exact:!0});function cr(t,r){if(t&1){let e=x();o(0,"div",14)(1,"div",30)(2,"app-brand-menu",31),h("itemClicked",function(){_(e);let n=u();return C(n.closeCategoryMenu())}),a()()()}t&2&&y("@dropdownAnimation",void 0)}function ur(t,r){if(t&1){let e=x();o(0,"a",42),h("click",function(){_(e);let n=u(3);return C(n.closeMenu())}),o(1,"span",39),l(2,"admin_panel_settings"),a(),l(3," \u067E\u0646\u0644 \u0627\u062F\u0645\u06CC\u0646 "),a()}}function dr(t,r){if(t&1){let e=x();o(0,"div",35)(1,"div",36),l(2),$(3,"async"),a(),o(4,"div",37)(5,"a",38),h("click",function(){_(e);let n=u(2);return C(n.closeMenu())}),o(6,"span",39),l(7,"dashboard"),a(),l(8," \u062F\u0627\u0634\u0628\u0648\u0631\u062F "),a(),m(9,ur,4,0,"a",40),$(10,"async"),o(11,"button",41),h("click",function(){_(e);let n=u(2);return C(n.logout())}),o(12,"span",39),l(13,"logout"),a(),l(14," \u062E\u0631\u0648\u062C "),a()()()}if(t&2){let e,i=u(2);y("@slideFade",void 0),c(2),b(" ",((e=K(3,3,i.userProfile$))==null?null:e.firstName)||"\u06A9\u0627\u0631\u0628\u0631"," \u0639\u0632\u06CC\u0632\u060C \u062E\u0648\u0634 \u0622\u0645\u062F\u06CC\u062F "),c(7),p(K(10,5,i.isAdmin$)?9:-1)}}function mr(t,r){if(t&1){let e=x();g(0,"app-notification-bell"),o(1,"div",32)(2,"button",33),h("click",function(n){_(e);let s=u();return C(s.toggleMenu(n))}),o(3,"span",34),l(4,"person"),a()(),m(5,dr,15,7,"div",35),a()}if(t&2){let e=u();c(5),p(e.isMenuOpen?5:-1)}}function pr(t,r){t&1&&(o(0,"a",43),l(1," \u0648\u0631\u0648\u062F | \u062B\u0628\u062A\u200C\u0646\u0627\u0645 "),a(),o(2,"a",44)(3,"span",20),l(4,"login"),a()())}function hr(t,r){if(t&1&&(o(0,"span",25),l(1),a()),t&2){let e=r;c(),b(" ",e>9?"9+":e," ")}}function fr(t,r){if(t&1){let e=x();o(0,"div",45),h("click",function(){_(e);let n=u();return C(n.toggleSearchMobile())}),a()}}function gr(t,r){t&1&&(o(0,"div",27),g(1,"app-search"),a())}function _r(t,r){if(t&1){let e=x();o(0,"div",46),h("click",function(){_(e);let n=u();return C(n.isMobileMenuOpen=!1)}),a()}}function Cr(t,r){if(t&1){let e=x();o(0,"a",52),h("click",function(){_(e);let n=u(2);return C(n.isMobileMenuOpen=!1)}),o(1,"span",53),l(2),a(),l(3),a()}if(t&2){let e=r.$implicit;y("routerLink",e.link),c(2),F(e.icon),c(),b(" ",e.title," ")}}function vr(t,r){if(t&1){let e=x();o(0,"div",29)(1,"div",47)(2,"span",48),l(3,"\u0641\u0647\u0631\u0633\u062A"),a(),o(4,"button",49),h("click",function(){_(e);let n=u();return C(n.isMobileMenuOpen=!1)}),o(5,"span",20),l(6,"close"),a()()(),o(7,"nav",50),T(8,Cr,4,3,"a",51,M),a()()}if(t&2){let e=u();c(8),I(e.mobileMenuItems)}}var Oi=(()=>{class t{constructor(e,i,n,s,d){this.authService=e,this.cartService=i,this.elementRef=n,this.renderer=s,this.platformId=d,this.isMenuOpen=!1,this.isMobileMenuOpen=!1,this.isMobileSearchOpen=!1,this.isCategoryMenuOpen=!1,this.isScrolled=!1,this.isDarkMode=!1,this.destroy$=new N,this.mobileMenuItems=[{title:"\u062E\u0627\u0646\u0647",link:"/",icon:"home"},{title:"\u0645\u062D\u0635\u0648\u0644\u0627\u062A",link:"/products",icon:"storefront"},{title:"\u062A\u062E\u0641\u06CC\u0641\u200C\u0647\u0627",link:"/discounts",icon:"local_offer"}]}onWindowScroll(){this.isScrolled=window.scrollY>20}onDocumentClick(e){let i=this.elementRef.nativeElement.querySelector(".user-menu-container");i&&!i.contains(e.target)&&(this.isMenuOpen=!1)}ngOnInit(){this.isLoggedIn$=this.authService.isLoggedIn$,this.userProfile$=this.authService.userProfile$,this.cartItemCount$=this.cartService.cartItemCount$,this.isAdmin$=this.userProfile$.pipe(ge(e=>e?.isAdmin??!1)),this.isLoggedIn$.pipe(se(),w(this.destroy$)).subscribe(e=>{e?this.cartService.getCartItemsCount().subscribe():this.cartService.clearLocalCart()}),this.authService.isAuthenticated()&&this.cartService.getMyCart().subscribe(),this.initTheme()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}toggleMenu(e){e.stopPropagation(),this.isMenuOpen=!this.isMenuOpen}closeMenu(){this.isMenuOpen=!1}toggleSearchMobile(){this.isMobileSearchOpen=!this.isMobileSearchOpen}showCategoryMenu(){clearTimeout(this.hoverTimeout),this.isCategoryMenuOpen=!0}hideCategoryMenu(){this.hoverTimeout=setTimeout(()=>{this.isCategoryMenuOpen=!1},150)}closeCategoryMenu(){this.isCategoryMenuOpen=!1}logout(){this.closeMenu(),this.authService.logout()}initTheme(){if(Y(this.platformId)){let e=localStorage.getItem("theme"),i=window.matchMedia("(prefers-color-scheme: dark)").matches;e==="dark"||!e&&i?(this.isDarkMode=!0,this.renderer.addClass(document.documentElement,"dark")):(this.isDarkMode=!1,this.renderer.removeClass(document.documentElement,"dark"))}}toggleTheme(){document.documentElement.classList.add("theme-transitioning"),this.isDarkMode=!this.isDarkMode,this.isDarkMode?(this.renderer.addClass(document.documentElement,"dark"),localStorage.setItem("theme","dark")):(this.renderer.removeClass(document.documentElement,"dark"),localStorage.setItem("theme","light")),setTimeout(()=>{document.documentElement.classList.remove("theme-transitioning")},300)}static{this.\u0275fac=function(i){return new(i||t)(S(Q),S(he),S(xe),S(Et),S(le))}}static{this.\u0275cmp=k({type:t,selectors:[["app-header"]],hostBindings:function(i,n){i&1&&h("scroll",function(){return n.onWindowScroll()},bt)("click",function(d){return n.onDocumentClick(d)},pe)},decls:48,vars:19,consts:[[1,"sticky","top-0","z-50","w-full","border-b","border-border","bg-background/95","backdrop-blur","supports-[backdrop-filter]:bg-background/60","transition-all","duration-300","ease-in-out","h-16","flex","items-center"],[1,"container","flex","items-center","h-full","gap-4"],[1,"flex","items-center","lg:hidden"],["aria-label","\u0645\u0646\u0648",1,"btn","btn-ghost","btn-icon","active:scale-95","transition-transform",3,"click"],[1,"material-icons","text-2xl"],[1,"flex","items-center","gap-2","mr-auto","lg:mr-0"],["routerLink","/","aria-label","\u0628\u0627\u0632\u06AF\u0634\u062A \u0628\u0647 \u0635\u0641\u062D\u0647 \u0627\u0635\u0644\u06CC",1,"flex","items-center","gap-2","transition-transform","hover:scale-105","active:scale-95"],["src","/assets/icons/ledka-icon.jpg","alt","\u0644\u0648\u06AF\u0648 \u0641\u0631\u0648\u0634\u06AF\u0627\u0647","width","36","height","36",1,"h-9","w-auto","rounded-md","shadow-sm"],[1,"hidden","sm:inline-block","text-xl","font-bold","bg-gradient-to-r","from-primary","to-primary-600","bg-clip-text","text-transparent"],[1,"hidden","lg:flex","items-center","gap-1","text-sm","font-medium","mx-4"],["routerLink","/","routerLinkActive","bg-primary/10 text-primary",1,"nav-item",3,"routerLinkActiveOptions"],[1,"relative","h-full","flex","items-center","group",3,"mouseenter","mouseleave"],[1,"nav-item","group-hover:bg-primary/10","group-hover:text-primary"],[1,"material-icons","text-lg"],[1,"absolute","top-full","right-0","w-[800px]","pt-4"],["routerLink","/products","routerLinkActive","bg-primary/10 text-primary",1,"nav-item"],["routerLink","/discounts","routerLinkActive","bg-primary/10 text-primary",1,"nav-item"],[1,"hidden","lg:flex","flex-1","max-w-md","mx-4"],[1,"flex","items-center","justify-end","gap-1","sm:gap-2"],["aria-label","\u062C\u0633\u062A\u062C\u0648",1,"btn","btn-ghost","btn-icon","lg:hidden","hover:bg-primary/10","hover:text-primary",3,"click"],[1,"material-icons"],[1,"btn","btn-ghost","btn-icon","hover:bg-primary/10","hover:text-primary",3,"click"],[1,"h-6","w-px","bg-border","mx-2","hidden","sm:block"],["routerLink","/cart","aria-label","\u0633\u0628\u062F \u062E\u0631\u06CC\u062F",1,"relative","icon-wrapper","icon-wrapper-md","hover:bg-primary/10","hover:text-primary","rounded-full","border","border-transparent","hover:border-border","transition-all","ml-1","cursor-pointer"],[1,"material-icons-outlined","text-foreground"],[1,"absolute","-top-1","-right-1","flex","h-5","w-5","items-center","justify-center","rounded-full","bg-destructive","text-[10px]","font-bold","text-white","ring-2","ring-background","animate-in","zoom-in"],[1,"mobile-search-overlay"],[1,"absolute","top-full","left-0","right-0","bg-background","border-b","border-border","p-4","shadow-lg","z-50","animate-fade-in-down","lg:hidden"],[1,"mobile-menu-overlay"],[1,"drawer","drawer-left","w-full","max-w-sm","p-6","mobile-menu-sidebar"],[1,"bg-popover","rounded-xl","overflow-hidden","shadow-dropdown","border","border-border"],[3,"itemClicked"],[1,"relative","user-menu-container","ml-1"],["aria-label","\u0645\u0646\u0648\u06CC \u06A9\u0627\u0631\u0628\u0631",1,"icon-wrapper","icon-wrapper-md","hover:bg-primary/10","hover:text-primary","rounded-full","border","border-transparent","hover:border-border","transition-all","cursor-pointer",3,"click"],[1,"material-icons","text-foreground"],[1,"dropdown-content","left-0","mt-2","w-56","origin-top-left"],[1,"dropdown-header","border-b","border-border"],[1,"p-1"],["routerLink","/dashboard",1,"dropdown-item","rounded-md",3,"click"],[1,"material-icons-outlined","text-lg"],["routerLink","/admin",1,"dropdown-item","rounded-md"],[1,"dropdown-item","rounded-md","text-destructive","hover:bg-destructive/10","hover:text-destructive",3,"click"],["routerLink","/admin",1,"dropdown-item","rounded-md",3,"click"],["routerLink","/auth",1,"btn","btn-primary","btn-sm","rounded-full","px-6","shadow-sm","hidden","md:inline-flex"],["routerLink","/auth","aria-label","\u0648\u0631\u0648\u062F",1,"btn","btn-ghost","btn-icon","md:hidden","text-primary"],[1,"mobile-search-overlay",3,"click"],[1,"mobile-menu-overlay",3,"click"],[1,"flex","items-center","justify-between","mb-8"],[1,"text-lg","font-bold","text-foreground"],[1,"btn","btn-ghost","btn-icon","-mr-2",3,"click"],[1,"flex","flex-col","gap-2"],["routerLinkActive","bg-primary/10 text-primary",1,"flex","items-center","gap-4","rounded-lg","px-4","py-3","text-sm","font-medium","hover:bg-primary/10","hover:text-primary","transition-colors",3,"routerLink"],["routerLinkActive","bg-primary/10 text-primary",1,"flex","items-center","gap-4","rounded-lg","px-4","py-3","text-sm","font-medium","hover:bg-primary/10","hover:text-primary","transition-colors",3,"click","routerLink"],[1,"material-icons-outlined","text-xl"]],template:function(i,n){if(i&1&&(o(0,"header",0)(1,"div",1)(2,"div",2)(3,"button",3),h("click",function(){return n.isMobileMenuOpen=!n.isMobileMenuOpen}),o(4,"span",4),l(5,"menu"),a()()(),o(6,"div",5)(7,"a",6),g(8,"img",7),o(9,"span",8),l(10,"\u0641\u0631\u0648\u0634\u06AF\u0627\u0647 \u0644\u0650\u062F\u06A9\u0627"),a()()(),o(11,"nav",9)(12,"a",10),l(13,"\u062E\u0627\u0646\u0647"),a(),o(14,"div",11),h("mouseenter",function(){return n.showCategoryMenu()})("mouseleave",function(){return n.hideCategoryMenu()}),o(15,"button",12)(16,"span",13),l(17,"category"),a(),l(18," \u062F\u0633\u062A\u0647 \u0628\u0646\u062F\u06CC \u0645\u062D\u0635\u0648\u0644\u0627\u062A "),a(),m(19,cr,3,1,"div",14),a(),o(20,"a",15),l(21," \u0645\u062D\u0635\u0648\u0644\u0627\u062A "),a(),o(22,"a",16)(23,"span",13),l(24,"local_offer"),a(),l(25," \u062A\u062E\u0641\u06CC\u0641\u200C\u0647\u0627 "),a()(),o(26,"div",17),g(27,"app-search"),a(),o(28,"div",18)(29,"button",19),h("click",function(){return n.toggleSearchMobile()}),o(30,"span",20),l(31,"search"),a()(),o(32,"button",21),h("click",function(){return n.toggleTheme()}),o(33,"span",20),l(34),a()(),g(35,"div",22),m(36,mr,6,1),$(37,"async"),At(38,pr,5,0),o(39,"a",23)(40,"span",24),l(41,"shopping_cart"),a(),m(42,hr,2,1,"span",25),$(43,"async"),a()()(),m(44,fr,1,0,"div",26),m(45,gr,2,0,"div",27),m(46,_r,1,0,"div",28),m(47,vr,10,0,"div",29),a()),i&2){let s;z("shadow-md",n.isScrolled)("bg-background/95",n.isScrolled),c(12),y("routerLinkActiveOptions",ye(18,lr)),c(7),p(n.isCategoryMenuOpen?19:-1),c(13),It("aria-label",n.isDarkMode?"\u062A\u063A\u06CC\u06CC\u0631 \u0628\u0647 \u062D\u0627\u0644\u062A \u0631\u0648\u0634\u0646":"\u062A\u063A\u06CC\u06CC\u0631 \u0628\u0647 \u062D\u0627\u0644\u062A \u062A\u0627\u0631\u06CC\u06A9"),c(2),b(" ",n.isDarkMode?"light_mode":"dark_mode"," "),c(2),p(K(37,14,n.isLoggedIn$)?36:38),c(6),p((s=K(43,16,n.cartItemCount$))?42:-1,s),c(2),p(n.isMobileSearchOpen?44:-1),c(),p(n.isMobileSearchOpen?45:-1),c(),p(n.isMobileMenuOpen?46:-1),c(),p(n.isMobileMenuOpen?47:-1)}},dependencies:[ue,B,Z,Xt,Ii,Ai,Pi,Oe],encapsulation:2,data:{animation:[de("slideFade",[W(":enter",[O({opacity:0,transform:"translateY(-10px)"}),G("150ms ease-out",O({opacity:1,transform:"translateY(0)"}))]),W(":leave",[G("150ms ease-in",O({opacity:0,transform:"translateY(-10px)"}))])]),de("dropdownAnimation",[W(":enter",[O({opacity:0,transform:"translateY(10px)"}),G("200ms ease-out",O({opacity:1,transform:"translateY(0)"}))]),W(":leave",[G("150ms ease-in",O({opacity:0,transform:"translateY(10px)"}))])])]}})}}return t})();var Di=(()=>{class t{constructor(e){this.notificationService=e,this.newsletterEmail="",this.currentYear=new Date().getFullYear()}subscribeNewsletter(){if(this.newsletterEmail){if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(this.newsletterEmail)){this.notificationService.show("\u0644\u0637\u0641\u0627 \u06CC\u06A9 \u0627\u06CC\u0645\u06CC\u0644 \u0645\u0639\u062A\u0628\u0631 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F","error");return}this.notificationService.show("\u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u062F\u0631 \u062E\u0628\u0631\u0646\u0627\u0645\u0647 \u0639\u0636\u0648 \u0634\u062F\u06CC\u062F","success"),this.newsletterEmail=""}else this.notificationService.show("\u0644\u0637\u0641\u0627 \u0627\u06CC\u0645\u06CC\u0644 \u062E\u0648\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F","error")}scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}static{this.\u0275fac=function(i){return new(i||t)(S(q))}}static{this.\u0275cmp=k({type:t,selectors:[["app-footer"]],decls:71,vars:1,consts:[[1,"relative","mt-24"],[1,"wave-divider","text-muted/20","dark:text-muted/10","absolute","top-0","left-0","right-0","-translate-y-[99%]","z-10","w-full"],["viewBox","0 0 1200 120","preserveAspectRatio","none"],["d","M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"],[1,"bg-muted/20","dark:bg-muted/10","pt-16","pb-8","border-t","border-border"],[1,"container"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-12","mb-12"],[1,"space-y-6"],["routerLink","/",1,"flex","items-center","gap-3","group"],["src","/assets/icons/ledka-icon.jpg","alt","Ledka Logo",1,"w-12","h-12","rounded-xl","shadow-sm","transition-transform","group-hover:scale-105"],[1,"text-2xl","font-black","text-foreground","tracking-tight"],[1,"text-sm","text-foreground/70","leading-7","text-justify"],[1,"flex","gap-3"],["href","#","aria-label","Instagram",1,"icon-wrapper","icon-wrapper-md","icon-wrapper-circle","icon-wrapper-primary","bg-background","shadow-sm","hover:scale-110","transition-transform"],[1,"material-icons"],["href","#","aria-label","Twitter",1,"icon-wrapper","icon-wrapper-md","icon-wrapper-circle","icon-wrapper-info","bg-background","shadow-sm","hover:scale-110","transition-transform"],["href","#","aria-label","Whatsapp",1,"icon-wrapper","icon-wrapper-md","icon-wrapper-circle","icon-wrapper-success","bg-background","shadow-sm","hover:scale-110","transition-transform"],[1,"space-y-4"],[1,"font-bold","text-foreground"],[1,"space-y-2","text-sm","text-foreground/70"],["routerLink","/products",1,"hover:text-primary","transition-colors","block","py-1"],["routerLink","/discounts",1,"hover:text-primary","transition-colors","block","py-1"],["routerLink","/blog",1,"hover:text-primary","transition-colors","block","py-1"],["routerLink","/about",1,"hover:text-primary","transition-colors","block","py-1"],["href","#",1,"hover:text-primary","transition-colors","block","py-1"],[1,"grid","grid-cols-2","gap-4"],[1,"card","bg-background","p-4","flex","items-center","justify-center","aspect-square","hover:shadow-md","transition-shadow"],[1,"text-xs","text-muted-foreground"],[1,"border-t","border-border/50","pt-8","flex","flex-col","md:flex-row","justify-between","items-center","gap-4","text-sm","text-foreground/60"],[1,"font-mono","dir-ltr","opacity-70","hover:opacity-100","transition-opacity"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"div",1),pt(),o(2,"svg",2),g(3,"path",3),a()(),ht(),o(4,"footer",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"a",8),g(9,"img",9),o(10,"span",10),l(11,"\u0644\u0650\u062F\u06A9\u0627"),a()(),o(12,"p",11),l(13," \u062A\u062C\u0631\u0628\u0647 \u062E\u0631\u06CC\u062F \u0622\u0646\u0644\u0627\u06CC\u0646 \u0645\u0637\u0645\u0626\u0646 \u0628\u0627 \u06AF\u0627\u0631\u0627\u0646\u062A\u06CC \u0627\u0635\u0627\u0644\u062A \u06A9\u0627\u0644\u0627. \u0645\u0627 \u062F\u0631 \u0644\u0650\u062F\u06A9\u0627 \u0645\u062A\u0639\u0647\u062F \u0628\u0647 \u0627\u0631\u0627\u0626\u0647 \u0628\u0647\u062A\u0631\u06CC\u0646 \u062E\u062F\u0645\u0627\u062A \u0648 \u0645\u062D\u0635\u0648\u0644\u0627\u062A \u0628\u0647 \u0634\u0645\u0627 \u0647\u0633\u062A\u06CC\u0645. "),a(),o(14,"div",12)(15,"a",13)(16,"span",14),l(17,"photo_camera"),a()(),o(18,"a",15)(19,"span",14),l(20,"public"),a()(),o(21,"a",16)(22,"span",14),l(23,"chat"),a()()()(),o(24,"div",17)(25,"h3",18),l(26,"\u062F\u0633\u062A\u0631\u0633\u06CC \u0633\u0631\u06CC\u0639"),a(),o(27,"ul",19)(28,"li")(29,"a",20),l(30,"\u0645\u062D\u0635\u0648\u0644\u0627\u062A"),a()(),o(31,"li")(32,"a",21),l(33,"\u062A\u062E\u0641\u06CC\u0641\u200C\u0647\u0627"),a()(),o(34,"li")(35,"a",22),l(36,"\u0628\u0644\u0627\u06AF"),a()(),o(37,"li")(38,"a",23),l(39,"\u062F\u0631\u0628\u0627\u0631\u0647 \u0645\u0627"),a()()()(),o(40,"div",17)(41,"h3",18),l(42,"\u062E\u062F\u0645\u0627\u062A \u0645\u0634\u062A\u0631\u06CC\u0627\u0646"),a(),o(43,"ul",19)(44,"li")(45,"a",24),l(46,"\u067E\u0631\u0633\u0634\u200C\u0647\u0627\u06CC \u0645\u062A\u062F\u0627\u0648\u0644"),a()(),o(47,"li")(48,"a",24),l(49,"\u0634\u0631\u0627\u06CC\u0637 \u0648 \u0642\u0648\u0627\u0646\u06CC\u0646"),a()(),o(50,"li")(51,"a",24),l(52,"\u062D\u0631\u06CC\u0645 \u062E\u0635\u0648\u0635\u06CC"),a()(),o(53,"li")(54,"a",24),l(55,"\u0631\u0648\u06CC\u0647 \u0628\u0627\u0632\u06AF\u0631\u062F\u0627\u0646\u062F\u0646 \u06A9\u0627\u0644\u0627"),a()()()(),o(56,"div",17)(57,"h3",18),l(58,"\u0646\u0645\u0627\u062F \u0627\u0639\u062A\u0645\u0627\u062F"),a(),o(59,"div",25)(60,"div",26)(61,"span",27),l(62,"ENAMAD"),a()(),o(63,"div",26)(64,"span",27),l(65,"SAMANDEHI"),a()()()()(),o(66,"div",28)(67,"p"),l(68),a(),o(69,"p",29),l(70," Designed & Developed by Ledka Team "),a()()()()()),i&2&&(c(68),b("\u062A\u0645\u0627\u0645\u06CC \u062D\u0642\u0648\u0642 \u0628\u0631\u0627\u06CC \u0641\u0631\u0648\u0634\u06AF\u0627\u0647 \u0644\u0650\u062F\u06A9\u0627 \u0645\u062D\u0641\u0648\u0638 \u0627\u0633\u062A \xA9 ",n.currentYear))},dependencies:[B,Z,fi],encapsulation:2})}}return t})();var xr=(t,r,e)=>({"toast-success":t,"toast-error":r,"toast-info":e}),yr=(t,r,e)=>({"text-success":t,"text-destructive":r,"text-info":e});function br(t,r){if(t&1){let e=x();o(0,"div",0)(1,"div",1)(2,"span",2),l(3),a(),o(4,"p",3),l(5),a(),o(6,"button",4),h("click",function(){_(e);let n=u();return C(n.close())}),o(7,"span",5),l(8,"close"),a()()()()}if(t&2){let e=u();y("@slideInOut",void 0),c(),y("ngClass",Qe(5,xr,e.notification.type==="success",e.notification.type==="error",e.notification.type==="info")),c(),y("ngClass",Qe(9,yr,e.notification.type==="success",e.notification.type==="error",e.notification.type==="info")),c(),F(e.icon),c(2),F(e.notification.message)}}var Ni=(()=>{class t{constructor(e){this.notificationService=e,this.notification=null}ngOnInit(){this.subscription=this.notificationService.notification$.subscribe(e=>{this.notification=e,this.timer&&clearTimeout(this.timer),e&&(this.timer=setTimeout(()=>{this.close()},5e3))})}ngOnDestroy(){this.subscription.unsubscribe(),this.timer&&clearTimeout(this.timer)}get notificationClass(){if(!this.notification)return"";switch(this.notification.type){case"success":return"bg-success text-success-foreground";case"error":return"bg-destructive text-destructive-foreground";default:return"bg-blue-500 text-white"}}get icon(){if(!this.notification)return"";switch(this.notification.type){case"success":return"check_circle";case"error":return"error";case"info":return"info";default:return"info"}}close(){this.notificationService.clear()}static{this.\u0275fac=function(i){return new(i||t)(S(q))}}static{this.\u0275cmp=k({type:t,selectors:[["app-notification"]],decls:1,vars:1,consts:[[1,"fixed","top-5","left-1/2","-translate-x-1/2","z-toast","w-full","max-w-md","px-4"],[1,"toast","shadow-lg",3,"ngClass"],[1,"material-icons","text-xl",3,"ngClass"],[1,"text-sm","font-medium"],[1,"btn","btn-ghost","btn-icon","btn-sm","-my-2","ms-auto","rounded-full","hover:bg-black/5",3,"click"],[1,"material-icons","text-lg"]],template:function(i,n){i&1&&m(0,br,9,13,"div",0),i&2&&p(n.notification?0:-1)},dependencies:[ue,Fe],encapsulation:2,data:{animation:[de("slideInOut",[Xe("in",O({transform:"translate(-50%, 0)",opacity:1})),W("void => *",[O({transform:"translate(-50%, -100%)",opacity:0}),G("300ms ease-out")]),W("* => void",[G("300ms ease-in",O({transform:"translate(-50%, -100%)",opacity:0}))])])]}})}}return t})();var Ge=(()=>{class t{constructor(e,i,n,s){this.authService=e,this.notificationService=i,this.router=n,this.platformId=s,this.INACTIVITY_TIMEOUT=1800*1e3,this.WARNING_TIME=300*1e3,this.CHECK_INTERVAL=60*1e3,this.lastActivityTime=Date.now(),this.destroy$=new N,this.isMonitoring=!1,this.warningShown=!1}isPaymentPage(){if(!Y(this.platformId))return!1;let e=window.location.pathname.toLowerCase(),i=window.location.search.toLowerCase();return e.includes("/payment")||e.includes("/checkout")||e.includes("/callback")||i.includes("authority=")||i.includes("status=")}startSessionMonitoring(){if(!(!Y(this.platformId)||this.isMonitoring)){if(this.isPaymentPage()){console.log("[Session] Skipping session monitoring on payment page");return}this.isMonitoring=!0,this.lastActivityTime=Date.now(),this.warningShown=!1,this.setupActivityListeners(),this.resetInactivityTimer(),this.startPeriodicCheck()}}stopSessionMonitoring(){console.log("[Session] Stopping session monitoring"),this.isMonitoring=!1,this.clearTimers(),this.warningShown=!1}setupActivityListeners(){if(!Y(this.platformId))return;let e=[ae(document,"mousemove"),ae(document,"mousedown"),ae(document,"keypress"),ae(document,"scroll"),ae(document,"touchstart"),ae(document,"click")];at(...e).pipe(ct(1e4),w(this.destroy$)).subscribe(()=>{this.onUserActivity()}),ae(document,"visibilitychange").pipe(w(this.destroy$)).subscribe(()=>{document.hidden||this.onUserActivity()})}onUserActivity(){!this.isMonitoring||this.isPaymentPage()||(this.lastActivityTime=Date.now(),this.warningShown=!1,this.resetInactivityTimer())}resetInactivityTimer(){this.clearTimers(),this.warningTimer=setTimeout(()=>{this.isPaymentPage()||this.showInactivityWarning()},this.INACTIVITY_TIMEOUT-this.WARNING_TIME),this.inactivityTimer=setTimeout(()=>{this.isPaymentPage()||this.handleSessionTimeout()},this.INACTIVITY_TIMEOUT)}startPeriodicCheck(){_e(this.CHECK_INTERVAL,this.CHECK_INTERVAL).pipe(w(this.destroy$)).subscribe(()=>{if(!this.isMonitoring||this.isPaymentPage())return;let e=Date.now()-this.lastActivityTime;e>=this.INACTIVITY_TIMEOUT?this.handleSessionTimeout():e>=this.INACTIVITY_TIMEOUT-this.WARNING_TIME&&!this.warningShown&&this.showInactivityWarning()})}showInactivityWarning(){if(this.warningShown||!this.isMonitoring||this.isPaymentPage())return;this.warningShown=!0;let e=Math.floor(this.WARNING_TIME/6e4);this.notificationService.show(`\u0646\u0634\u0633\u062A \u0634\u0645\u0627 \u0628\u0647 \u062F\u0644\u06CC\u0644 \u0639\u062F\u0645 \u0641\u0639\u0627\u0644\u06CC\u062A ${e} \u062F\u0642\u06CC\u0642\u0647 \u062F\u06CC\u06AF\u0631 \u0645\u0646\u0642\u0636\u06CC \u0645\u06CC\u200C\u0634\u0648\u062F.  \u0628\u0631\u0627\u06CC \u0627\u062F\u0627\u0645\u0647\u060C \u0641\u0639\u0627\u0644\u06CC\u062A\u06CC \u0627\u0646\u062C\u0627\u0645 \u062F\u0647\u06CC\u062F. `,"info")}handleSessionTimeout(){!this.isMonitoring||this.isPaymentPage()||(this.stopSessionMonitoring(),this.notificationService.show("\u0646\u0634\u0633\u062A \u0634\u0645\u0627 \u0628\u0647 \u062F\u0644\u06CC\u0644 \u0639\u062F\u0645 \u0641\u0639\u0627\u0644\u06CC\u062A \u0645\u0646\u0642\u0636\u06CC \u0634\u062F. \u0644\u0637\u0641\u0627 \u0645\u062C\u062F\u062F\u0627 \u0648\u0627\u0631\u062F \u0634\u0648\u06CC\u062F.","info"),this.authService.logout(!0))}clearTimers(){this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null),this.warningTimer&&(clearTimeout(this.warningTimer),this.warningTimer=null)}getRemainingTime(){let e=Date.now()-this.lastActivityTime;return Math.max(0,this.INACTIVITY_TIMEOUT-e)}getRemainingTimeFormatted(){let e=this.getRemainingTime(),i=Math.floor(e/6e4),n=Math.floor(e%6e4/1e3);return`${i}:${n.toString().padStart(2,"0")}`}extendSession(){this.isMonitoring&&(this.onUserActivity(),this.notificationService.show("\u0646\u0634\u0633\u062A \u0634\u0645\u0627 \u062A\u0645\u062F\u06CC\u062F \u0634\u062F","success"))}isSessionActive(){return this.isMonitoring&&this.authService.isAuthenticated()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.stopSessionMonitoring()}static{this.\u0275fac=function(i){return new(i||t)(H(Q),H(q),H(X),H(le))}}static{this.\u0275prov=V({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Sr(t,r){t&1&&(ie(0,"span",12),l(1," \u062A\u0645\u062F\u06CC\u062F \u0646\u0634\u0633\u062A "),ie(2,"span",14),l(3,"refresh"),ne()())}function wr(t,r){t&1&&(ie(0,"span",13)(1,"span",15),l(2,"refresh"),ne(),l(3," \u062F\u0631 \u062D\u0627\u0644 \u062A\u0645\u062F\u06CC\u062F... "),ne())}function Er(t,r){if(t&1){let e=x();ie(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),l(6,"schedule"),ne()(),ie(7,"p",6),l(8,"\u0632\u0645\u0627\u0646 \u0628\u0627\u0642\u06CC\u0645\u0627\u0646\u062F\u0647 \u0646\u0634\u0633\u062A"),ne()(),ie(9,"p",7),l(10),ne()(),ie(11,"div",8),Rt(12,"div",9),ne(),ie(13,"div",10)(14,"button",11),Ft("click",function(){_(e);let n=u();return C(n.extendSession())}),m(15,Sr,4,0,"span",12),m(16,wr,4,0,"span",13),ne()()()()}if(t&2){let e=u();c(10),F(e.remainingTime),c(2),Nt("width",e.percent,"%"),c(2),Pt("disabled",e.isExtending),c(),p(e.isExtending?-1:15),c(),p(e.isExtending?16:-1)}}var Vi=(()=>{class t{constructor(e){this.sessionService=e,this.remainingTime="",this.showTimer=!1,this.isExtending=!1,this.percent=100,this.destroy$=new N,this.SHOW_TIMER_THRESHOLD=120*1e3}ngOnInit(){ot(1e3).pipe(w(this.destroy$),Ce(()=>this.sessionService.isSessionActive()),R(()=>{let e=this.sessionService.getRemainingTime();this.showTimer=e<this.SHOW_TIMER_THRESHOLD&&e>0,this.showTimer&&(this.remainingTime=this.sessionService.getRemainingTimeFormatted(),this.percent=Math.min(100,Math.max(0,e/this.SHOW_TIMER_THRESHOLD*100)))})).subscribe()}extendSession(){this.isExtending=!0,this.sessionService.extendSession(),setTimeout(()=>{this.isExtending=!1},1e3)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(i){return new(i||t)(S(Ge))}}static{this.\u0275cmp=k({type:t,selectors:[["app-session-timer"]],decls:1,vars:1,consts:[[1,"fixed","bottom-4","left-4","z-toast","animate-fade-in-up"],[1,"toast","toast-warning","shadow-lg","border-warning/50","flex-col","items-stretch","min-w-[280px]"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center","gap-2"],[1,"icon-wrapper","icon-wrapper-sm","icon-wrapper-warning","rounded-full"],[1,"material-icons","text-lg","icon-pulse"],[1,"text-xs","font-medium","text-foreground"],[1,"text-lg","font-bold","tabular-nums"],[1,"progress","h-1.5","w-full","bg-warning/20"],[1,"progress-bar","bg-warning"],[1,"mt-3","flex","justify-end"],[1,"btn","btn-sm","btn-warning","w-full","group",3,"click","disabled"],[1,"flex","items-center","justify-center","gap-1"],[1,"flex","items-center","justify-center","gap-2"],[1,"material-icons","icon-xs","group-hover:icon-spin"],[1,"material-icons","icon-spin"]],template:function(i,n){i&1&&m(0,Er,17,6,"div",0),i&2&&p(n.showTimer?0:-1)},encapsulation:2})}}return t})();var ji=(()=>{class t{constructor(e,i,n,s,d){this.sessionService=e,this.authService=i,this.cartService=n,this.router=s,this.platformId=d,this.destroy$=new N}isPaymentPage(){if(!Y(this.platformId))return!1;let e=window.location.pathname.toLowerCase(),i=window.location.search.toLowerCase();return e.includes("/payment")||e.includes("/callback")||i.includes("authority=")||i.includes("status=")}ngOnInit(){if(this.isPaymentPage()){console.log("[App] Payment page detected, skipping initialization");return}this.router.events.pipe(Ce(e=>e instanceof Qt),w(this.destroy$)).subscribe(e=>{let i=e.urlAfterRedirects.toLowerCase();(i.includes("/payment")||i.includes("/callback"))&&this.sessionService.stopSessionMonitoring()}),this.authService.isLoggedIn$.pipe(w(this.destroy$)).subscribe(e=>{e&&!this.isPaymentPage()?(this.sessionService.startSessionMonitoring(),this.cartService.getMyCart().subscribe()):this.isPaymentPage()||(this.sessionService.stopSessionMonitoring(),this.cartService.clearLocalCart())}),this.authService.isAuthenticated()&&!this.isPaymentPage()&&this.sessionService.startSessionMonitoring()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(i){return new(i||t)(S(Ge),S(Q),S(he),S(X),S(le))}}static{this.\u0275cmp=k({type:t,selectors:[["app-root"]],decls:9,vars:0,consts:[["href","#main-content",1,"skip-link"],[1,"flex","flex-col","min-h-screen","bg-background","font-sans","antialiased","selection:bg-primary","selection:text-primary-foreground"],["id","main-content",1,"flex-grow","animate-fade-in","scroll-mt-24"]],template:function(i,n){i&1&&(o(0,"a",0),l(1,"\u0628\u0631\u06AF\u0634\u062A \u0628\u0647 \u0645\u062D\u062A\u0648\u0627\u06CC \u0627\u0635\u0644\u06CC"),a(),g(2,"app-notification")(3,"app-session-timer"),o(4,"div",1),g(5,"app-header"),o(6,"main",2),g(7,"router-outlet"),a(),g(8,"app-footer"),a())},dependencies:[Kt,Oi,Di,Ni,Vi],encapsulation:2})}}return t})();Ut(ji,Mi).catch(t=>console.error(t));
