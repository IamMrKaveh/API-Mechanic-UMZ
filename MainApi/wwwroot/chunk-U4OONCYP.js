import{a as Fe}from"./chunk-AI7IIPS3.js";import{a as me,b as _e,d as ge,e as fe,f as xe,g as S,i as Ce,j as be,p as he,q as ve,r as ye,s as Se,t as we,y as Pe,z as Ve}from"./chunk-BAR23WDL.js";import{a as ke}from"./chunk-INUD7PLR.js";import{a as Ee}from"./chunk-U45W26GG.js";import"./chunk-RFRMSZ5W.js";import{a as F,b as Y}from"./chunk-EB3EXIZ5.js";import"./chunk-GAYMAGXT.js";import{b as pe}from"./chunk-KL5Q5BU5.js";import{a as se}from"./chunk-NKWORGOE.js";import{a as Ie}from"./chunk-VFDSUV63.js";import"./chunk-WNMS36QR.js";import{F as X,b as le,c as J,f as ue,g as H,w as K,y as de,z as ce}from"./chunk-PMZJQWMM.js";import{A as O,C as ie,D as z,Db as k,Hb as b,Jb as s,L as Z,M,N as T,O as ne,Oa as re,Rb as oe,Sa as u,Sb as A,Ub as l,Vb as W,Wb as h,_a as C,ba as v,bc as ae,ca as y,d as j,db as G,e as U,gc as I,h as $,hc as E,m as L,n as D,pc as q,qb as _,rb as Q,sb as g,tb as w,ub as P,vb as V,wb as f,xb as o,y as R,yb as r,zb as x}from"./chunk-OU7FPMWK.js";import{a as N,b as te}from"./chunk-4CLCTAJ7.js";var Me=()=>[1,2,3,4,5,6];function je(i,c){if(i&1&&(o(0,"option",18),l(1),r()),i&2){let e=c.$implicit;f("value",e.id),u(),h(" ",e.name," ")}}function Ne(i,c){if(i&1&&(o(0,"option",18),l(1),r()),i&2){let e=c.$implicit;f("value",e.id),u(),h(" ",e.name," ")}}function Ue(i,c){i&1&&(o(0,"div",19)(1,"label",13),x(2,"span",44),l(3," \u06AF\u0631\u0648\u0647 \u062F\u0633\u062A\u0647\u200C\u0628\u0646\u062F\u06CC "),r(),o(4,"select",45)(5,"option",17),l(6,"\u0647\u0645\u0647 \u06AF\u0631\u0648\u0647\u200C\u0647\u0627"),r(),P(7,Ne,2,2,"option",18,w),r()()),i&2&&(u(5),f("ngValue",null),u(2),V(c))}function De(i,c){if(i&1){let e=k();o(0,"button",46),b("click",function(){let n=v(e).$implicit,a=s();return y(a.setSort(n.value))}),l(1),r()}if(i&2){let e,t,n,a,d=c.$implicit,p=s();A("bg-primary",((e=p.searchForm.get("sortBy"))==null?null:e.value)===d.value)("text-primary-foreground",((t=p.searchForm.get("sortBy"))==null?null:t.value)===d.value)("shadow-md",((n=p.searchForm.get("sortBy"))==null?null:n.value)===d.value)("btn-ghost",((a=p.searchForm.get("sortBy"))==null?null:a.value)!==d.value),u(),h(" ",d.label," ")}}function Re(i,c){i&1&&(o(0,"div",41),l(1),r()),i&2&&(u(),h(" ",c.totalCount," \u06A9\u0627\u0644\u0627 "))}function Oe(i,c){if(i&1&&x(0,"app-product-card",48),i&2){let e=c.$implicit;f("product",e)}}function ze(i,c){if(i&1&&(o(0,"div",42),P(1,Oe,1,1,"app-product-card",48,w),r()),i&2){let e=s();u(),V(e)}}function Ge(i,c){if(i&1){let e=k();o(0,"div",47)(1,"div",49)(2,"span",50),l(3,"search_off"),r()(),o(4,"h3",51),l(5,"\u0645\u062D\u0635\u0648\u0644\u06CC \u06CC\u0627\u0641\u062A \u0646\u0634\u062F"),r(),o(6,"p",52),l(7," \u0628\u0627 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627\u06CC \u0641\u0639\u0644\u06CC \u0646\u062A\u06CC\u062C\u0647\u200C\u0627\u06CC \u067E\u06CC\u062F\u0627 \u0646\u0634\u062F. "),r(),o(8,"button",53),b("click",function(){v(e);let n=s(2);return y(n.clearFilters())}),l(9," \u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627 "),r()()}}function Qe(i,c){i&1&&_(0,ze,3,0,"div",42)(1,Ge,10,0,"div",47),i&2&&g(c.length>0?0:1)}function We(i,c){i&1&&(o(0,"div",54),x(1,"div",55),o(2,"div",56),x(3,"div",57)(4,"div",58),o(5,"div",59),x(6,"div",60)(7,"div",61),r()()())}function qe(i,c){i&1&&(o(0,"div",42),P(1,We,8,0,"div",54,w),r()),i&2&&(u(),V(ae(0,Me)))}function Je(i,c){if(i&1){let e=k();o(0,"button",66),b("click",function(){let n=v(e).$implicit,a=s(3);return y(a.onPageNumberClick(n))}),l(1),r()}if(i&2){let e=c.$implicit,t=s(2);A("bg-primary",t.page===e)("text-primary-foreground",t.page===e)("shadow-md",t.page===e)("hover:bg-muted",t.page!==e&&e!=="...")("cursor-not-allowed",e==="...")("text-muted-foreground",e==="..."),f("disabled",e==="..."),u(),h(" ",e," ")}}function He(i,c){if(i&1){let e=k();o(0,"nav",62)(1,"button",63),b("click",function(){v(e);let n=s(),a=s();return y(a.onPageChange(n.page-1))}),o(2,"span",37),l(3,"chevron_right"),r()(),P(4,Je,2,14,"button",64,w),o(6,"button",65),b("click",function(){v(e);let n=s(),a=s();return y(a.onPageChange(n.page+1))}),o(7,"span",37),l(8,"chevron_left"),r()()()}if(i&2){let e=s(),t=s();u(),f("disabled",e.page===1),u(3),V(t.getPages(e.totalPages,e.page)),u(2),f("disabled",e.page===e.totalPages)}}function Ke(i,c){if(i&1&&(o(0,"div",43),_(1,He,9,2,"nav",62),r()),i&2){let e=c;u(),g(e&&e.totalPages>1?1:-1)}}var ee=(()=>{class i{constructor(e,t,n,a,d,p){this.productService=e,this.categoryService=t,this.BrandService=n,this.cdr=a,this.route=d,this.router=p,this.destroy$=new j,this.paginatedResultSubject=new U(null),this.paginatedResult$=this.paginatedResultSubject.asObservable(),this.sortOptions=[{label:"\u062C\u062F\u06CC\u062F\u062A\u0631\u06CC\u0646",value:F.newest},{label:"\u0642\u062F\u06CC\u0645\u06CC\u200C\u062A\u0631\u06CC\u0646",value:F.oldest},{label:"\u0627\u0631\u0632\u0627\u0646\u200C\u062A\u0631\u06CC\u0646",value:F.priceAsc},{label:"\u06AF\u0631\u0627\u0646\u200C\u062A\u0631\u06CC\u0646",value:F.priceDesc},{label:"\u0628\u06CC\u0634\u062A\u0631\u06CC\u0646 \u062A\u062E\u0641\u06CC\u0641",value:F.discountDesc}],this.searchForm=new xe({name:new S(null),minPrice:new S(null),maxPrice:new S(null),inStock:new S(null),hasDiscount:new S(null),isUnlimited:new S(null),categoryId:new S(null),BrandId:new S(null),sortBy:new S(F.newest),page:new S(1),pageSize:new S(12)}),this.products$=this.paginatedResult$.pipe(L(m=>m?.items??[])),this.categories$=this.categoryService.getCategories(void 0,1,50).pipe(L(m=>m.items??[])),this.Brands$=this.searchForm.get("categoryId").valueChanges.pipe(Z(this.searchForm.get("categoryId").value),M(m=>m?this.BrandService.getBrands(m,void 0,1,100).pipe(L(B=>B.items)):$(null)))}ngOnInit(){D([this.route.params,this.route.queryParams]).pipe(T(this.destroy$)).subscribe(([e,t])=>{let n=e.groupId?Number(e.groupId):null,a={name:t.name||null,minPrice:t.minPrice?Number(t.minPrice):null,maxPrice:t.maxPrice?Number(t.maxPrice):null,inStock:t.inStock==="true"?!0:null,hasDiscount:t.hasDiscount==="true"?!0:null,categoryId:t.categoryId?Number(t.categoryId):null,BrandId:n||(t.BrandId?Number(t.BrandId):null),sortBy:t.sortBy||F.newest,page:t.page?Number(t.page):1,pageSize:t.pageSize?Number(t.pageSize):12};this.searchForm.patchValue(a,{emitEvent:!1}),this.loadProducts(this.searchForm.value).subscribe(d=>{this.paginatedResultSubject.next(d)})}),this.searchForm.valueChanges.pipe(Z(this.searchForm.value),O(300),ie((e,t)=>JSON.stringify(e)===JSON.stringify(t)),ne(e=>this.updateUrl(e)),M(e=>this.loadProducts(e)),T(this.destroy$)).subscribe(e=>{this.paginatedResultSubject.next(e),this.cdr.markForCheck()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateUrl(e){let t={},n=this.route.snapshot.paramMap.get("groupId");Object.keys(e).forEach(d=>{let p=e[d];if(!(d==="BrandId"&&n&&p==n)&&p!==null&&p!==""&&p!==void 0&&p!==!1){if(d==="page"&&p===1||d==="pageSize"&&p===12||d==="sortBy"&&p===F.newest)return;t[d]=p}});let a=this.searchForm.value.BrandId&&!n?["/products","category-group",this.searchForm.value.BrandId]:["/products"];this.router.navigate(a,{queryParams:t,replaceUrl:!0})}loadProducts(e){let t={};for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let a=e[n];a!==null&&a!==""&&a!==void 0&&a!==!1&&(t[n]=a)}return this.productService.getProducts(t)}onPageChange(e){this.searchForm.patchValue({page:e})}setSort(e){this.searchForm.patchValue({sortBy:e,page:1})}getPages(e,t){if(e<=7)return Array.from({length:e},(m,B)=>B+1);let n=[],a=1,d=t-1-a,p=e-t-a;n.push(1),d>1&&n.push("...");for(let m=Math.max(2,t-a);m<=Math.min(e-1,t+a);m++)n.push(m);return p>1&&n.push("..."),n.push(e),n}onPageNumberClick(e){typeof e=="number"&&this.onPageChange(e)}toggleInStock(){let e=this.searchForm.get("inStock");e&&e.setValue(e.value?null:!0)}clearFilters(){this.searchForm.reset({sortBy:F.newest,page:1,pageSize:12}),this.router.navigate(["/products"])}static{this.\u0275fac=function(t){return new(t||i)(C(Y),C(ke),C(Fe),C(q),C(K),C(de))}}static{this.\u0275cmp=G({type:i,selectors:[["app-product-list-page"]],decls:73,vars:17,consts:[[1,"container","py-8"],[1,"grid","grid-cols-1","items-start","gap-8","lg:grid-cols-4"],[1,"hidden","lg:block","lg:col-span-1","lg:sticky","top-24","space-y-6"],[1,"card","p-6","space-y-6",3,"formGroup"],[1,"flex","items-center","gap-2","pb-4","border-b","border-border"],[1,"material-icons","text-primary"],[1,"text-lg","font-bold","text-foreground"],[1,"space-y-6"],[1,"form-group","relative"],["type","text","id","name","formControlName","name","placeholder"," ",1,"floating-input","peer"],["for","name",1,"floating-label"],[1,"material-icons","absolute","left-3","top-4","text-muted-foreground","pointer-events-none"],[1,"form-group","space-y-2"],[1,"form-label","text-sm","font-semibold","text-foreground","flex","items-center","gap-2"],[1,"w-1","h-4","bg-primary","rounded-full"],[1,"relative"],["id","category","formControlName","categoryId",1,"floating-input","pt-2","pb-2","h-12"],[3,"ngValue"],[3,"value"],[1,"form-group","space-y-2","animate-fade-in"],[1,"form-group","space-y-3"],[1,"w-1","h-4","bg-accent-foreground","rounded-full"],[1,"grid","grid-cols-2","gap-3"],["type","number","formControlName","minPrice","placeholder"," ",1,"floating-input","text-center"],[1,"floating-label","right-auto","left-0","w-full","text-center"],["type","number","formControlName","maxPrice","placeholder"," ",1,"floating-input","text-center"],[1,"space-y-4","pt-4","border-t","border-border"],[1,"flex","items-center","justify-between","cursor-pointer","group"],[1,"form-label","text-sm","font-medium","text-foreground"],["type","checkbox",1,"switch",3,"change","checked"],["type","checkbox","formControlName","hasDiscount",1,"switch"],["type","button",1,"btn","btn-ghost","text-destructive","hover:bg-destructive/10","w-full","rounded-xl",3,"click"],[1,"material-icons","icon-sm","me-2"],[1,"col-span-1","lg:col-span-3"],[1,"card","p-4","mb-8","flex","flex-col","sm:flex-row","items-center","justify-between","gap-4","sticky","top-24","z-20"],[1,"flex","items-center","gap-4","w-full","sm:w-auto","overflow-x-auto","pb-1","sm:pb-0","no-scrollbar"],[1,"flex","items-center","gap-1","text-muted-foreground","bg-muted/50","px-3","py-1.5","rounded-lg"],[1,"material-icons","icon-sm"],[1,"text-xs","font-bold","whitespace-nowrap"],[1,"flex","gap-1"],[1,"btn","btn-sm","rounded-lg","transition-all","duration-200","hover:bg-muted","font-normal",3,"bg-primary","text-primary-foreground","shadow-md","btn-ghost"],[1,"text-xs","font-medium","text-muted-foreground","whitespace-nowrap","bg-muted/30","px-3","py-1.5","rounded-full"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","gap-6"],[1,"mt-12","flex","justify-center"],[1,"w-1","h-4","bg-secondary","rounded-full"],["id","Brand","formControlName","BrandId",1,"floating-input","pt-2","pb-2","h-12"],[1,"btn","btn-sm","rounded-lg","transition-all","duration-200","hover:bg-muted","font-normal",3,"click"],[1,"empty-state","card","flex","flex-col","items-center","justify-center","p-16","text-center","border-dashed"],[3,"product"],[1,"empty-state-icon","w-24","h-24","rounded-full","bg-muted/50","flex","items-center","justify-center","mb-6"],[1,"material-icons","icon-4xl","text-muted-foreground/50"],[1,"empty-state-title","text-xl","font-bold","text-foreground"],[1,"empty-state-description","mt-2","text-muted-foreground"],[1,"btn","btn-primary","mt-6","rounded-full","px-8",3,"click"],[1,"card","overflow-hidden"],[1,"skeleton-card","aspect-square","skeleton-shimmer"],[1,"p-4","space-y-3"],[1,"skeleton","skeleton-text","w-3/4"],[1,"skeleton","skeleton-text","w-1/2"],[1,"flex","justify-between","pt-2"],[1,"skeleton","h-8","w-24","rounded"],[1,"skeleton","h-10","w-10","rounded-full"],[1,"card","rounded-full","p-1.5","flex","items-center","gap-1"],["aria-label","\u0635\u0641\u062D\u0647 \u0642\u0628\u0644",1,"btn","btn-icon","rounded-full","hover:bg-muted",3,"click","disabled"],[1,"w-9","h-9","rounded-full","flex","items-center","justify-center","text-sm","font-medium","transition-all","duration-200",3,"disabled","bg-primary","text-primary-foreground","shadow-md","hover:bg-muted","cursor-not-allowed","text-muted-foreground"],["aria-label","\u0635\u0641\u062D\u0647 \u0628\u0639\u062F",1,"btn","btn-icon","rounded-full","hover:bg-muted",3,"click","disabled"],[1,"w-9","h-9","rounded-full","flex","items-center","justify-center","text-sm","font-medium","transition-all","duration-200",3,"click","disabled"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"div",1)(2,"aside",2)(3,"form",3)(4,"div",4)(5,"span",5),l(6,"tune"),r(),o(7,"h3",6),l(8,"\u0641\u06CC\u0644\u062A\u0631\u0647\u0627"),r()(),o(9,"div",7)(10,"div",8),x(11,"input",9),o(12,"label",10),l(13,"\u062C\u0633\u062A\u062C\u0648\u06CC \u0645\u062D\u0635\u0648\u0644..."),r(),o(14,"span",11),l(15,"search"),r()(),o(16,"div",12)(17,"label",13),x(18,"span",14),l(19," \u062F\u0633\u062A\u0647\u200C\u0628\u0646\u062F\u06CC "),r(),o(20,"div",15)(21,"select",16)(22,"option",17),l(23,"\u0647\u0645\u0647 \u062F\u0633\u062A\u0647\u200C\u0647\u0627"),r(),P(24,je,2,2,"option",18,w),I(26,"async"),r()()(),_(27,Ue,9,1,"div",19),I(28,"async"),o(29,"div",20)(30,"label",13),x(31,"span",21),l(32," \u0645\u062D\u062F\u0648\u062F\u0647 \u0642\u06CC\u0645\u062A (\u062A\u0648\u0645\u0627\u0646) "),r(),o(33,"div",22)(34,"div",15),x(35,"input",23),o(36,"label",24),l(37,"\u0627\u0632"),r()(),o(38,"div",15),x(39,"input",25),o(40,"label",24),l(41,"\u062A\u0627"),r()()()(),o(42,"div",26)(43,"label",27)(44,"span",28),l(45,"\u0641\u0642\u0637 \u06A9\u0627\u0644\u0627\u0647\u0627\u06CC \u0645\u0648\u062C\u0648\u062F"),r(),o(46,"input",29),b("change",function(){return n.toggleInStock()}),r()(),o(47,"label",27)(48,"span",28),l(49,"\u0645\u062D\u0635\u0648\u0644\u0627\u062A \u062A\u062E\u0641\u06CC\u0641\u200C\u062F\u0627\u0631"),r(),x(50,"input",30),r()()(),o(51,"button",31),b("click",function(){return n.clearFilters()}),o(52,"span",32),l(53,"clear_all"),r(),l(54," \u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627 "),r()()(),o(55,"main",33)(56,"div",34)(57,"div",35)(58,"div",36)(59,"span",37),l(60,"sort"),r(),o(61,"span",38),l(62,"\u0645\u0631\u062A\u0628\u200C\u0633\u0627\u0632\u06CC:"),r()(),o(63,"div",39),P(64,De,2,9,"button",40,w),r()(),_(66,Re,2,1,"div",41),I(67,"async"),r(),_(68,Qe,2,1),I(69,"async"),Q(70,qe,3,1,"div",42),_(71,Ke,2,1,"div",43),I(72,"async"),r()()()),t&2){let a,d,p,m,B;u(3),f("formGroup",n.searchForm),u(19),f("ngValue",null),u(2),V(E(26,7,n.categories$)),u(3),g((a=E(28,9,n.Brands$))?27:-1,a),u(19),f("checked",(d=n.searchForm.get("inStock"))==null?null:d.value),u(18),V(n.sortOptions),u(2),g((p=E(67,11,n.paginatedResult$))?66:-1,p),u(2),g((m=E(69,13,n.products$))?68:70,m),u(3),g((B=E(72,15,n.paginatedResult$))?71:-1,B)}},dependencies:[H,X,Ve,Ce,Se,we,_e,be,me,ye,ge,fe,ve,he,Ee,J],encapsulation:2})}}return i})();function Xe(i,c){if(i&1&&(o(0,"div",12),l(1),r()),i&2){let e=s(2),t=s();u(),h(" ",t.getDiscountPercentage(e.selectedVariant),"% ")}}function Ye(i,c){i&1&&(o(0,"span",22),l(1,"inventory_2"),r())}function Ze(i,c){if(i&1&&(o(0,"span",26),l(1),I(2,"number"),r()),i&2){let e=s(2);u(),h(" ",E(2,1,e.selectedVariant==null?null:e.selectedVariant.originalPrice)," ")}}function et(i,c){if(i&1){let e=k();o(0,"button",40),b("click",function(){let n=v(e).$implicit,a=s(2).$implicit,d=s(3);return y(d.selectAttribute(a.name,n.id))}),r()}if(i&2){let e=c.$implicit,t=s(2).$implicit,n=s(2);oe("background-color",e.hexCode),A("border-primary",n.selectedAttributes[t.name]===e.id)("ring-2",n.selectedAttributes[t.name]===e.id)("ring-primary",n.selectedAttributes[t.name]===e.id)("ring-offset-2",n.selectedAttributes[t.name]===e.id)("border-border",n.selectedAttributes[t.name]!==e.id)}}function tt(i,c){if(i&1&&(o(0,"div",37),P(1,et,1,12,"button",39,w),r()),i&2){let e=s().$implicit;u(),V(e.values)}}function it(i,c){if(i&1){let e=k();o(0,"button",42),b("click",function(){let n=v(e).$implicit,a=s(2).$implicit,d=s(3);return y(d.selectAttribute(a.name,n.id))}),l(1),r()}if(i&2){let e=c.$implicit,t=s(2).$implicit,n=s(2);A("btn-primary",n.selectedAttributes[t.name]===e.id)("btn-outline",n.selectedAttributes[t.name]!==e.id),u(),h(" ",e.displayValue," ")}}function nt(i,c){if(i&1&&(o(0,"div",38),P(1,it,2,5,"button",41,w),r()),i&2){let e=s().$implicit;u(),V(e.values)}}function rt(i,c){if(i&1&&(o(0,"div",28)(1,"div",36)(2,"span",19),l(3),r()(),_(4,tt,3,0,"div",37),_(5,nt,3,0,"div",38),r()),i&2){let e=c.$implicit;u(3),W(e.displayName),u(),g(e.name==="color"?4:-1),u(),g(e.name!=="color"?5:-1)}}function ot(i,c){if(i&1){let e=k();o(0,"div",31)(1,"button",43),b("click",function(){v(e);let n=s(2),a=s();return y(a.increaseQuantity(n.cartItem,n.product,n.selectedVariant))}),l(2," + "),r(),o(3,"span",44),l(4),r(),o(5,"button",43),b("click",function(){v(e);let n=s(2),a=s();return y(a.decreaseQuantity(n.cartItem))}),l(6," \u2212 "),r()()}if(i&2){let e=s(2);u(),f("disabled",e.isUpdatingCart),u(3),h(" ",e.cartItem.quantity," "),u(),f("disabled",e.isUpdatingCart)}}function at(i,c){i&1&&(o(0,"span",46)(1,"span",47),l(2,"add_shopping_cart"),r(),l(3," \u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F "),r())}function lt(i,c){i&1&&(o(0,"span",46)(1,"span",48),l(2,"refresh"),r(),l(3," \u062F\u0631 \u062D\u0627\u0644 \u0627\u0641\u0632\u0648\u062F\u0646... "),r())}function ut(i,c){if(i&1){let e=k();o(0,"div",32)(1,"button",45),b("click",function(){v(e);let n=s(2),a=s();return y(a.addToCart(n.product,n.selectedVariant))}),_(2,at,4,0,"span",46),_(3,lt,4,0,"span",46),r()()}if(i&2){let e=s(2),t=s();u(),A("btn-loading",e.isUpdatingCart),f("disabled",e.isUpdatingCart||!t.isInStock(e.selectedVariant)||!e.selectedVariant),u(),g(e.isUpdatingCart?-1:2),u(),g(e.isUpdatingCart?3:-1)}}function dt(i,c){i&1&&(o(0,"div",33)(1,"a",49),l(2," \u0645\u0634\u0627\u0647\u062F\u0647 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F "),r()())}function ct(i,c){if(i&1&&(o(0,"div",8)(1,"div",9)(2,"div",10),x(3,"img",11),_(4,Xe,2,1,"div",12),r()(),o(5,"div",13)(6,"div",14)(7,"h1",15),l(8),r(),o(9,"div",16)(10,"div",17)(11,"span",18),l(12,"star"),r(),o(13,"span",19),l(14,"4.8"),r()(),x(15,"span",20),o(16,"div",21),_(17,Ye,2,0,"span",22),l(18),r()(),o(19,"div",23)(20,"span",24),l(21),I(22,"number"),r(),o(23,"span",25),l(24,"\u062A\u0648\u0645\u0627\u0646"),r(),_(25,Ze,3,3,"span",26),r()(),o(26,"div",27),P(27,rt,6,3,"div",28,w),r(),o(29,"div",29)(30,"div",30),_(31,ot,7,3,"div",31),_(32,ut,4,5,"div",32),_(33,dt,3,0,"div",33),o(34,"button",34)(35,"span",35),l(36,"favorite_border"),r()()()()()()),i&2){let e=s(),t=s();u(3),f("src",t.getProductIcon(e.product),re)("alt",e.product.name),u(),g(t.hasDiscount(e.selectedVariant)?4:-1),u(4),W(e.product.name),u(8),f("ngClass",t.isInStock(e.selectedVariant)?"bg-success text-white":"bg-destructive text-white"),u(),g(!(e.selectedVariant!=null&&e.selectedVariant.isUnlimited)&&t.isInStock(e.selectedVariant)?17:-1),u(),h(" ",e.selectedVariant!=null&&e.selectedVariant.isUnlimited?"\u0645\u0648\u062C\u0648\u062F":t.isInStock(e.selectedVariant)?"\u0645\u0648\u062C\u0648\u062F \u062F\u0631 \u0627\u0646\u0628\u0627\u0631":"\u0646\u0627\u0645\u0648\u062C\u0648\u062F"," "),u(3),h(" ",E(22,12,(e.selectedVariant==null?null:e.selectedVariant.sellingPrice)||e.product.minPrice)," "),u(4),g(t.hasDiscount(e.selectedVariant)?25:-1),u(2),V(t.attributeTypes),u(4),g(e.cartItem&&e.selectedVariant?31:-1),u(),g(e.cartItem?-1:32),u(),g(e.cartItem?33:-1)}}function st(i,c){if(i&1&&(o(0,"div",1)(1,"nav",3)(2,"a",4),l(3,"\u062E\u0627\u0646\u0647"),r(),o(4,"span",5),l(5,"/"),r(),o(6,"a",6),l(7,"\u0645\u062D\u0635\u0648\u0644\u0627\u062A"),r(),o(8,"span",5),l(9,"/"),r(),o(10,"span",7),l(11),r()(),_(12,ct,37,14,"div",8),r()),i&2){let e=c;u(11),W(e.product==null?null:e.product.name),u(),g(e.product&&!e.isLoading?12:-1)}}function pt(i,c){i&1&&(o(0,"div",2)(1,"span",50),l(2,"sync"),r()())}var Te=(()=>{class i{constructor(e,t,n,a,d,p){this.route=e,this.productService=t,this.cartService=n,this.notificationService=a,this.mediaService=d,this.cdr=p,this.destroy$=new j,this.quantityUpdate$=new j,this.state={product:null,selectedVariant:null,selectedAttributes:{},cartItem:null,isLoading:!0,isUpdatingCart:!1,error:null},this.attributeTypes=[]}ngOnInit(){this.vm$=new U(this.state),D([this.route.paramMap,this.cartService.cart$]).pipe(M(([e,t])=>(this.id=e.get("id"),this.updateViewModel({isLoading:!0}),this.productService.getProductById(Number(this.id)).pipe(L(n=>({product:n,cart:t})),R(n=>{let a=n?.error?.message||"\u0645\u062D\u0635\u0648\u0644 \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F.";return this.updateViewModel({isLoading:!1,error:a}),$(null)})))),T(this.destroy$)).subscribe(e=>{if(e){let{product:t,cart:n}=e;this.extractAttributes(t);let a={};this.attributeTypes.forEach(m=>{a[m.name]=m.values[0]?.id||null});let d=this.findVariant(t,a),p=d&&n?.cartItems.find(m=>m.variantId===d.id)||null;this.updateViewModel({product:t,selectedVariant:d,selectedAttributes:a,cartItem:p,isLoading:!1,error:null})}}),this.quantityUpdate$.pipe(O(500),M(({item:e,quantity:t})=>(this.updateViewModel({isUpdatingCart:!0}),this.cartService.updateCartItem(e.id,{quantity:t,rowVersion:e.rowVersion}).pipe(z(()=>this.updateViewModel({isUpdatingCart:!1})),R(()=>$(null))))),T(this.destroy$)).subscribe()}updateViewModel(e){this.state=N(N({},this.state),e),this.vm$.next(this.state),this.cdr.markForCheck()}extractAttributes(e){let t=new Map;e.variants.forEach(n=>{for(let a in n.attributes){let d=n.attributes[a];t.has(d.typeName)||t.set(d.typeName,{id:0,name:d.typeName,displayName:d.typeDisplayName,values:[]});let p=t.get(d.typeName);p.values.some(m=>m.id===d.id)||p.values.push({id:d.id,value:d.value,displayValue:d.displayValue,hexCode:d.hexCode})}}),this.attributeTypes=Array.from(t.values())}findVariant(e,t){return e.variants.find(n=>Object.keys(t).every(a=>{let d=t[a];return d===null?!0:n.attributes[a.toLowerCase()]?.id===d}))||e.variants[0]||null}selectAttribute(e,t){let n=te(N({},this.state.selectedAttributes),{[e]:t}),a=this.findVariant(this.state.product,n),d=a&&this.cartService.currentCartValue?.cartItems.find(p=>p.variantId===a.id)||null;this.updateViewModel({selectedAttributes:n,selectedVariant:a,cartItem:d})}getProductIcon(e){let n=e.images?.find(a=>a.isPrimary)?.url||e.iconUrl||e.images?.[0]?.url;return this.mediaService.getMediaUrl(n)}hasDiscount(e){return!!e&&e.originalPrice>e.sellingPrice}getDiscountPercentage(e){return e?Math.round((e.originalPrice-e.sellingPrice)/e.originalPrice*100):0}isInStock(e){return!!e&&(e.isUnlimited||e.stock>0)}isStockAvailableForIncrease(e,t){return e.isUnlimited?!0:t?e.stock>t.quantity:e.stock>0}addToCart(e,t){this.updateViewModel({isUpdatingCart:!0});let n=t.rowVersion||t.RowVersion;this.cartService.addToCart({variantId:t.id,quantity:1,variantRowVersion:n}).pipe(z(()=>this.updateViewModel({isUpdatingCart:!1}))).subscribe({error:a=>{a.status===409?(this.notificationService.show("\u0645\u0648\u062C\u0648\u062F\u06CC \u06CC\u0627 \u0642\u06CC\u0645\u062A \u0645\u062D\u0635\u0648\u0644 \u062A\u063A\u06CC\u06CC\u0631 \u06A9\u0631\u062F\u0647 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.","info"),this.reloadProduct()):this.notificationService.show(a?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F","error")}})}increaseQuantity(e,t,n){this.isStockAvailableForIncrease(n,e)&&this.quantityUpdate$.next({item:e,quantity:e.quantity+1})}decreaseQuantity(e){e.quantity>1?this.quantityUpdate$.next({item:e,quantity:e.quantity-1}):(this.updateViewModel({isUpdatingCart:!0}),this.cartService.removeFromCart(e.id).pipe(z(()=>this.updateViewModel({isUpdatingCart:!1}))).subscribe())}reloadProduct(){this.updateViewModel({isLoading:!0,error:null}),this.productService.getProductById(Number(this.id)).pipe(T(this.destroy$),R(e=>{let t=e?.error?.message||"\u0645\u062D\u0635\u0648\u0644 \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F.";return this.updateViewModel({isLoading:!1,error:t}),$(null)})).subscribe(e=>{if(e){let t=this.cartService.currentCartValue;this.extractAttributes(e);let n=this.findVariant(e,this.state.selectedAttributes),a=n&&t?.cartItems.find(d=>d.variantId===n.id)||null;this.updateViewModel({product:e,selectedVariant:n,cartItem:a,isLoading:!1})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||i)(C(K),C(Y),C(pe),C(se),C(Ie),C(q))}}static{this.\u0275cmp=G({type:i,selectors:[["app-product-page"]],inputs:{id:"id"},decls:4,vars:3,consts:[[1,"min-h-screen","pb-12","bg-background"],[1,"container","py-8"],[1,"container","py-20","flex","justify-center"],[1,"flex","items-center","text-sm","text-foreground/70","mb-8","gap-2","animate-fade-in-down"],["routerLink","/",1,"hover:text-foreground","transition-colors"],[1,"text-xs"],["routerLink","/products",1,"hover:text-foreground","transition-colors"],[1,"text-foreground","font-medium","truncate"],[1,"grid","grid-cols-1","lg:grid-cols-12","gap-8","lg:gap-12","animate-fade-in"],[1,"lg:col-span-5"],[1,"aspect-square","bg-white","dark:bg-card","rounded-2xl","border","border-border","p-8","flex","items-center","justify-center","relative","overflow-hidden"],[1,"max-w-full","max-h-full","object-contain","mix-blend-multiply","dark:mix-blend-normal",3,"src","alt"],[1,"absolute","top-4","left-4","bg-destructive","text-white","px-3","py-1.5","rounded-lg","text-sm","font-bold","shadow-md","animate-delay-200","animate-fade-in"],[1,"lg:col-span-7","space-y-8","animate-delay-100","animate-fade-in"],[1,"border-b","border-border","pb-6","space-y-4"],[1,"text-3xl","font-black","text-foreground"],[1,"flex","items-center","gap-4","text-sm"],[1,"flex","items-center","gap-1","text-yellow-500"],[1,"material-icons","icon-lg"],[1,"font-bold","text-foreground"],[1,"w-1","h-1","bg-border","rounded-full"],[1,"badge","badge-sm",3,"ngClass"],[1,"material-icons","icon-xs","me-1"],[1,"flex","items-baseline","gap-3","pt-2"],[1,"text-3xl","font-bold","text-foreground","tabular-nums"],[1,"text-sm","font-medium","text-muted-foreground"],[1,"text-lg","text-muted-foreground","line-through","decoration-destructive/50","tabular-nums"],[1,"space-y-6"],[1,"space-y-3"],[1,"fixed","bottom-0","left-0","right-0","p-4","bg-background","border-t","border-border","lg:static","lg:border-none","lg:p-0","lg:bg-transparent","z-20","safe-area-pb"],[1,"container","lg:px-0","flex","gap-4"],[1,"flex","items-center","border","border-border","rounded-lg","h-12","bg-background"],[1,"flex-1"],[1,"flex-1","lg:flex-none"],["title","\u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0639\u0644\u0627\u0642\u0647\u200C\u0645\u0646\u062F\u06CC\u200C\u0647\u0627",1,"btn","btn-outline","btn-lg","btn-icon","group"],[1,"material-icons","text-destructive"],[1,"flex","justify-between","text-sm"],[1,"flex","flex-wrap","gap-3"],[1,"flex","flex-wrap","gap-2"],[1,"w-10","h-10","rounded-full","border-2","shadow-sm","focus:outline-none","transition-all",3,"backgroundColor","border-primary","ring-2","ring-primary","ring-offset-2","border-border"],[1,"w-10","h-10","rounded-full","border-2","shadow-sm","focus:outline-none","transition-all",3,"click"],[1,"px-4","py-2","rounded-lg","text-sm","border","transition-all","focus:outline-none",3,"btn-primary","btn-outline"],[1,"px-4","py-2","rounded-lg","text-sm","border","transition-all","focus:outline-none",3,"click"],[1,"w-12","h-full","flex","items-center","justify-center","text-primary","hover:bg-muted","text-xl","font-bold","transition-colors",3,"click","disabled"],[1,"w-10","text-center","font-bold","text-lg","tabular-nums"],[1,"btn","btn-primary","btn-lg","w-full","font-bold","text-base","group",3,"click","disabled"],[1,"flex","items-center","justify-center","gap-2"],[1,"material-icons"],[1,"material-icons","icon-spin"],["routerLink","/cart",1,"btn","btn-outline","btn-lg","w-full","lg:w-auto","font-bold"],[1,"material-icons","icon-4xl","animate-spin","text-muted-foreground"]],template:function(t,n){if(t&1&&(o(0,"div",0),_(1,st,13,2,"div",1),I(2,"async"),Q(3,pt,3,0,"div",2),r()),t&2){let a;u(),g((a=E(2,1,n.vm$))?1:3,a)}},dependencies:[H,le,X,ce,Pe,J,ue],encapsulation:2})}}return i})();var Mt=[{path:"",component:ee},{path:"category-group/:groupId",component:ee},{path:":id",component:Te}];export{Mt as PRODUCTS_ROUTES};
