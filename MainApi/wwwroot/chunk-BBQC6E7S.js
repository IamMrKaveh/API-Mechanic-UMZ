import{a as C}from"./chunk-ISFWZGBK.js";import{i as v,q as g,x,z as E}from"./chunk-QOTKPPKC.js";import{Ab as u,Bb as h,Ca as d,Sa as p,X as m,eb as c,fb as l,kb as a,lb as s,mb as f,tb as y}from"./chunk-6VZDFBBI.js";import"./chunk-4CLCTAJ7.js";function M(n,t){if(n&1&&(a(0,"p",5),u(1),s()),n&2){let I=y();d(),h(I.errorMessage)}}var j=(()=>{let t=class t{constructor(){this.route=m(x),this.router=m(E),this.http=m(g),this.errorMessage=null}ngOnInit(){let o=this.route.snapshot.queryParamMap.get("Authority"),e=this.route.snapshot.queryParamMap.get("Status"),r=this.route.snapshot.queryParamMap.get("orderId");if(!o||!r){this.router.navigate(["/payment/failure"],{queryParams:{reason:"invalid_params"}});return}this.verifyPayment(o,e||"",parseInt(r,10))}verifyPayment(o,e,r){let P=`${C.API_URL}Orders/verify-payment`,b={authority:o,status:e,orderId:r.toString()};this.http.get(P,{params:b}).subscribe({next:i=>{i.isVerified?this.router.navigate(["/payment/success"],{queryParams:{orderId:i.orderId,refId:i.refId}}):this.router.navigate(["/payment/failure"],{queryParams:{orderId:i.orderId,reason:i.message||"verification_failed"}})},error:i=>{console.error("Payment verification error:",i),this.router.navigate(["/payment/failure"],{queryParams:{orderId:r,reason:"server_error"}})}})}};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=p({type:t,selectors:[["app-payment-callback"]],decls:8,vars:1,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-gray-50"],[1,"text-center","p-8"],[1,"animate-spin","rounded-full","h-16","w-16","border-b-2","border-primary","mx-auto","mb-4"],[1,"text-xl","font-semibold","text-gray-700","mb-2"],[1,"text-gray-500"],[1,"text-red-500","mt-4"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"div",1),f(2,"div",2),a(3,"h2",3),u(4,"\u062F\u0631 \u062D\u0627\u0644 \u0628\u0631\u0631\u0633\u06CC \u067E\u0631\u062F\u0627\u062E\u062A... "),s(),a(5,"p",4),u(6,"\u0644\u0637\u0641\u0627\u064B \u0635\u0628\u0631 \u06A9\u0646\u06CC\u062F"),s(),c(7,M,2,1,"p",5),s()()),e&2&&(d(7),l(r.errorMessage?7:-1))},dependencies:[v],encapsulation:2});let n=t;return n})();export{j as PaymentCallback};
