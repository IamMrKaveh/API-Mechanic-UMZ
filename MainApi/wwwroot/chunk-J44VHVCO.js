import{a as Ae}from"./chunk-W65G4XI3.js";import{a as Fe}from"./chunk-JBDIXU3W.js";import{a as Te}from"./chunk-IMKKRXGK.js";import{a as V,b as X}from"./chunk-RWUFDKEU.js";import{a as ke}from"./chunk-UCZDBRZX.js";import{a as fe,b as _e,d as ve,e as xe,f as be,g as S,i as he,j as ye,m as Ce,p as Se,q as Ie,r as we,s as Pe,y as Ve,z as Ee}from"./chunk-2WEVJ2Q3.js";import{b as ge}from"./chunk-CVBRNWP7.js";import{a as me}from"./chunk-OR3E3ANE.js";import"./chunk-WNMS36QR.js";import{A as de,B as pe,H as K,b as se,c as Q,d as W,e as q,h as ce,i as J,y as H}from"./chunk-H5ECWNVP.js";import{A as U,Bb as ee,C as D,Cb as te,Db as I,F as re,G as R,Gb as y,Hb as m,Mb as N,Nb as le,O as Z,Oa as ae,Ob as F,P as A,Pb as s,Q as E,Qb as G,R as oe,Rb as C,Sa as c,Yb as ue,ac as w,bb as h,bc as P,dc as O,ea as x,f as $,fa as b,g as M,gb as B,j as k,lb as g,lc as z,o as T,p as L,ub as p,vb as a,wb as o,xb as v}from"./chunk-C5CPS5UB.js";import{a as j,b as ne}from"./chunk-4CLCTAJ7.js";var Le=()=>[1,2,3,4,5,6];function Ue(n,u){if(n&1&&(a(0,"option",46),s(1),o()),n&2){let t=u.$implicit;p("value",t.id),c(),C(" ",t.name," ")}}function De(n,u){if(n&1&&(a(0,"option",46),s(1),o()),n&2){let t=u.$implicit;p("value",t.id),c(),C(" ",t.name," ")}}function Re(n,u){if(n&1&&(a(0,"div",47)(1,"label",15),v(2,"span",48),s(3," \u06AF\u0631\u0648\u0647 \u062F\u0633\u062A\u0647\u200C\u0628\u0646\u062F\u06CC "),o(),a(4,"select",49)(5,"option",19),s(6,"\u0647\u0645\u0647 \u06AF\u0631\u0648\u0647\u200C\u0647\u0627"),o(),g(7,De,2,2,"option",20),o()()),n&2){let t=u.ngIf;c(5),p("ngValue",null),c(2),p("ngForOf",t)}}function Be(n,u){if(n&1){let t=I();a(0,"button",50),y("click",function(){let i=x(t).$implicit,r=m();return b(r.setSort(i.value))}),s(1),o()}if(n&2){let t,e,i,r,l=u.$implicit,d=m();F("bg-primary",((t=d.searchForm.get("sortBy"))==null?null:t.value)===l.value)("text-primary-foreground",((e=d.searchForm.get("sortBy"))==null?null:e.value)===l.value)("shadow-md",((i=d.searchForm.get("sortBy"))==null?null:i.value)===l.value)("btn-ghost",((r=d.searchForm.get("sortBy"))==null?null:r.value)!==l.value),c(),C(" ",l.label," ")}}function Ge(n,u){if(n&1&&(a(0,"div",51),s(1),o()),n&2){let t=u.ngIf;c(),C(" ",t.totalItems," \u06A9\u0627\u0644\u0627 ")}}function ze(n,u){if(n&1&&v(0,"app-product-card",55),n&2){let t=u.$implicit;p("product",t)}}function Qe(n,u){if(n&1&&(a(0,"div",53),g(1,ze,1,1,"app-product-card",54),o()),n&2){let t=m().ngIf;c(),p("ngForOf",t)}}function We(n,u){if(n&1){let t=I();a(0,"div",56)(1,"div",57)(2,"span",58),s(3,"search_off"),o()(),a(4,"h3",59),s(5,"\u0645\u062D\u0635\u0648\u0644\u06CC \u06CC\u0627\u0641\u062A \u0646\u0634\u062F"),o(),a(6,"p",60),s(7," \u0628\u0627 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627\u06CC \u0641\u0639\u0644\u06CC \u0646\u062A\u06CC\u062C\u0647\u200C\u0627\u06CC \u067E\u06CC\u062F\u0627 \u0646\u0634\u062F. "),o(),a(8,"button",61),y("click",function(){x(t);let i=m(2);return b(i.clearFilters())}),s(9," \u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627 "),o()()}}function qe(n,u){if(n&1&&(ee(0),g(1,Qe,2,1,"div",52)(2,We,10,0,"ng-template",null,1,O),te()),n&2){let t=u.ngIf,e=N(3);c(),p("ngIf",t.length>0)("ngIfElse",e)}}function Je(n,u){n&1&&(a(0,"div",63),v(1,"div",64),a(2,"div",65),v(3,"div",66)(4,"div",67),a(5,"div",68),v(6,"div",69)(7,"div",70),o()()())}function He(n,u){n&1&&(a(0,"div",53),g(1,Je,8,0,"div",62),o()),n&2&&(c(),p("ngForOf",ue(1,Le)))}function Ke(n,u){if(n&1){let t=I();ee(0),a(1,"button",77),y("click",function(){let i=x(t).$implicit,r=m(3);return b(r.onPageNumberClick(i))}),s(2),o(),te()}if(n&2){let t=u.$implicit,e=m(2).ngIf;c(),F("bg-primary",e.page===t)("text-primary-foreground",e.page===t)("shadow-md",e.page===t)("hover:bg-muted",e.page!==t&&t!=="..."),p("disabled",t==="..."),c(),C(" ",t," ")}}function Xe(n,u){if(n&1){let t=I();a(0,"nav",73)(1,"button",74),y("click",function(){x(t);let i=m().ngIf,r=m();return b(r.onPageChange(i.page-1))}),a(2,"span",39),s(3,"chevron_right"),o()(),g(4,Ke,3,10,"ng-container",75),a(5,"button",76),y("click",function(){x(t);let i=m().ngIf,r=m();return b(r.onPageChange(i.page+1))}),a(6,"span",39),s(7,"chevron_left"),o()()()}if(n&2){let t=m().ngIf,e=m();c(),p("disabled",t.page===1),c(3),p("ngForOf",e.getPages(t.totalPages,t.page)),c(),p("disabled",t.page===t.totalPages)}}function Ye(n,u){if(n&1&&(a(0,"div",71),g(1,Xe,8,3,"nav",72),o()),n&2){let t=u.ngIf;c(),p("ngIf",t&&t.totalPages>1)}}var ie=(()=>{let u=class u{constructor(e,i,r,l,d,f){this.productService=e,this.categoryService=i,this.categoryGroupService=r,this.cdr=l,this.route=d,this.router=f,this.destroy$=new $,this.paginatedResultSubject=new M(null),this.paginatedResult$=this.paginatedResultSubject.asObservable(),this.sortOptions=[{label:"\u062C\u062F\u06CC\u062F\u062A\u0631\u06CC\u0646",value:V.newest},{label:"\u0642\u062F\u06CC\u0645\u06CC\u200C\u062A\u0631\u06CC\u0646",value:V.oldest},{label:"\u0627\u0631\u0632\u0627\u0646\u200C\u062A\u0631\u06CC\u0646",value:V.priceAsc},{label:"\u06AF\u0631\u0627\u0646\u200C\u062A\u0631\u06CC\u0646",value:V.priceDesc},{label:"\u0628\u06CC\u0634\u062A\u0631\u06CC\u0646 \u062A\u062E\u0641\u06CC\u0641",value:V.discountDesc}],this.searchForm=new be({name:new S(null),minPrice:new S(null),maxPrice:new S(null),inStock:new S(null),hasDiscount:new S(null),isUnlimited:new S(null),categoryId:new S(null),categoryGroupId:new S(null),sortBy:new S(V.newest),page:new S(1),pageSize:new S(12)}),this.products$=this.paginatedResult$.pipe(T(_=>_?.items??[])),this.categories$=this.categoryService.getCategories(void 0,1,50).pipe(T(_=>_.items??[])),this.categoryGroups$=this.searchForm.get("categoryId").valueChanges.pipe(Z(this.searchForm.get("categoryId").value),A(_=>_?this.categoryGroupService.getCategoryGroups(_,void 0,1,100).pipe(T(Y=>Y.items)):k(null)))}ngOnInit(){L([this.route.params,this.route.queryParams]).pipe(E(this.destroy$)).subscribe(([e,i])=>{let r=e.groupId?Number(e.groupId):null,l={name:i.name||null,minPrice:i.minPrice?Number(i.minPrice):null,maxPrice:i.maxPrice?Number(i.maxPrice):null,inStock:i.inStock==="true"?!0:null,hasDiscount:i.hasDiscount==="true"?!0:null,categoryId:i.categoryId?Number(i.categoryId):null,categoryGroupId:r||(i.categoryGroupId?Number(i.categoryGroupId):null),sortBy:i.sortBy||V.newest,page:i.page?Number(i.page):1,pageSize:i.pageSize?Number(i.pageSize):12};this.searchForm.patchValue(l,{emitEvent:!1}),this.loadProducts(this.searchForm.value).subscribe(d=>{this.paginatedResultSubject.next(d)})}),this.searchForm.valueChanges.pipe(Z(this.searchForm.value),D(300),re((e,i)=>JSON.stringify(e)===JSON.stringify(i)),oe(e=>this.updateUrl(e)),A(e=>this.loadProducts(e)),E(this.destroy$)).subscribe(e=>{this.paginatedResultSubject.next(e),this.cdr.markForCheck()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateUrl(e){let i={},r=this.route.snapshot.paramMap.get("groupId");Object.keys(e).forEach(d=>{let f=e[d];if(!(d==="categoryGroupId"&&r&&f==r)&&f!==null&&f!==""&&f!==void 0&&f!==!1){if(d==="page"&&f===1||d==="pageSize"&&f===12||d==="sortBy"&&f===V.newest)return;i[d]=f}});let l=this.searchForm.value.categoryGroupId&&!r?["/products","category-group",this.searchForm.value.categoryGroupId]:["/products"];this.router.navigate(l,{queryParams:i,replaceUrl:!0})}loadProducts(e){let i={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let l=e[r];l!==null&&l!==""&&l!==void 0&&l!==!1&&(i[r]=l)}return this.productService.getProducts(i)}onPageChange(e){this.searchForm.patchValue({page:e})}setSort(e){this.searchForm.patchValue({sortBy:e,page:1})}getPages(e,i){if(e<=7)return Array.from({length:e},(_,Y)=>Y+1);let r=[],l=1,d=i-1-l,f=e-i-l;r.push(1),d>1&&r.push("...");for(let _=Math.max(2,i-l);_<=Math.min(e-1,i+l);_++)r.push(_);return f>1&&r.push("..."),r.push(e),r}onPageNumberClick(e){typeof e=="number"&&this.onPageChange(e)}toggleInStock(){let e=this.searchForm.get("inStock");e&&e.setValue(e.value?null:!0)}clearFilters(){this.searchForm.reset({sortBy:V.newest,page:1,pageSize:12}),this.router.navigate(["/products"])}};u.\u0275fac=function(i){return new(i||u)(h(X),h(Fe),h(Ae),h(z),h(H),h(de))},u.\u0275cmp=B({type:u,selectors:[["app-product-list-page"]],decls:72,vars:20,consts:[["loadingState",""],["noProducts",""],[1,"container","py-8"],[1,"grid","grid-cols-1","items-start","gap-8","lg:grid-cols-4"],[1,"hidden","lg:block","lg:col-span-1","lg:sticky","top-24","space-y-6"],[1,"card","p-6","space-y-6",3,"formGroup"],[1,"flex","items-center","gap-2","pb-4","border-b","border-border"],[1,"material-icons","icon-primary"],[1,"text-lg","font-bold","text-foreground"],[1,"space-y-6"],[1,"form-group","relative"],["type","text","id","name","formControlName","name","placeholder"," ",1,"floating-input","peer"],["for","name",1,"floating-label"],[1,"material-icons","absolute","left-3","top-4","text-muted-foreground","pointer-events-none"],[1,"form-group","space-y-2"],[1,"form-label","text-sm","font-semibold","text-foreground","flex","items-center","gap-2"],[1,"w-1","h-4","bg-primary","rounded-full"],[1,"relative"],["id","category","formControlName","categoryId",1,"floating-input","pt-2","pb-2","h-12"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["class","form-group space-y-2 animate-fade-in",4,"ngIf"],[1,"form-group","space-y-3"],[1,"w-1","h-4","bg-accent-foreground","rounded-full"],[1,"grid","grid-cols-2","gap-3"],["type","number","formControlName","minPrice","placeholder"," ",1,"floating-input","text-center"],[1,"floating-label","right-auto","left-0","w-full","text-center"],["type","number","formControlName","maxPrice","placeholder"," ",1,"floating-input","text-center"],[1,"space-y-4","pt-4","border-t","border-border"],[1,"flex","items-center","justify-between","cursor-pointer","group"],[1,"form-label","text-sm","font-medium","text-foreground"],["type","checkbox",1,"switch",3,"change","checked"],["type","checkbox","formControlName","hasDiscount",1,"switch"],["type","button",1,"btn","btn-ghost","text-destructive","hover:bg-destructive/10","w-full","rounded-xl",3,"click"],[1,"material-icons","icon-sm","me-2"],[1,"col-span-1","lg:col-span-3"],[1,"card","p-4","mb-8","flex","flex-col","sm:flex-row","items-center","justify-between","gap-4","sticky","top-24","z-20"],[1,"flex","items-center","gap-4","w-full","sm:w-auto","overflow-x-auto","pb-1","sm:pb-0","no-scrollbar"],[1,"flex","items-center","gap-1","text-muted-foreground","bg-muted/50","px-3","py-1.5","rounded-lg"],[1,"material-icons","icon-sm"],[1,"text-xs","font-bold","whitespace-nowrap"],[1,"flex","gap-1"],["class","btn btn-sm rounded-lg transition-all duration-200 hover:bg-muted font-normal",3,"bg-primary","text-primary-foreground","shadow-md","btn-ghost","click",4,"ngFor","ngForOf"],["class","text-xs font-medium text-muted-foreground whitespace-nowrap bg-muted/30 px-3 py-1.5 rounded-full",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","mt-12 flex justify-center",4,"ngIf"],[3,"value"],[1,"form-group","space-y-2","animate-fade-in"],[1,"w-1","h-4","bg-secondary","rounded-full"],["id","categoryGroup","formControlName","categoryGroupId",1,"floating-input","pt-2","pb-2","h-12"],[1,"btn","btn-sm","rounded-lg","transition-all","duration-200","hover:bg-muted","font-normal",3,"click"],[1,"text-xs","font-medium","text-muted-foreground","whitespace-nowrap","bg-muted/30","px-3","py-1.5","rounded-full"],["class","grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","gap-6"],[3,"product",4,"ngFor","ngForOf"],[3,"product"],[1,"empty-state","card","flex","flex-col","items-center","justify-center","p-16","text-center","border-dashed"],[1,"empty-state-icon","w-24","h-24","rounded-full","bg-muted/50","flex","items-center","justify-center","mb-6"],[1,"material-icons","icon-4xl","text-muted-foreground/50"],[1,"empty-state-title","text-xl","font-bold","text-foreground"],[1,"empty-state-description","mt-2","text-muted-foreground"],[1,"btn","btn-primary","mt-6","rounded-full","px-8",3,"click"],["class","card overflow-hidden",4,"ngFor","ngForOf"],[1,"card","overflow-hidden"],[1,"skeleton-card","aspect-square","skeleton-shimmer"],[1,"p-4","space-y-3"],[1,"skeleton","skeleton-text","w-3/4"],[1,"skeleton","skeleton-text","w-1/2"],[1,"flex","justify-between","pt-2"],[1,"skeleton","h-8","w-24","rounded"],[1,"skeleton","h-10","w-10","rounded-full"],[1,"mt-12","flex","justify-center"],["class","card rounded-full p-1.5 flex items-center gap-1",4,"ngIf"],[1,"card","rounded-full","p-1.5","flex","items-center","gap-1"],["aria-label","\u0635\u0641\u062D\u0647 \u0642\u0628\u0644",1,"btn","btn-icon","rounded-full","hover:bg-muted",3,"click","disabled"],[4,"ngFor","ngForOf"],["aria-label","\u0635\u0641\u062D\u0647 \u0628\u0639\u062F",1,"btn","btn-icon","rounded-full","hover:bg-muted",3,"click","disabled"],[1,"w-9","h-9","rounded-full","flex","items-center","justify-center","text-sm","font-medium","transition-all","duration-200",3,"click","disabled"]],template:function(i,r){if(i&1){let l=I();a(0,"div",2)(1,"div",3)(2,"aside",4)(3,"form",5)(4,"div",6)(5,"span",7),s(6,"tune"),o(),a(7,"h3",8),s(8,"\u0641\u06CC\u0644\u062A\u0631\u0647\u0627"),o()(),a(9,"div",9)(10,"div",10),v(11,"input",11),a(12,"label",12),s(13,"\u062C\u0633\u062A\u062C\u0648\u06CC \u0645\u062D\u0635\u0648\u0644..."),o(),a(14,"span",13),s(15,"search"),o()(),a(16,"div",14)(17,"label",15),v(18,"span",16),s(19," \u062F\u0633\u062A\u0647\u200C\u0628\u0646\u062F\u06CC "),o(),a(20,"div",17)(21,"select",18)(22,"option",19),s(23,"\u0647\u0645\u0647 \u062F\u0633\u062A\u0647\u200C\u0647\u0627"),o(),g(24,Ue,2,2,"option",20),w(25,"async"),o()()(),g(26,Re,8,2,"div",21),w(27,"async"),a(28,"div",22)(29,"label",15),v(30,"span",23),s(31," \u0645\u062D\u062F\u0648\u062F\u0647 \u0642\u06CC\u0645\u062A (\u062A\u0648\u0645\u0627\u0646) "),o(),a(32,"div",24)(33,"div",17),v(34,"input",25),a(35,"label",26),s(36,"\u0627\u0632"),o()(),a(37,"div",17),v(38,"input",27),a(39,"label",26),s(40,"\u062A\u0627"),o()()()(),a(41,"div",28)(42,"label",29)(43,"span",30),s(44,"\u0641\u0642\u0637 \u06A9\u0627\u0644\u0627\u0647\u0627\u06CC \u0645\u0648\u062C\u0648\u062F"),o(),a(45,"input",31),y("change",function(){return x(l),b(r.toggleInStock())}),o()(),a(46,"label",29)(47,"span",30),s(48,"\u0645\u062D\u0635\u0648\u0644\u0627\u062A \u062A\u062E\u0641\u06CC\u0641\u200C\u062F\u0627\u0631"),o(),v(49,"input",32),o()()(),a(50,"button",33),y("click",function(){return x(l),b(r.clearFilters())}),a(51,"span",34),s(52,"clear_all"),o(),s(53," \u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627 "),o()()(),a(54,"main",35)(55,"div",36)(56,"div",37)(57,"div",38)(58,"span",39),s(59,"sort"),o(),a(60,"span",40),s(61,"\u0645\u0631\u062A\u0628\u200C\u0633\u0627\u0632\u06CC:"),o()(),a(62,"div",41),g(63,Be,2,9,"button",42),o()(),g(64,Ge,2,1,"div",43),w(65,"async"),o(),g(66,qe,4,2,"ng-container",44),w(67,"async"),g(68,He,2,2,"ng-template",null,0,O)(70,Ye,2,1,"div",45),w(71,"async"),o()()()}if(i&2){let l,d=N(69);c(3),p("formGroup",r.searchForm),c(19),p("ngValue",null),c(2),p("ngForOf",P(25,10,r.categories$)),c(2),p("ngIf",P(27,12,r.categoryGroups$)),c(19),p("checked",(l=r.searchForm.get("inStock"))==null?null:l.value),c(18),p("ngForOf",r.sortOptions),c(),p("ngIf",P(65,14,r.paginatedResult$)),c(2),p("ngIf",P(67,16,r.products$))("ngIfElse",d),c(4),p("ngIf",P(71,18,r.paginatedResult$))}},dependencies:[J,Q,W,K,Ee,he,we,Pe,_e,ye,fe,Ie,ve,xe,Ce,Se,Te,q],encapsulation:2});let n=u;return n})();function Ze(n,u){if(n&1&&(a(0,"div",38),s(1),o()),n&2){let t=m(2).ngIf,e=m();c(),C(" ",e.getDiscountPercentage(t.selectedVariant),"% ")}}function et(n,u){n&1&&(a(0,"span",39),s(1,"hourglass_empty"),o())}function tt(n,u){if(n&1&&(a(0,"span",40),s(1),w(2,"number"),o()),n&2){let t=m(2).ngIf;c(),C(" ",P(2,1,t.selectedVariant==null?null:t.selectedVariant.originalPrice)," ")}}function it(n,u){if(n&1){let t=I();a(0,"button",47),y("click",function(){let i=x(t).$implicit,r=m(2).$implicit,l=m(3);return b(l.selectAttribute(r.name,i.id))}),o()}if(n&2){let t=u.$implicit,e=m(2).$implicit,i=m(2).ngIf;le("background-color",t.hexCode),F("ring-2",i.selectedAttributes[e.name]===t.id)("ring-primary",i.selectedAttributes[e.name]===t.id)("ring-offset-2",i.selectedAttributes[e.name]===t.id)}}function nt(n,u){if(n&1&&(a(0,"div",45),g(1,it,1,8,"button",46),o()),n&2){let t=m().$implicit;c(),p("ngForOf",t.values)}}function rt(n,u){if(n&1){let t=I();a(0,"button",50),y("click",function(){let i=x(t).$implicit,r=m(2).$implicit,l=m(3);return b(l.selectAttribute(r.name,i.id))}),s(1),o()}if(n&2){let t=u.$implicit,e=m(2).$implicit,i=m(2).ngIf;F("btn-primary",i.selectedAttributes[e.name]===t.id)("btn-outline",i.selectedAttributes[e.name]!==t.id),c(),C(" ",t.displayValue," ")}}function ot(n,u){if(n&1&&(a(0,"div",48),g(1,rt,2,5,"button",49),o()),n&2){let t=m().$implicit;c(),p("ngForOf",t.values)}}function at(n,u){if(n&1&&(a(0,"div",41)(1,"div",42)(2,"span",21),s(3),o()(),g(4,nt,2,1,"div",43)(5,ot,2,1,"div",44),o()),n&2){let t=u.$implicit;c(3),G(t.displayName),c(),p("ngIf",t.name==="color"),c(),p("ngIf",t.name!=="color")}}function lt(n,u){if(n&1){let t=I();a(0,"div",51)(1,"button",52),y("click",function(){x(t);let i=m(2).ngIf,r=m();return b(r.increaseQuantity(i.cartItem,i.product,i.selectedVariant))}),s(2," + "),o(),a(3,"span",53),s(4),o(),a(5,"button",52),y("click",function(){x(t);let i=m(2).ngIf,r=m();return b(r.decreaseQuantity(i.cartItem))}),s(6," \u2212 "),o()()}if(n&2){let t=m(2).ngIf;c(),p("disabled",t.isUpdatingCart),c(3),C(" ",t.cartItem.quantity," "),c(),p("disabled",t.isUpdatingCart)}}function ut(n,u){n&1&&(a(0,"span",57)(1,"span",58),s(2,"add_shopping_cart"),o(),s(3," \u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F "),o())}function st(n,u){n&1&&(a(0,"span",57)(1,"span",59),s(2,"refresh"),o(),s(3," \u062F\u0631 \u062D\u0627\u0644 \u0627\u0641\u0632\u0648\u062F\u0646... "),o())}function ct(n,u){if(n&1){let t=I();a(0,"div",54)(1,"button",55),y("click",function(){x(t);let i=m(2).ngIf,r=m();return b(r.addToCart(i.product,i.selectedVariant))}),g(2,ut,4,0,"span",56)(3,st,4,0,"span",56),o()()}if(n&2){let t=m(2).ngIf,e=m();c(),F("btn-loading",t.isUpdatingCart),p("disabled",t.isUpdatingCart||!e.isInStock(t.selectedVariant)||!t.selectedVariant),c(),p("ngIf",!t.isUpdatingCart),c(),p("ngIf",t.isUpdatingCart)}}function dt(n,u){n&1&&(a(0,"div",60)(1,"a",61),s(2," \u0645\u0634\u0627\u0647\u062F\u0647 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F "),o()())}function pt(n,u){if(n&1&&(a(0,"div",10)(1,"div",11)(2,"div",12),v(3,"img",13),g(4,Ze,2,1,"div",14),o()(),a(5,"div",15)(6,"div",16)(7,"h1",17),s(8),o(),a(9,"div",18)(10,"div",19)(11,"span",20),s(12,"star"),o(),a(13,"span",21),s(14,"4.8"),o()(),v(15,"span",22),a(16,"div",23),g(17,et,2,0,"span",24),s(18),o()(),a(19,"div",25)(20,"span",26),s(21),w(22,"number"),a(23,"span",27),s(24,"\u062A\u0648\u0645\u0627\u0646"),o()(),g(25,tt,3,3,"span",28),o()(),a(26,"div",29),g(27,at,6,3,"div",30),o(),a(28,"div",31)(29,"div",32),g(30,lt,7,3,"div",33)(31,ct,4,5,"div",34)(32,dt,3,0,"div",35),a(33,"button",36)(34,"span",37),s(35,"favorite_border"),o()()()()()()),n&2){let t=m().ngIf,e=m();c(3),p("src",e.getProductIcon(t.product),ae)("alt",t.product.name),c(),p("ngIf",e.hasDiscount(t.selectedVariant)),c(4),G(t.product.name),c(8),p("ngClass",e.isInStock(t.selectedVariant)?"badge-success":"badge-destructive"),c(),p("ngIf",!(t.selectedVariant!=null&&t.selectedVariant.isUnlimited)&&e.isInStock(t.selectedVariant)),c(),C(" ",t.selectedVariant!=null&&t.selectedVariant.isUnlimited?"\u0645\u0648\u062C\u0648\u062F":e.isInStock(t.selectedVariant)?"\u0645\u0648\u062C\u0648\u062F \u062F\u0631 \u0627\u0646\u0628\u0627\u0631":"\u0646\u0627\u0645\u0648\u062C\u0648\u062F"," "),c(3),C(" ",P(22,13,(t.selectedVariant==null?null:t.selectedVariant.sellingPrice)||t.product.minPrice)," "),c(4),p("ngIf",e.hasDiscount(t.selectedVariant)),c(2),p("ngForOf",e.attributeTypes),c(3),p("ngIf",t.cartItem&&t.selectedVariant),c(),p("ngIf",!t.cartItem),c(),p("ngIf",t.cartItem)}}function mt(n,u){if(n&1&&(a(0,"div",3)(1,"nav",4)(2,"a",5),s(3,"\u062E\u0627\u0646\u0647"),o(),a(4,"span",6),s(5,"/"),o(),a(6,"a",7),s(7,"\u0645\u062D\u0635\u0648\u0644\u0627\u062A"),o(),a(8,"span",6),s(9,"/"),o(),a(10,"span",8),s(11),o()(),g(12,pt,36,15,"div",9),o()),n&2){let t=u.ngIf;c(11),G(t.product==null?null:t.product.name),c(),p("ngIf",t.product&&!t.isLoading)}}function gt(n,u){n&1&&(a(0,"div",62)(1,"span",63),s(2,"sync"),o()())}var $e=(()=>{let u=class u{constructor(e,i,r,l,d,f){this.route=e,this.productService=i,this.cartService=r,this.notificationService=l,this.mediaService=d,this.cdr=f,this.destroy$=new $,this.quantityUpdate$=new $,this.state={product:null,selectedVariant:null,selectedAttributes:{},cartItem:null,isLoading:!0,isUpdatingCart:!1,error:null},this.attributeTypes=[]}ngOnInit(){this.vm$=new M(this.state),L([this.route.paramMap,this.cartService.cart$]).pipe(A(([e,i])=>(this.id=e.get("id"),this.updateViewModel({isLoading:!0}),this.productService.getProductById(Number(this.id)).pipe(T(r=>({product:r,cart:i})),U(r=>{let l=r?.error?.message||"\u0645\u062D\u0635\u0648\u0644 \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F.";return this.updateViewModel({isLoading:!1,error:l}),k(null)})))),E(this.destroy$)).subscribe(e=>{if(e){let{product:i,cart:r}=e;this.extractAttributes(i);let l={};this.attributeTypes.forEach(_=>{l[_.name]=_.values[0]?.id||null});let d=this.findVariant(i,l),f=d&&r?.cartItems.find(_=>_.variantId===d.id)||null;this.updateViewModel({product:i,selectedVariant:d,selectedAttributes:l,cartItem:f,isLoading:!1,error:null})}}),this.quantityUpdate$.pipe(D(500),A(({item:e,quantity:i})=>(this.updateViewModel({isUpdatingCart:!0}),this.cartService.updateCartItem(e.id,{quantity:i,rowVersion:e.rowVersion}).pipe(R(()=>this.updateViewModel({isUpdatingCart:!1})),U(()=>k(null))))),E(this.destroy$)).subscribe()}updateViewModel(e){this.state=j(j({},this.state),e),this.vm$.next(this.state),this.cdr.markForCheck()}extractAttributes(e){let i=new Map;e.variants.forEach(r=>{for(let l in r.attributes){let d=r.attributes[l];i.has(d.typeName)||i.set(d.typeName,{id:0,name:d.typeName,displayName:d.typeDisplayName,values:[]});let f=i.get(d.typeName);f.values.some(_=>_.id===d.id)||f.values.push({id:d.id,value:d.value,displayValue:d.displayValue,hexCode:d.hexCode})}}),this.attributeTypes=Array.from(i.values())}findVariant(e,i){return e.variants.find(r=>Object.keys(i).every(l=>{let d=i[l];return d===null?!0:r.attributes[l.toLowerCase()]?.id===d}))||e.variants[0]||null}selectAttribute(e,i){let r=ne(j({},this.state.selectedAttributes),{[e]:i}),l=this.findVariant(this.state.product,r),d=l&&this.cartService.currentCartValue?.cartItems.find(f=>f.variantId===l.id)||null;this.updateViewModel({selectedAttributes:r,selectedVariant:l,cartItem:d})}getProductIcon(e){let r=e.images?.find(l=>l.isPrimary)?.url||e.iconUrl||e.images?.[0]?.url;return this.mediaService.getMediaUrl(r)}hasDiscount(e){return!!e&&e.originalPrice>e.sellingPrice}getDiscountPercentage(e){return e?Math.round((e.originalPrice-e.sellingPrice)/e.originalPrice*100):0}isInStock(e){return!!e&&(e.isUnlimited||e.stock>0)}isStockAvailableForIncrease(e,i){return e.isUnlimited?!0:i?e.stock>i.quantity:e.stock>0}addToCart(e,i){this.updateViewModel({isUpdatingCart:!0});let r=i.rowVersion||i.RowVersion;this.cartService.addToCart({variantId:i.id,quantity:1,variantRowVersion:r}).pipe(R(()=>this.updateViewModel({isUpdatingCart:!1}))).subscribe({error:l=>{l.status===409?(this.notificationService.show("\u0645\u0648\u062C\u0648\u062F\u06CC \u06CC\u0627 \u0642\u06CC\u0645\u062A \u0645\u062D\u0635\u0648\u0644 \u062A\u063A\u06CC\u06CC\u0631 \u06A9\u0631\u062F\u0647 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.","info"),this.reloadProduct()):this.notificationService.show(l?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F","error")}})}increaseQuantity(e,i,r){this.isStockAvailableForIncrease(r,e)&&this.quantityUpdate$.next({item:e,quantity:e.quantity+1})}decreaseQuantity(e){e.quantity>1?this.quantityUpdate$.next({item:e,quantity:e.quantity-1}):(this.updateViewModel({isUpdatingCart:!0}),this.cartService.removeFromCart(e.id).pipe(R(()=>this.updateViewModel({isUpdatingCart:!1}))).subscribe())}reloadProduct(){this.updateViewModel({isLoading:!0,error:null}),this.productService.getProductById(Number(this.id)).pipe(E(this.destroy$),U(e=>{let i=e?.error?.message||"\u0645\u062D\u0635\u0648\u0644 \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F.";return this.updateViewModel({isLoading:!1,error:i}),k(null)})).subscribe(e=>{if(e){let i=this.cartService.currentCartValue;this.extractAttributes(e);let r=this.findVariant(e,this.state.selectedAttributes),l=r&&i?.cartItems.find(d=>d.variantId===r.id)||null;this.updateViewModel({product:e,selectedVariant:r,cartItem:l,isLoading:!1})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};u.\u0275fac=function(i){return new(i||u)(h(H),h(X),h(ge),h(me),h(ke),h(z))},u.\u0275cmp=B({type:u,selectors:[["app-product-page"]],inputs:{id:"id"},decls:5,vars:4,consts:[["loadingOrError",""],[1,"min-h-screen","pb-12","bg-background"],["class","container py-8",4,"ngIf","ngIfElse"],[1,"container","py-8"],[1,"flex","items-center","text-sm","text-muted-foreground","mb-8","gap-2","animate-fade-in-down"],["routerLink","/",1,"hover:text-foreground","transition-colors"],[1,"text-xs","opacity-50"],["routerLink","/products",1,"hover:text-foreground","transition-colors"],[1,"text-foreground","font-medium","truncate"],["class","grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12 animate-fade-in",4,"ngIf"],[1,"grid","grid-cols-1","lg:grid-cols-12","gap-8","lg:gap-12","animate-fade-in"],[1,"lg:col-span-5"],[1,"aspect-square","bg-white","rounded-2xl","border","border-border","p-8","flex","items-center","justify-center","relative","overflow-hidden"],[1,"max-w-full","max-h-full","object-contain","mix-blend-multiply",3,"src","alt"],["class","absolute top-4 left-4 badge badge-destructive text-white px-3 py-1 rounded text-sm font-bold animate-delay-200 animate-fade-in",4,"ngIf"],[1,"lg:col-span-7","space-y-8","animate-delay-100","animate-fade-in"],[1,"border-b","border-border","pb-6","space-y-4"],[1,"text-3xl","font-black","text-foreground"],[1,"flex","items-center","gap-4","text-sm"],[1,"flex","items-center","gap-1","text-yellow-500"],[1,"material-icons","icon-lg"],[1,"font-bold","text-foreground"],[1,"w-1","h-1","bg-border","rounded-full"],[1,"badge","badge-sm",3,"ngClass"],["class","material-icons icon-xs me-1 icon-pulse",4,"ngIf"],[1,"flex","items-baseline","gap-3","pt-2"],[1,"text-3xl","font-bold","text-foreground"],[1,"text-sm","font-normal","text-muted-foreground"],["class","text-lg text-muted-foreground line-through decoration-destructive/50",4,"ngIf"],[1,"space-y-6"],["class","space-y-3",4,"ngFor","ngForOf"],[1,"fixed","bottom-0","left-0","right-0","p-4","bg-background","border-t","border-border","lg:static","lg:border-none","lg:p-0","lg:bg-transparent","z-20"],[1,"container","lg:px-0","flex","gap-4"],["class","flex items-center border border-border rounded-lg h-12 bg-background",4,"ngIf"],["class","flex-1",4,"ngIf"],["class","flex-1 lg:flex-none",4,"ngIf"],["title","\u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0639\u0644\u0627\u0642\u0647\u200C\u0645\u0646\u062F\u06CC\u200C\u0647\u0627",1,"btn","btn-outline","btn-lg","btn-icon","group"],[1,"material-icons","group-hover:icon-beat","text-destructive"],[1,"absolute","top-4","left-4","badge","badge-destructive","text-white","px-3","py-1","rounded","text-sm","font-bold","animate-delay-200","animate-fade-in"],[1,"material-icons","icon-xs","me-1","icon-pulse"],[1,"text-lg","text-muted-foreground","line-through","decoration-destructive/50"],[1,"space-y-3"],[1,"flex","justify-between","text-sm"],["class","flex flex-wrap gap-3",4,"ngIf"],["class","flex flex-wrap gap-2",4,"ngIf"],[1,"flex","flex-wrap","gap-3"],["class","w-8 h-8 rounded-full border border-border shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all",3,"backgroundColor","ring-2","ring-primary","ring-offset-2","click",4,"ngFor","ngForOf"],[1,"w-8","h-8","rounded-full","border","border-border","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary","transition-all",3,"click"],[1,"flex","flex-wrap","gap-2"],["class","px-4 py-2 rounded-lg text-sm border transition-all focus:outline-none",3,"btn-primary","btn-outline","click",4,"ngFor","ngForOf"],[1,"px-4","py-2","rounded-lg","text-sm","border","transition-all","focus:outline-none",3,"click"],[1,"flex","items-center","border","border-border","rounded-lg","h-12","bg-background"],[1,"w-12","h-full","flex","items-center","justify-center","text-primary","hover:bg-muted","text-xl","font-bold","transition-colors",3,"click","disabled"],[1,"w-10","text-center","font-bold","text-lg","tabular-nums"],[1,"flex-1"],[1,"btn","btn-primary","btn-lg","w-full","font-bold","text-base","group",3,"click","disabled"],["class","flex items-center justify-center gap-2",4,"ngIf"],[1,"flex","items-center","justify-center","gap-2"],[1,"material-icons","group-hover:icon-shake"],[1,"material-icons","icon-spin"],[1,"flex-1","lg:flex-none"],["routerLink","/cart",1,"btn","btn-outline","btn-lg","w-full","lg:w-auto","font-bold"],[1,"container","py-20","flex","justify-center"],[1,"material-icons","icon-4xl","animate-spin","text-muted-foreground"]],template:function(i,r){if(i&1&&(a(0,"div",1),g(1,mt,13,2,"div",2),w(2,"async"),g(3,gt,3,0,"ng-template",null,0,O),o()),i&2){let l=N(4);c(),p("ngIf",P(2,2,r.vm$))("ngIfElse",l)}},dependencies:[J,se,Q,W,K,pe,Ve,q,ce],encapsulation:2});let n=u;return n})();var Lt=[{path:"",component:ie},{path:"category-group/:groupId",component:ie},{path:":id",component:$e}];export{Lt as PRODUCTS_ROUTES};
