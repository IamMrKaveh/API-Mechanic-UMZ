import{a as V}from"./chunk-6NHH2MS5.js";import{B as R,b as P,c as d,d as U,e as D,f as M,g as j,i as $,m as G,p as L,u as Y,v as B,w as q,x as Z}from"./chunk-6R33SLKE.js";import{b as X}from"./chunk-H442PVK2.js";import{a as E}from"./chunk-U4BXHFS4.js";import"./chunk-ISFWZGBK.js";import{b as W,d as A,i as k,x as T,z as I}from"./chunk-QOTKPPKC.js";import{Ab as u,Bb as v,Ca as r,Cb as N,D as b,F as x,Kb as Q,L as O,M as S,Na as m,Sa as F,Xa as f,aa as H,ba as J,ca as _,f as y,gb as l,hb as t,ib as i,jb as p,pb as K,sb as g,tb as C,w as z,za as w}from"./chunk-6VZDFBBI.js";import"./chunk-4CLCTAJ7.js";var le=n=>({"input-error":n});function me(n,s){n&1&&(t(0,"small"),u(1,"\u0648\u0627\u0631\u062F \u06A9\u0631\u062F\u0646 \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0627\u0644\u0632\u0627\u0645\u06CC \u0627\u0633\u062A."),i())}function ce(n,s){n&1&&(t(0,"small"),u(1,"\u0641\u0631\u0645\u062A \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0635\u062D\u06CC\u062D \u0646\u06CC\u0633\u062A."),i())}function pe(n,s){if(n&1&&(t(0,"div",20),f(1,me,2,0,"small",21)(2,ce,2,0,"small",21),i()),n&2){let c=C();r(),l("ngIf",c.phoneNumber==null||c.phoneNumber.errors==null?null:c.phoneNumber.errors.required),r(),l("ngIf",c.phoneNumber==null||c.phoneNumber.errors==null?null:c.phoneNumber.errors.pattern)}}function de(n,s){n&1&&(_(),t(0,"svg",22),p(1,"circle",23)(2,"path",24),i())}var ee=(()=>{let s=class s{constructor(o,a,e,h){this.authService=o,this.router=a,this.notificationService=e,this.route=h,this.destroy$=new y,this.logoUrl="/assets/icons/ledka-icon.jpg",this.title="\u0648\u0631\u0648\u062F | \u062B\u0628\u062A\u200C\u0646\u0627\u0645",this.submitButtonText="\u0648\u0631\u0648\u062F",this.isSubmitting=!1,this.returnUrl="/"}ngOnInit(){this.route.queryParams.pipe(b(1)).subscribe(o=>{this.returnUrl=o.returnUrl||"/"}),this.loginForm=new M({phoneNumber:new j("",[d.required,d.pattern(/^09\d{9}$/)])}),this.isSubmitting=!1}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get phoneNumber(){return this.loginForm.get("phoneNumber")}goBack(){this.router.navigate(["/"])}onSubmit(){if(this.loginForm.invalid||this.isSubmitting){this.loginForm.markAllAsTouched();return}this.isSubmitting=!0;let o=this.loginForm.value.phoneNumber;this.authService.login({phoneNumber:o}).pipe(x(()=>this.isSubmitting=!1),S(this.destroy$)).subscribe({next:()=>{this.router.navigate(["/auth/token"],{queryParams:{phoneNumber:o,returnUrl:this.returnUrl}})},error:a=>{let e=a?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u06A9\u062F. \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.";this.notificationService.show(e,"error")}})}};s.\u0275fac=function(a){return new(a||s)(m(V),m(I),m(E),m(T))},s.\u0275cmp=F({type:s,selectors:[["app-auth-page"]],decls:34,vars:10,consts:[[1,"flex","min-h-screen","items-center","justify-center","bg-muted","p-4"],[1,"card","w-full","max-w-sm"],[1,"flex","flex-col","p-6","space-y-1"],[1,"flex","justify-between","items-center","mb-4"],["alt","\u0644\u0648\u06AF\u0648",1,"h-10","mx-auto",3,"src"],["aria-label","\u0628\u0627\u0632\u06AF\u0634\u062A",1,"btn","btn-ghost","btn-icon","rounded-full",3,"click"],[1,"material-icons","text-muted-foreground"],[1,"font-semibold","tracking-tight","text-2xl","text-center","text-foreground"],[1,"text-sm","text-muted-foreground","text-center"],[1,"p-6","pt-0"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"space-y-2"],["for","phone",1,"sr-only"],["type","tel","id","phone","formControlName","phoneNumber","placeholder","09*********","minlength","11","maxlength","11","inputmode","tel","autocomplete","tel","autofocus","",1,"input","text-center","tracking-wider",3,"ngClass"],["class","text-xs text-destructive text-right px-1",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-md","w-full",3,"disabled"],["class","animate-spin me-2 h-5 w-5","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",4,"ngIf"],[1,"flex","items-center","p-6","pt-0"],[1,"text-center","text-xs","text-muted-foreground"],["href","#",1,"underline","underline-offset-4","hover:text-primary"],[1,"text-xs","text-destructive","text-right","px-1"],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","me-2","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V4a.5.5 0 01.5.5v3.5a.5.5 0 01-1 0V5.7a7 7 0 00-7 7 .5.5 0 01-1 0z",1,"opacity-75"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),p(4,"img",4),t(5,"button",5),g("click",function(){return e.goBack()}),t(6,"span",6),u(7,"arrow_forward"),i()()(),t(8,"h3",7),u(9),i(),t(10,"p",8),u(11,"\u0633\u0644\u0627\u0645"),p(12,"br"),u(13,"\u0644\u0637\u0641\u0627 \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u062E\u0648\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F"),i()(),t(14,"div",9)(15,"form",10),g("ngSubmit",function(){return e.onSubmit()}),t(16,"div",11)(17,"label",12),u(18,"\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644"),i(),p(19,"input",13),f(20,pe,3,2,"div",14),i(),t(21,"button",15),f(22,de,3,0,"svg",16),t(23,"span"),u(24),i()()()(),t(25,"div",17)(26,"p",18),u(27," \u0648\u0631\u0648\u062F \u0634\u0645\u0627 \u0628\u0647 \u0645\u0639\u0646\u0627\u06CC \u067E\u0630\u06CC\u0631\u0634 "),t(28,"a",19),u(29,"\u0634\u0631\u0627\u06CC\u0637"),i(),u(30," \u0648 "),t(31,"a",19),u(32,"\u0642\u0648\u0627\u0646\u06CC\u0646 \u062D\u0631\u06CC\u0645 \u062E\u0635\u0648\u0635\u06CC"),i(),u(33," \u0627\u0633\u062A. "),i()()()()),a&2&&(r(4),l("src",e.logoUrl,w),r(5),v(e.title),r(6),l("formGroup",e.loginForm),r(4),l("ngClass",Q(8,le,(e.phoneNumber==null?null:e.phoneNumber.invalid)&&(e.phoneNumber==null?null:e.phoneNumber.touched))),r(),l("ngIf",(e.phoneNumber==null?null:e.phoneNumber.invalid)&&((e.phoneNumber==null?null:e.phoneNumber.dirty)||(e.phoneNumber==null?null:e.phoneNumber.touched))),r(),l("disabled",!e.loginForm.valid||e.isSubmitting),r(),l("ngIf",e.isSubmitting),r(2),v(e.isSubmitting?"\u062F\u0631 \u062D\u0627\u0644 \u0627\u0631\u0633\u0627\u0644...":e.submitButtonText))},dependencies:[k,W,A,R,$,P,U,D,B,q,G,L],encapsulation:2});let n=s;return n})();function he(n,s){if(n&1&&(t(0,"span",20),u(1),i()),n&2){let c=C();r(),N(" ",c.formattedTime," \u0645\u0627\u0646\u062F\u0647 \u062A\u0627 \u062F\u0631\u06CC\u0627\u0641\u062A \u0645\u062C\u062F\u062F \u06A9\u062F ")}}function fe(n,s){if(n&1){let c=K();t(0,"button",21),g("click",function(){H(c);let a=C();return J(a.resendCode())}),u(1," \u062F\u0631\u06CC\u0627\u0641\u062A \u0645\u062C\u062F\u062F \u06A9\u062F "),i()}}function ge(n,s){n&1&&(_(),t(0,"svg",22),p(1,"circle",23)(2,"path",24),i())}var te=(()=>{let s=class s{constructor(o,a,e,h,ie){this.route=o,this.router=a,this.authService=e,this.cartService=h,this.notificationService=ie,this.logoUrl="/assets/icons/ledka-icon.jpg",this.title="\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F",this.descriptionPrefix="\u06A9\u062F \u067E\u06CC\u0627\u0645\u06A9 \u0634\u062F\u0647 \u0628\u0647 \u0634\u0645\u0627\u0631\u0647",this.descriptionSuffix="\u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F.",this.phoneNumber="",this.isSubmitting=!1,this.returnUrl="/",this.destroy$=new y,this.codeLength=6,this.timerDuration=120,this.isTimerActive=!1,this.formattedTime=""}ngOnInit(){this.route.queryParams.pipe(b(1)).subscribe(o=>{this.phoneNumber=o.phoneNumber,this.returnUrl=o.returnUrl||"/",this.phoneNumber||this.router.navigate(["/auth"])}),this.codeForm=new M({verificationCode:new j("",[d.required,d.minLength(this.codeLength),d.maxLength(this.codeLength),d.pattern("^[0-9]*$")])}),this.startTimer()}startTimer(){this.isTimerActive=!0;let o=this.timerDuration;z(1e3).pipe(S(this.destroy$),b(this.timerDuration)).subscribe({next:()=>{o--;let a=Math.floor(o/60),e=o%60;this.formattedTime=`${a.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`},complete:()=>{this.isTimerActive=!1}})}goBack(){this.router.navigate(["/auth"])}submitCode(){if(this.codeForm.invalid)return;this.isSubmitting=!0;let o=this.codeForm.get("verificationCode")?.value;this.authService.verifyOtp({phoneNumber:this.phoneNumber,code:o}).pipe(O(()=>this.cartService.getMyCart()),x(()=>this.isSubmitting=!1),S(this.destroy$)).subscribe({next:()=>{this.notificationService.show("\u0648\u0631\u0648\u062F \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u0627\u0646\u062C\u0627\u0645 \u0634\u062F.","success"),this.router.navigateByUrl(this.returnUrl)},error:a=>{let e=a.status===429?"\u062A\u0639\u062F\u0627\u062F \u062A\u0644\u0627\u0634\u200C\u0647\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u06A9\u062F \u062C\u062F\u06CC\u062F \u062F\u0631\u06CC\u0627\u0641\u062A \u06A9\u0646\u06CC\u062F.":a.error?.message||"\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0646\u0627\u0645\u0639\u062A\u0628\u0631 \u0627\u0633\u062A.";this.notificationService.show(e,"error")}})}resendCode(){this.isTimerActive||(this.isSubmitting=!0,this.authService.login({phoneNumber:this.phoneNumber}).pipe(x(()=>this.isSubmitting=!1)).subscribe({next:()=>{this.notificationService.show("\u06A9\u062F \u062C\u062F\u06CC\u062F \u0627\u0631\u0633\u0627\u0644 \u0634\u062F","success"),this.startTimer()},error:()=>this.notificationService.show("\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u0645\u062C\u062F\u062F \u06A9\u062F","error")}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};s.\u0275fac=function(a){return new(a||s)(m(T),m(I),m(V),m(X),m(E))},s.\u0275cmp=F({type:s,selectors:[["app-token-page"]],decls:28,vars:13,consts:[[1,"flex","min-h-screen","items-center","justify-center","bg-muted","p-4"],[1,"card","w-full","max-w-sm"],[1,"flex","flex-col","p-6","space-y-1"],[1,"flex","justify-between","items-center","mb-4"],["alt","\u0644\u0648\u06AF\u0648",1,"h-10","mx-auto",3,"src"],["aria-label","\u0628\u0627\u0632\u06AF\u0634\u062A",1,"btn","btn-ghost","btn-icon","rounded-full",3,"click"],[1,"material-icons","text-muted-foreground"],[1,"font-semibold","tracking-tight","text-2xl","text-center","text-foreground"],[1,"text-sm","text-muted-foreground","text-center"],[1,"font-bold","text-foreground"],[1,"p-6","pt-0"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"space-y-2"],["for","verificationCode",1,"sr-only"],["type","tel","inputmode","numeric","id","verificationCode","formControlName","verificationCode","pattern","^[0-9]*$","autocomplete","one-time-code","autofocus","","required","",1,"input","h-12","text-2xl","text-center","tracking-[0.5em]",3,"maxlength","minlength"],[1,"text-center","text-sm","h-6"],["class","text-muted-foreground",4,"ngIf"],["type","button","class","btn-link",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-md","w-full",3,"disabled"],["class","animate-spin me-2 h-5 w-5","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",4,"ngIf"],[1,"text-muted-foreground"],["type","button",1,"btn-link",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","me-2","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V4a.5.5 0 01.5.5v3.5a.5.5 0 01-1 0V5.7a7 7 0 00-7 7 .5.5 0 01-1 0z",1,"opacity-75"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),p(4,"img",4),t(5,"button",5),g("click",function(){return e.goBack()}),t(6,"span",6),u(7,"arrow_forward"),i()()(),t(8,"h3",7),u(9),i(),t(10,"p",8),u(11),t(12,"span",9),u(13),i(),u(14),i()(),t(15,"div",10)(16,"form",11),g("ngSubmit",function(){return e.submitCode()}),t(17,"div",12)(18,"label",13),u(19,"\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F"),i(),p(20,"input",14),i(),t(21,"div",15),f(22,he,2,1,"span",16)(23,fe,2,0,"button",17),i(),t(24,"button",18),f(25,ge,3,0,"svg",19),t(26,"span"),u(27),i()()()()()()),a&2&&(r(4),l("src",e.logoUrl,w),r(5),v(e.title),r(2),N(" ",e.descriptionPrefix," "),r(2),v(e.phoneNumber),r(),N(" ",e.descriptionSuffix," "),r(2),l("formGroup",e.codeForm),r(4),l("maxlength",e.codeLength)("minlength",e.codeLength),r(2),l("ngIf",e.isTimerActive),r(),l("ngIf",!e.isTimerActive),r(),l("disabled",e.codeForm.invalid||e.isSubmitting),r(),l("ngIf",e.isSubmitting),r(2),v(e.isSubmitting?"\u062F\u0631 \u062D\u0627\u0644 \u062A\u0627\u06CC\u06CC\u062F...":"\u062A\u0627\u06CC\u06CC\u062F \u0648 \u0627\u062F\u0627\u0645\u0647"))},dependencies:[k,A,R,$,P,U,D,Y,B,q,Z,G,L],encapsulation:2});let n=s;return n})();var Te=[{path:"",component:ee},{path:"token",component:te}];export{Te as AUTH_ROUTES};
