import{b as T,c as h,d as A,e as P,f as j,g as I,i as D,p as U,q as M,w as $,z as V}from"./chunk-BAR23WDL.js";import{a as E}from"./chunk-GAYMAGXT.js";import{b as Q}from"./chunk-KL5Q5BU5.js";import{a as F}from"./chunk-NKWORGOE.js";import"./chunk-WNMS36QR.js";import{b as J,g as K,w,y as k}from"./chunk-PMZJQWMM.js";import{B as S,D as C,Db as q,Hb as b,Jb as v,M as L,N as _,Rb as O,Sa as u,Sb as x,Ub as r,Vb as z,Wb as p,_a as s,ba as B,ca as R,d as y,db as N,dc as H,qb as l,sb as m,v as G,wb as d,xb as t,yb as i,zb as g}from"./chunk-OU7FPMWK.js";import"./chunk-4CLCTAJ7.js";var re=(o,c)=>({"is-invalid":o,"is-valid":c});function oe(o,c){o&1&&(t(0,"span"),r(1,"\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0627\u0644\u0632\u0627\u0645\u06CC \u0627\u0633\u062A"),i())}function ue(o,c){o&1&&(t(0,"span"),r(1,"\u0641\u0631\u0645\u062A \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0635\u062D\u06CC\u062D \u0646\u06CC\u0633\u062A"),i())}function ae(o,c){if(o&1&&(t(0,"div",17),l(1,oe,2,0,"span"),l(2,ue,2,0,"span"),i()),o&2){let n=v();u(),m(!(n.phoneNumber==null||n.phoneNumber.errors==null)&&n.phoneNumber.errors.required?1:-1),u(),m(!(n.phoneNumber==null||n.phoneNumber.errors==null)&&n.phoneNumber.errors.pattern?2:-1)}}function se(o,c){if(o&1&&(t(0,"span",19),r(1),t(2,"span",25),r(3,"login"),i()()),o&2){let n=v();u(),p(" ",n.submitButtonText," ")}}function le(o,c){o&1&&(t(0,"span",19)(1,"span",26),r(2,"refresh"),i(),r(3," \u062F\u0631 \u062D\u0627\u0644 \u067E\u0631\u062F\u0627\u0632\u0634 "),i())}var W=(()=>{class o{constructor(n,a,e,f){this.authService=n,this.router=a,this.notificationService=e,this.route=f,this.destroy$=new y,this.logoUrl="/assets/icons/ledka-icon.jpg",this.title="\u0648\u0631\u0648\u062F | \u062B\u0628\u062A\u200C\u0646\u0627\u0645",this.submitButtonText="\u0648\u0631\u0648\u062F",this.isSubmitting=!1,this.returnUrl="/"}ngOnInit(){this.route.queryParams.pipe(S(1)).subscribe(n=>{this.returnUrl=n.returnUrl||"/"}),this.loginForm=new j({phoneNumber:new I("",[h.required,h.pattern(/^09\d{9}$/)])}),this.isSubmitting=!1}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get phoneNumber(){return this.loginForm.get("phoneNumber")}goBack(){this.router.navigate(["/"])}onSubmit(){if(this.loginForm.invalid||this.isSubmitting){this.loginForm.markAllAsTouched();return}this.isSubmitting=!0;let n=this.loginForm.value.phoneNumber;this.authService.login({phoneNumber:n}).pipe(C(()=>this.isSubmitting=!1),_(this.destroy$)).subscribe({next:()=>{this.router.navigate(["/auth/token"],{queryParams:{phoneNumber:n,returnUrl:this.returnUrl}})},error:a=>{let e=a?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u06A9\u062F. \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.";this.notificationService.show(e,"error")}})}static{this.\u0275fac=function(a){return new(a||o)(s(E),s(k),s(F),s(w))}}static{this.\u0275cmp=N({type:o,selectors:[["app-auth-page"]],decls:36,vars:12,consts:[[1,"flex","min-h-screen","items-center","justify-center","bg-muted/40","p-4"],[1,"w-full","max-w-[420px]","animate-fade-in-up"],[1,"card","card-elevated","overflow-hidden"],[1,"flex","flex-col","items-center","p-8","space-y-2","text-center"],[1,"mb-6","icon-wrapper","icon-wrapper-xl","icon-wrapper-primary","rounded-2xl","ring-1","ring-primary/20"],[1,"material-icons","icon-2xl"],[1,"text-2xl","font-bold","tracking-tight","text-foreground"],[1,"text-sm","text-muted-foreground"],[1,"px-8","pb-8"],[1,"form-group","space-y-5",3,"ngSubmit","formGroup"],[1,"form-group"],["for","phone",1,"form-label","sr-only"],[1,"relative"],["type","tel","id","phone","formControlName","phoneNumber","placeholder","09123456789","maxlength","11","inputmode","numeric","autocomplete","tel","autofocus","",1,"input","input-lg","text-center","tracking-widest","ltr-input","pl-10",3,"ngClass"],[1,"absolute","inset-y-0","right-3","flex","items-center","pointer-events-none"],[1,"material-icons","icon-lg","text-muted-foreground"],[1,"min-h-[20px]","mt-1"],[1,"form-error","justify-center","animate-fade-in"],["type","submit",1,"btn","btn-primary","btn-lg","w-full","font-bold","shadow-md","btn-glow","group",3,"disabled"],[1,"flex","items-center","justify-center","gap-2"],[1,"border-t","border-border","bg-muted/30","p-6","text-center"],[1,"text-xs","text-muted-foreground","leading-relaxed"],["href","#",1,"font-medium","text-primary","hover:underline","underline-offset-4","transition-colors"],[1,"mt-4","btn","btn-link","btn-sm","text-muted-foreground","hover:text-foreground","icon-btn",3,"click"],[1,"material-icons","icon-sm","mr-1","icon-shake"],[1,"material-icons","icon-sm","group-hover:icon-pulse"],[1,"material-icons","icon-spin"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),r(6,"lock_person"),i()(),t(7,"h3",6),r(8),i(),t(9,"p",7),r(10," \u0644\u0637\u0641\u0627 \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u062E\u0648\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F "),i()(),t(11,"div",8)(12,"form",9),b("ngSubmit",function(){return e.onSubmit()}),t(13,"div",10)(14,"label",11),r(15,"\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644"),i(),t(16,"div",12),g(17,"input",13),t(18,"span",14)(19,"span",15),r(20,"smartphone"),i()()(),t(21,"div",16),l(22,ae,3,2,"div",17),i()(),t(23,"button",18),l(24,se,4,1,"span",19),l(25,le,4,0,"span",19),i()()(),t(26,"div",20)(27,"p",21),r(28," \u0648\u0631\u0648\u062F \u0634\u0645\u0627 \u0628\u0647 \u0645\u0639\u0646\u0627\u06CC \u067E\u0630\u06CC\u0631\u0634 "),t(29,"a",22),r(30," \u0634\u0631\u0627\u06CC\u0637 \u0648 \u0642\u0648\u0627\u0646\u06CC\u0646 "),i(),r(31," \u0627\u0633\u062A. "),i(),t(32,"button",23),b("click",function(){return e.goBack()}),t(33,"span",24),r(34,"arrow_forward"),i(),r(35," \u0628\u0627\u0632\u06AF\u0634\u062A \u0628\u0647 \u062E\u0627\u0646\u0647 "),i()()()()()),a&2&&(u(8),p(" ",e.title," "),u(4),d("formGroup",e.loginForm),u(5),d("ngClass",H(9,re,(e.phoneNumber==null?null:e.phoneNumber.invalid)&&(e.phoneNumber==null?null:e.phoneNumber.touched),(e.phoneNumber==null?null:e.phoneNumber.valid)&&(e.phoneNumber==null?null:e.phoneNumber.touched))),u(5),m(e.phoneNumber!=null&&e.phoneNumber.invalid&&(e.phoneNumber!=null&&e.phoneNumber.dirty||e.phoneNumber!=null&&e.phoneNumber.touched)?22:-1),u(),x("btn-loading",e.isSubmitting),d("disabled",!e.loginForm.valid||e.isSubmitting),u(),m(e.isSubmitting?-1:24),u(),m(e.isSubmitting?25:-1))},dependencies:[K,J,V,D,T,A,P,$,M,U],encapsulation:2})}}return o})();function me(o,c){if(o&1&&(t(0,"span",24),r(1),i()),o&2){let n=v();u(),p(" ",n.formattedTime," ")}}function ce(o,c){if(o&1){let n=q();t(0,"button",32),b("click",function(){B(n);let e=v();return R(e.resendCode())}),r(1," \u0627\u0631\u0633\u0627\u0644 \u0645\u062C\u062F\u062F \u06A9\u062F "),t(2,"span",33),r(3,"refresh"),i()()}}function de(o,c){o&1&&(t(0,"span",30),r(1,"check_circle"),i())}var X=(()=>{class o{constructor(n,a,e,f,Y){this.route=n,this.router=a,this.authService=e,this.cartService=f,this.notificationService=Y,this.logoUrl="/assets/icons/ledka-icon.jpg",this.title="\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F",this.descriptionPrefix="\u06A9\u062F \u067E\u06CC\u0627\u0645\u06A9 \u0634\u062F\u0647 \u0628\u0647 \u0634\u0645\u0627\u0631\u0647",this.descriptionSuffix="\u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F.",this.phoneNumber="",this.isSubmitting=!1,this.returnUrl="/",this.destroy$=new y,this.codeLength=6,this.timerDuration=120,this.isTimerActive=!1,this.formattedTime="",this.percent=100}ngOnInit(){this.route.queryParams.pipe(S(1)).subscribe(n=>{this.phoneNumber=n.phoneNumber,this.returnUrl=n.returnUrl||"/",this.phoneNumber||this.router.navigate(["/auth"])}),this.codeForm=new j({verificationCode:new I("",[h.required,h.minLength(this.codeLength),h.maxLength(this.codeLength),h.pattern("^[0-9]*$")])}),this.startTimer()}startTimer(){this.isTimerActive=!0,this.percent=100;let n=this.timerDuration;G(1e3).pipe(_(this.destroy$),S(this.timerDuration)).subscribe({next:()=>{n--;let a=Math.floor(n/60),e=n%60;this.formattedTime=`${a.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`,this.percent=n/this.timerDuration*100},complete:()=>{this.isTimerActive=!1,this.percent=0}})}goBack(){this.router.navigate(["/auth"])}submitCode(){if(this.codeForm.invalid)return;this.isSubmitting=!0;let n=this.codeForm.get("verificationCode")?.value;this.authService.verifyOtp({phoneNumber:this.phoneNumber,code:n}).pipe(L(()=>this.cartService.getMyCart()),C(()=>this.isSubmitting=!1),_(this.destroy$)).subscribe({next:()=>{this.notificationService.show("\u0648\u0631\u0648\u062F \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u0627\u0646\u062C\u0627\u0645 \u0634\u062F.","success"),this.router.navigateByUrl(this.returnUrl)},error:a=>{let e=a.status===429?"\u062A\u0639\u062F\u0627\u062F \u062A\u0644\u0627\u0634\u200C\u0647\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u06A9\u062F \u062C\u062F\u06CC\u062F \u062F\u0631\u06CC\u0627\u0641\u062A \u06A9\u0646\u06CC\u062F.":a.error?.message||"\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0646\u0627\u0645\u0639\u062A\u0628\u0631 \u0627\u0633\u062A.";this.notificationService.show(e,"error")}})}resendCode(){this.isTimerActive||(this.isSubmitting=!0,this.authService.login({phoneNumber:this.phoneNumber}).pipe(C(()=>this.isSubmitting=!1)).subscribe({next:()=>{this.notificationService.show("\u06A9\u062F \u062C\u062F\u06CC\u062F \u0627\u0631\u0633\u0627\u0644 \u0634\u062F","success"),this.startTimer()},error:()=>this.notificationService.show("\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u0645\u062C\u062F\u062F \u06A9\u062F","error")}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(a){return new(a||o)(s(w),s(k),s(E),s(Q),s(F))}}static{this.\u0275cmp=N({type:o,selectors:[["app-token-page"]],decls:44,vars:20,consts:[[1,"flex","min-h-screen","items-center","justify-center","bg-muted/40","p-4"],[1,"w-full","max-w-[400px]","animate-fade-in-up"],[1,"card","card-elevated","overflow-hidden"],[1,"p-6","pb-0"],[1,"flex","items-center","justify-between","mb-6"],["aria-label","\u0628\u0627\u0632\u06AF\u0634\u062A",1,"btn","btn-ghost","btn-icon","rounded-full","hover:bg-muted",3,"click"],[1,"material-icons","icon-md","text-muted-foreground"],[1,"text-sm","font-medium","text-muted-foreground"],[1,"w-10"],[1,"text-center","space-y-2","mb-8"],[1,"flex","justify-center","mb-4"],[1,"icon-wrapper","icon-wrapper-lg","icon-wrapper-primary","rounded-full"],[1,"material-icons","icon-md"],[1,"text-2xl","font-bold","tracking-tight","text-foreground"],[1,"form-hint","text-sm"],[1,"font-bold","text-foreground","dir-ltr","inline-block"],[1,"form-group","space-y-6",3,"ngSubmit","formGroup"],[1,"form-group"],["for","verificationCode",1,"sr-only"],["type","tel","inputmode","numeric","id","verificationCode","formControlName","verificationCode","autocomplete","one-time-code","autofocus","",1,"input","input-lg","h-14","text-3xl","text-center","tracking-[0.5em]","font-mono",3,"maxlength"],[1,"space-y-2"],[1,"flex","justify-between","text-xs","text-muted-foreground","px-1"],[1,"flex","items-center","gap-1"],[1,"material-icons","icon-xs","icon-pulse","text-warning"],[1,"font-variant-numeric","tabular-nums"],[1,"progress","h-1.5","w-full","bg-muted"],[1,"progress-bar"],[1,"text-center","h-8","flex","items-center","justify-center","pt-2"],["type","button",1,"btn","btn-link","btn-sm","h-auto","animate-fade-in","group"],["type","submit",1,"btn","btn-primary","btn-lg","w-full","font-bold","shadow-md","group",3,"disabled"],[1,"material-icons","icon-lg","me-2","icon-pulse","text-success-foreground"],[1,"p-6"],["type","button",1,"btn","btn-link","btn-sm","h-auto","animate-fade-in","group",3,"click"],[1,"material-icons","icon-sm","ms-1","group-hover:icon-beat"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),b("click",function(){return e.goBack()}),t(6,"span",6),r(7,"arrow_forward"),i()(),t(8,"span",7),r(9,"\u062A\u0627\u06CC\u06CC\u062F \u0634\u0645\u0627\u0631\u0647"),i(),g(10,"div",8),i(),t(11,"div",9)(12,"div",10)(13,"div",11)(14,"span",12),r(15,"sms"),i()()(),t(16,"h3",13),r(17),i(),t(18,"p",14),r(19),t(20,"span",15),r(21),i(),r(22),i()(),t(23,"form",16),b("ngSubmit",function(){return e.submitCode()}),t(24,"div",17)(25,"label",18),r(26,"\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F"),i(),g(27,"input",19),i(),t(28,"div",20)(29,"div",21)(30,"span",22)(31,"span",23),r(32,"timer"),i(),r(33," \u0632\u0645\u0627\u0646 \u0628\u0627\u0642\u06CC\u200C\u0645\u0627\u0646\u062F\u0647 "),i(),l(34,me,2,1,"span",24),i(),t(35,"div",25),g(36,"div",26),i(),t(37,"div",27),l(38,ce,4,0,"button",28),i()(),t(39,"button",29),l(40,de,2,0,"span",30),t(41,"span"),r(42,"\u062A\u0627\u06CC\u06CC\u062F \u0648 \u0627\u062F\u0627\u0645\u0647"),i()()()(),g(43,"div",31),i()()()),a&2&&(u(17),p(" ",e.title," "),u(2),p(" ",e.descriptionPrefix," "),u(2),z(e.phoneNumber),u(),p(" ",e.descriptionSuffix," "),u(),d("formGroup",e.codeForm),u(4),d("maxlength",e.codeLength),u(7),m(e.isTimerActive?34:-1),u(2),O("width",e.percent,"%"),x("bg-primary",e.percent>20)("bg-destructive",e.percent<=20),u(2),m(e.isTimerActive?-1:38),u(),x("btn-loading",e.isSubmitting),d("disabled",e.codeForm.invalid||e.isSubmitting),u(),m(!e.isSubmitting&&e.codeForm.valid?40:-1),u(),x("opacity-0",e.isSubmitting))},dependencies:[V,D,T,A,P,$,M,U],encapsulation:2})}}return o})();var we=[{path:"",component:W},{path:"token",component:X}];export{we as AUTH_ROUTES};
