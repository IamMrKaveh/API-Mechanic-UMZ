import { a as A } from "./chunk-MX7VZAVK.js"; import { b as I, c as h, d as P, e as j, f as D, g as U, i as M, m as $, p as V, v as G, z as L } from "./chunk-2WEVJ2Q3.js"; import { b as W } from "./chunk-CVBRNWP7.js"; import { a as T } from "./chunk-OR3E3ANE.js"; import "./chunk-WNMS36QR.js"; import { A as E, b as Q, d as w, i as F, y as k } from "./chunk-H5ECWNVP.js"; import { Db as z, E as S, G as C, Gb as b, Hb as v, Nb as H, Ob as x, P as R, Pb as n, Q as y, Qb as J, Rb as d, Sa as o, _b as K, bb as p, ea as q, f as _, fa as O, gb as N, lb as c, ub as m, vb as t, wb as i, x as B, xb as g } from "./chunk-C5CPS5UB.js"; import "./chunk-4CLCTAJ7.js"; var ue = (r, u) => ({ "is-invalid": r, "is-valid": u }); function ae(r, u) { r & 1 && (t(0, "span"), n(1, "\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0627\u0644\u0632\u0627\u0645\u06CC \u0627\u0633\u062A"), i()) } function se(r, u) { r & 1 && (t(0, "span"), n(1, "\u0641\u0631\u0645\u062A \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0635\u062D\u06CC\u062D \u0646\u06CC\u0633\u062A"), i()) } function me(r, u) { if (r & 1 && (t(0, "div", 25), c(1, ae, 2, 0, "span", 26)(2, se, 2, 0, "span", 26), i()), r & 2) { let l = v(); o(), m("ngIf", l.phoneNumber == null || l.phoneNumber.errors == null ? null : l.phoneNumber.errors.required), o(), m("ngIf", l.phoneNumber == null || l.phoneNumber.errors == null ? null : l.phoneNumber.errors.pattern) } } function le(r, u) { if (r & 1 && (t(0, "span", 27), n(1), t(2, "span", 28), n(3, "login"), i()()), r & 2) { let l = v(); o(), d(" ", l.submitButtonText, " ") } } function pe(r, u) { r & 1 && (t(0, "span", 27)(1, "span", 29), n(2, "refresh"), i(), n(3, " \u062F\u0631 \u062D\u0627\u0644 \u067E\u0631\u062F\u0627\u0632\u0634 "), i()) } var X = (() => { let u = class u { constructor(a, s, e, f) { this.authService = a, this.router = s, this.notificationService = e, this.route = f, this.destroy$ = new _, this.logoUrl = "/assets/icons/ledka-icon.jpg", this.title = "\u0648\u0631\u0648\u062F | \u062B\u0628\u062A\u200C\u0646\u0627\u0645", this.submitButtonText = "\u0648\u0631\u0648\u062F", this.isSubmitting = !1, this.returnUrl = "/" } ngOnInit() { this.route.queryParams.pipe(S(1)).subscribe(a => { this.returnUrl = a.returnUrl || "/" }), this.loginForm = new D({ phoneNumber: new U("", [h.required, h.pattern(/^09\d{9}$/)]) }), this.isSubmitting = !1 } ngOnDestroy() { this.destroy$.next(), this.destroy$.complete() } get phoneNumber() { return this.loginForm.get("phoneNumber") } goBack() { this.router.navigate(["/"]) } onSubmit() { if (this.loginForm.invalid || this.isSubmitting) { this.loginForm.markAllAsTouched(); return } this.isSubmitting = !0; let a = this.loginForm.value.phoneNumber; this.authService.login({ phoneNumber: a }).pipe(C(() => this.isSubmitting = !1), y(this.destroy$)).subscribe({ next: () => { this.router.navigate(["/auth/token"], { queryParams: { phoneNumber: a, returnUrl: this.returnUrl } }) }, error: s => { let e = s?.error?.message || "\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u06A9\u062F. \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F."; this.notificationService.show(e, "error") } }) } }; u.\u0275fac = function (s) { return new (s || u)(p(A), p(E), p(T), p(k)) }, u.\u0275cmp = N({ type: u, selectors: [["app-auth-page"]], decls: 36, vars: 12, consts: [[1, "flex", "min-h-screen", "items-center", "justify-center", "bg-muted/40", "p-4"], [1, "w-full", "max-w-[420px]", "animate-fade-in-up"], [1, "card", "card-elevated", "overflow-hidden"], [1, "flex", "flex-col", "items-center", "p-8", "space-y-2", "text-center"], [1, "mb-6", "icon-wrapper", "icon-wrapper-xl", "icon-wrapper-primary", "rounded-2xl", "ring-1", "ring-primary/20"], [1, "material-icons", "icon-2xl"], [1, "text-2xl", "font-bold", "tracking-tight", "text-foreground"], [1, "text-sm", "text-muted-foreground"], [1, "px-8", "pb-8"], [1, "form-group", "space-y-5", 3, "ngSubmit", "formGroup"], [1, "form-group"], ["for", "phone", 1, "form-label", "sr-only"], [1, "relative"], ["type", "tel", "id", "phone", "formControlName", "phoneNumber", "placeholder", "09123456789", "maxlength", "11", "inputmode", "numeric", "autocomplete", "tel", "autofocus", "", 1, "input", "input-lg", "text-center", "tracking-widest", "ltr-input", "pl-10", 3, "ngClass"], [1, "absolute", "inset-y-0", "right-3", "flex", "items-center", "pointer-events-none"], [1, "material-icons", "icon-lg", "text-muted-foreground"], [1, "min-h-[20px]", "mt-1"], ["class", "form-error justify-center animate-fade-in", 4, "ngIf"], ["type", "submit", 1, "btn", "btn-primary", "btn-lg", "w-full", "font-bold", "shadow-md", "btn-glow", "group", 3, "disabled"], ["class", "flex items-center justify-center gap-2", 4, "ngIf"], [1, "border-t", "border-border", "bg-muted/30", "p-6", "text-center"], [1, "text-xs", "text-muted-foreground", "leading-relaxed"], ["href", "#", 1, "font-medium", "text-primary", "hover:underline", "underline-offset-4", "transition-colors"], [1, "mt-4", "btn", "btn-link", "btn-sm", "text-muted-foreground", "hover:text-foreground", "icon-btn", 3, "click"], [1, "material-icons", "icon-sm", "mr-1", "icon-shake"], [1, "form-error", "justify-center", "animate-fade-in"], [4, "ngIf"], [1, "flex", "items-center", "justify-center", "gap-2"], [1, "material-icons", "icon-sm", "group-hover:icon-pulse"], [1, "material-icons", "icon-spin"]], template: function (s, e) { s & 1 && (t(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "div", 3)(4, "div", 4)(5, "span", 5), n(6, "lock_person"), i()(), t(7, "h3", 6), n(8), i(), t(9, "p", 7), n(10, " \u0644\u0637\u0641\u0627 \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u062E\u0648\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F "), i()(), t(11, "div", 8)(12, "form", 9), b("ngSubmit", function () { return e.onSubmit() }), t(13, "div", 10)(14, "label", 11), n(15, "\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644"), i(), t(16, "div", 12), g(17, "input", 13), t(18, "span", 14)(19, "span", 15), n(20, "smartphone"), i()()(), t(21, "div", 16), c(22, me, 3, 2, "div", 17), i()(), t(23, "button", 18), c(24, le, 4, 1, "span", 19)(25, pe, 4, 0, "span", 19), i()()(), t(26, "div", 20)(27, "p", 21), n(28, " \u0648\u0631\u0648\u062F \u0634\u0645\u0627 \u0628\u0647 \u0645\u0639\u0646\u0627\u06CC \u067E\u0630\u06CC\u0631\u0634 "), t(29, "a", 22), n(30, " \u0634\u0631\u0627\u06CC\u0637 \u0648 \u0642\u0648\u0627\u0646\u06CC\u0646 "), i(), n(31, " \u0627\u0633\u062A. "), i(), t(32, "button", 23), b("click", function () { return e.goBack() }), t(33, "span", 24), n(34, "arrow_forward"), i(), n(35, " \u0628\u0627\u0632\u06AF\u0634\u062A \u0628\u0647 \u062E\u0627\u0646\u0647 "), i()()()()()), s & 2 && (o(8), d(" ", e.title, " "), o(4), m("formGroup", e.loginForm), o(5), m("ngClass", K(9, ue, (e.phoneNumber == null ? null : e.phoneNumber.invalid) && (e.phoneNumber == null ? null : e.phoneNumber.touched), (e.phoneNumber == null ? null : e.phoneNumber.valid) && (e.phoneNumber == null ? null : e.phoneNumber.touched))), o(5), m("ngIf", (e.phoneNumber == null ? null : e.phoneNumber.invalid) && ((e.phoneNumber == null ? null : e.phoneNumber.dirty) || (e.phoneNumber == null ? null : e.phoneNumber.touched))), o(), x("btn-loading", e.isSubmitting), m("disabled", !e.loginForm.valid || e.isSubmitting), o(), m("ngIf", !e.isSubmitting), o(), m("ngIf", e.isSubmitting)) }, dependencies: [F, Q, w, L, M, I, P, j, G, $, V], encapsulation: 2 }); let r = u; return r })(); function ce(r, u) { if (r & 1 && (t(0, "span", 32), n(1), i()), r & 2) { let l = v(); o(), d(" ", l.formattedTime, " ") } } function de(r, u) { if (r & 1) { let l = z(); t(0, "button", 33), b("click", function () { q(l); let s = v(); return O(s.resendCode()) }), n(1, " \u0627\u0631\u0633\u0627\u0644 \u0645\u062C\u062F\u062F \u06A9\u062F "), t(2, "span", 34), n(3, "refresh"), i()() } } function he(r, u) { r & 1 && (t(0, "span", 35), n(1, "check_circle"), i()) } var Y = (() => { let u = class u { constructor(a, s, e, f, Z) { this.route = a, this.router = s, this.authService = e, this.cartService = f, this.notificationService = Z, this.logoUrl = "/assets/icons/ledka-icon.jpg", this.title = "\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F", this.descriptionPrefix = "\u06A9\u062F \u067E\u06CC\u0627\u0645\u06A9 \u0634\u062F\u0647 \u0628\u0647 \u0634\u0645\u0627\u0631\u0647", this.descriptionSuffix = "\u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F.", this.phoneNumber = "", this.isSubmitting = !1, this.returnUrl = "/", this.destroy$ = new _, this.codeLength = 6, this.timerDuration = 120, this.isTimerActive = !1, this.formattedTime = "", this.percent = 100 } ngOnInit() { this.route.queryParams.pipe(S(1)).subscribe(a => { this.phoneNumber = a.phoneNumber, this.returnUrl = a.returnUrl || "/", this.phoneNumber || this.router.navigate(["/auth"]) }), this.codeForm = new D({ verificationCode: new U("", [h.required, h.minLength(this.codeLength), h.maxLength(this.codeLength), h.pattern("^[0-9]*$")]) }), this.startTimer() } startTimer() { this.isTimerActive = !0, this.percent = 100; let a = this.timerDuration; B(1e3).pipe(y(this.destroy$), S(this.timerDuration)).subscribe({ next: () => { a--; let s = Math.floor(a / 60), e = a % 60; this.formattedTime = `${s.toString().padStart(2, "0")}:${e.toString().padStart(2, "0")}`, this.percent = a / this.timerDuration * 100 }, complete: () => { this.isTimerActive = !1, this.percent = 0 } }) } goBack() { this.router.navigate(["/auth"]) } submitCode() { if (this.codeForm.invalid) return; this.isSubmitting = !0; let a = this.codeForm.get("verificationCode")?.value; this.authService.verifyOtp({ phoneNumber: this.phoneNumber, code: a }).pipe(R(() => this.cartService.getMyCart()), C(() => this.isSubmitting = !1), y(this.destroy$)).subscribe({ next: () => { this.notificationService.show("\u0648\u0631\u0648\u062F \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u0627\u0646\u062C\u0627\u0645 \u0634\u062F.", "success"), this.router.navigateByUrl(this.returnUrl) }, error: s => { let e = s.status === 429 ? "\u062A\u0639\u062F\u0627\u062F \u062A\u0644\u0627\u0634\u200C\u0647\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u06A9\u062F \u062C\u062F\u06CC\u062F \u062F\u0631\u06CC\u0627\u0641\u062A \u06A9\u0646\u06CC\u062F." : s.error?.message || "\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0646\u0627\u0645\u0639\u062A\u0628\u0631 \u0627\u0633\u062A."; this.notificationService.show(e, "error") } }) } resendCode() { this.isTimerActive || (this.isSubmitting = !0, this.authService.login({ phoneNumber: this.phoneNumber }).pipe(C(() => this.isSubmitting = !1)).subscribe({ next: () => { this.notificationService.show("\u06A9\u062F \u062C\u062F\u06CC\u062F \u0627\u0631\u0633\u0627\u0644 \u0634\u062F", "success"), this.startTimer() }, error: () => this.notificationService.show("\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u0645\u062C\u062F\u062F \u06A9\u062F", "error") })) } ngOnDestroy() { this.destroy$.next(), this.destroy$.complete() } }; u.\u0275fac = function (s) { return new (s || u)(p(k), p(E), p(A), p(W), p(T)) }, u.\u0275cmp = N({ type: u, selectors: [["app-token-page"]], decls: 44, vars: 20, consts: [[1, "flex", "min-h-screen", "items-center", "justify-center", "bg-muted/40", "p-4"], [1, "w-full", "max-w-[400px]", "animate-fade-in-up"], [1, "card", "card-elevated", "overflow-hidden"], [1, "p-6", "pb-0"], [1, "flex", "items-center", "justify-between", "mb-6"], ["aria-label", "\u0628\u0627\u0632\u06AF\u0634\u062A", 1, "btn", "btn-ghost", "btn-icon", "rounded-full", "hover:bg-muted", 3, "click"], [1, "material-icons", "icon-md", "text-muted-foreground"], [1, "text-sm", "font-medium", "text-muted-foreground"], [1, "w-10"], [1, "text-center", "space-y-2", "mb-8"], [1, "flex", "justify-center", "mb-4"], [1, "icon-wrapper", "icon-wrapper-lg", "icon-wrapper-primary", "rounded-full"], [1, "material-icons", "icon-md"], [1, "text-2xl", "font-bold", "tracking-tight", "text-foreground"], [1, "form-hint", "text-sm"], [1, "font-bold", "text-foreground", "dir-ltr", "inline-block"], [1, "form-group", "space-y-6", 3, "ngSubmit", "formGroup"], [1, "form-group"], ["for", "verificationCode", 1, "sr-only"], ["type", "tel", "inputmode", "numeric", "id", "verificationCode", "formControlName", "verificationCode", "autocomplete", "one-time-code", "autofocus", "", 1, "input", "input-lg", "h-14", "text-3xl", "text-center", "tracking-[0.5em]", "font-mono", 3, "maxlength"], [1, "space-y-2"], [1, "flex", "justify-between", "text-xs", "text-muted-foreground", "px-1"], [1, "flex", "items-center", "gap-1"], [1, "material-icons", "icon-xs", "icon-pulse", "text-warning"], ["class", "font-variant-numeric tabular-nums", 4, "ngIf"], [1, "progress", "h-1.5", "w-full", "bg-muted"], [1, "progress-bar"], [1, "text-center", "h-8", "flex", "items-center", "justify-center", "pt-2"], ["type", "button", "class", "btn btn-link btn-sm h-auto animate-fade-in group", 3, "click", 4, "ngIf"], ["type", "submit", 1, "btn", "btn-primary", "btn-lg", "w-full", "font-bold", "shadow-md", "group", 3, "disabled"], ["class", "material-icons icon-lg me-2 icon-pulse text-success-foreground", 4, "ngIf"], [1, "p-6"], [1, "font-variant-numeric", "tabular-nums"], ["type", "button", 1, "btn", "btn-link", "btn-sm", "h-auto", "animate-fade-in", "group", 3, "click"], [1, "material-icons", "icon-sm", "ms-1", "group-hover:icon-beat"], [1, "material-icons", "icon-lg", "me-2", "icon-pulse", "text-success-foreground"]], template: function (s, e) { s & 1 && (t(0, "div", 0)(1, "div", 1)(2, "div", 2)(3, "div", 3)(4, "div", 4)(5, "button", 5), b("click", function () { return e.goBack() }), t(6, "span", 6), n(7, "arrow_forward"), i()(), t(8, "span", 7), n(9, "\u062A\u0627\u06CC\u06CC\u062F \u0634\u0645\u0627\u0631\u0647"), i(), g(10, "div", 8), i(), t(11, "div", 9)(12, "div", 10)(13, "div", 11)(14, "span", 12), n(15, "sms"), i()()(), t(16, "h3", 13), n(17), i(), t(18, "p", 14), n(19), t(20, "span", 15), n(21), i(), n(22), i()(), t(23, "form", 16), b("ngSubmit", function () { return e.submitCode() }), t(24, "div", 17)(25, "label", 18), n(26, "\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F"), i(), g(27, "input", 19), i(), t(28, "div", 20)(29, "div", 21)(30, "span", 22)(31, "span", 23), n(32, "timer"), i(), n(33, " \u0632\u0645\u0627\u0646 \u0628\u0627\u0642\u06CC\u200C\u0645\u0627\u0646\u062F\u0647 "), i(), c(34, ce, 2, 1, "span", 24), i(), t(35, "div", 25), g(36, "div", 26), i(), t(37, "div", 27), c(38, de, 4, 0, "button", 28), i()(), t(39, "button", 29), c(40, he, 2, 0, "span", 30), t(41, "span"), n(42, "\u062A\u0627\u06CC\u06CC\u062F \u0648 \u0627\u062F\u0627\u0645\u0647"), i()()()(), g(43, "div", 31), i()()()), s & 2 && (o(17), d(" ", e.title, " "), o(2), d(" ", e.descriptionPrefix, " "), o(2), J(e.phoneNumber), o(), d(" ", e.descriptionSuffix, " "), o(), m("formGroup", e.codeForm), o(4), m("maxlength", e.codeLength), o(7), m("ngIf", e.isTimerActive), o(2), H("width", e.percent, "%"), x("bg-primary", e.percent > 20)("bg-destructive", e.percent <= 20), o(2), m("ngIf", !e.isTimerActive), o(), x("btn-loading", e.isSubmitting), m("disabled", e.codeForm.invalid || e.isSubmitting), o(), m("ngIf", !e.isSubmitting && e.codeForm.valid), o(), x("opacity-0", e.isSubmitting)) }, dependencies: [F, w, L, M, I, P, j, G, $, V], encapsulation: 2 }); let r = u; return r })(); var ke = [{ path: "", component: X }, { path: "token", component: Y }]; export { ke as AUTH_ROUTES };