import{a as I}from"./chunk-5W5LZDWP.js";import{b as E,c,d as j,e as P,f as D,g as U,i as M,m as $,p as V,v as G,z as L}from"./chunk-7OLIJ6IO.js";import{b as K}from"./chunk-GTLAKDJZ.js";import{a as w}from"./chunk-I4Q63QBA.js";import"./chunk-WNMS36QR.js";import{b as J,d as F,i as k,w as A,y as T}from"./chunk-KEVVMOUP.js";import{Ab as r,Bb as y,Cb as b,D as v,Ea as o,F as x,Kb as H,M as R,N as S,Pa as l,Ua as N,Za as f,ba as q,ca as O,f as _,gb as m,hb as t,ib as i,jb as d,pb as z,sb as g,tb as C,w as B}from"./chunk-RYHSS54R.js";import"./chunk-4CLCTAJ7.js";var re=n=>({"is-invalid":n});function oe(n,s){n&1&&(t(0,"span"),r(1,"\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0627\u0644\u0632\u0627\u0645\u06CC \u0627\u0633\u062A"),i())}function ue(n,s){n&1&&(t(0,"span"),r(1,"\u0641\u0631\u0645\u062A \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u0635\u062D\u06CC\u062D \u0646\u06CC\u0633\u062A"),i())}function ae(n,s){if(n&1&&(t(0,"div",25),f(1,oe,2,0,"span",26)(2,ue,2,0,"span",26),i()),n&2){let p=C();o(),m("ngIf",p.phoneNumber==null||p.phoneNumber.errors==null?null:p.phoneNumber.errors.required),o(),m("ngIf",p.phoneNumber==null||p.phoneNumber.errors==null?null:p.phoneNumber.errors.pattern)}}function se(n,s){n&1&&d(0,"span",27)}var Q=(()=>{let s=class s{constructor(u,a,e,h){this.authService=u,this.router=a,this.notificationService=e,this.route=h,this.destroy$=new _,this.logoUrl="/assets/icons/ledka-icon.jpg",this.title="\u0648\u0631\u0648\u062F | \u062B\u0628\u062A\u200C\u0646\u0627\u0645",this.submitButtonText="\u0648\u0631\u0648\u062F",this.isSubmitting=!1,this.returnUrl="/"}ngOnInit(){this.route.queryParams.pipe(v(1)).subscribe(u=>{this.returnUrl=u.returnUrl||"/"}),this.loginForm=new D({phoneNumber:new U("",[c.required,c.pattern(/^09\d{9}$/)])}),this.isSubmitting=!1}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get phoneNumber(){return this.loginForm.get("phoneNumber")}goBack(){this.router.navigate(["/"])}onSubmit(){if(this.loginForm.invalid||this.isSubmitting){this.loginForm.markAllAsTouched();return}this.isSubmitting=!0;let u=this.loginForm.value.phoneNumber;this.authService.login({phoneNumber:u}).pipe(x(()=>this.isSubmitting=!1),S(this.destroy$)).subscribe({next:()=>{this.router.navigate(["/auth/token"],{queryParams:{phoneNumber:u,returnUrl:this.returnUrl}})},error:a=>{let e=a?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u06A9\u062F. \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.";this.notificationService.show(e,"error")}})}};s.\u0275fac=function(a){return new(a||s)(l(I),l(T),l(w),l(A))},s.\u0275cmp=N({type:s,selectors:[["app-auth-page"]],decls:37,vars:9,consts:[[1,"flex","min-h-screen","items-center","justify-center","bg-muted/40","p-4"],[1,"w-full","max-w-[420px]","animate-fade-in-up"],[1,"card","card-elevated","overflow-hidden"],[1,"flex","flex-col","items-center","p-8","space-y-2","text-center"],[1,"mb-4","h-16","w-16","rounded-2xl","bg-primary/10","flex","items-center","justify-center","text-primary","ring-1","ring-primary/20"],[1,"material-icons","text-3xl"],[1,"text-2xl","font-bold","tracking-tight","text-foreground"],[1,"text-sm","text-muted-foreground"],[1,"px-8","pb-8"],[1,"space-y-5",3,"ngSubmit","formGroup"],[1,"space-y-2"],["for","phone",1,"sr-only"],[1,"relative"],["type","tel","id","phone","formControlName","phoneNumber","placeholder","09123456789","maxlength","11","inputmode","numeric","autocomplete","tel","autofocus","",1,"input","h-12","text-center","text-lg","tracking-widest","ltr-input","pl-10",3,"ngClass"],[1,"absolute","inset-y-0","right-3","flex","items-center","text-muted-foreground","pointer-events-none"],[1,"material-icons","text-xl"],[1,"min-h-[20px]"],["class","form-error justify-center animate-fade-in",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-lg","w-full","font-bold","shadow-md",3,"disabled"],["class","spinner spinner-sm mr-2",4,"ngIf"],[1,"border-t","border-border","bg-muted/30","p-6","text-center"],[1,"text-xs","text-muted-foreground","leading-relaxed"],["href","#",1,"font-medium","text-primary","hover:underline","underline-offset-4","transition-colors"],[1,"mt-4","btn","btn-link","btn-sm","text-muted-foreground","hover:text-foreground",3,"click"],[1,"material-icons","text-sm","mr-1"],[1,"form-error","justify-center","animate-fade-in"],[4,"ngIf"],[1,"spinner","spinner-sm","mr-2"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),r(6,"lock_person"),i()(),t(7,"h3",6),r(8),i(),t(9,"p",7),r(10," \u0644\u0637\u0641\u0627 \u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644 \u062E\u0648\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F "),i()(),t(11,"div",8)(12,"form",9),g("ngSubmit",function(){return e.onSubmit()}),t(13,"div",10)(14,"label",11),r(15,"\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06CC\u0644"),i(),t(16,"div",12),d(17,"input",13),t(18,"span",14)(19,"span",15),r(20,"smartphone"),i()()(),t(21,"div",16),f(22,ae,3,2,"div",17),i()(),t(23,"button",18),f(24,se,1,0,"span",19),t(25,"span"),r(26),i()()()(),t(27,"div",20)(28,"p",21),r(29," \u0648\u0631\u0648\u062F \u0634\u0645\u0627 \u0628\u0647 \u0645\u0639\u0646\u0627\u06CC \u067E\u0630\u06CC\u0631\u0634 "),t(30,"a",22),r(31,"\u0634\u0631\u0627\u06CC\u0637 \u0648 \u0642\u0648\u0627\u0646\u06CC\u0646"),i(),r(32," \u0627\u0633\u062A. "),i(),t(33,"button",23),g("click",function(){return e.goBack()}),t(34,"span",24),r(35,"arrow_forward"),i(),r(36," \u0628\u0627\u0632\u06AF\u0634\u062A \u0628\u0647 \u062E\u0627\u0646\u0647 "),i()()()()()),a&2&&(o(8),b(" ",e.title," "),o(4),m("formGroup",e.loginForm),o(5),m("ngClass",H(7,re,(e.phoneNumber==null?null:e.phoneNumber.invalid)&&(e.phoneNumber==null?null:e.phoneNumber.touched))),o(5),m("ngIf",(e.phoneNumber==null?null:e.phoneNumber.invalid)&&((e.phoneNumber==null?null:e.phoneNumber.dirty)||(e.phoneNumber==null?null:e.phoneNumber.touched))),o(),m("disabled",!e.loginForm.valid||e.isSubmitting),o(),m("ngIf",e.isSubmitting),o(2),y(e.isSubmitting?"\u0644\u0637\u0641\u0627 \u0635\u0628\u0631 \u06A9\u0646\u06CC\u062F...":e.submitButtonText))},dependencies:[k,J,F,L,M,E,j,P,G,$,V],encapsulation:2});let n=s;return n})();function me(n,s){if(n&1&&(t(0,"span",23),r(1),i()),n&2){let p=C();o(),b(" ",p.formattedTime," \u062A\u0627 \u0627\u0631\u0633\u0627\u0644 \u0645\u062C\u062F\u062F ")}}function le(n,s){if(n&1){let p=z();t(0,"button",24),g("click",function(){q(p);let a=C();return O(a.resendCode())}),r(1," \u0627\u0631\u0633\u0627\u0644 \u0645\u062C\u062F\u062F \u06A9\u062F "),i()}}function pe(n,s){n&1&&d(0,"span",25)}var W=(()=>{let s=class s{constructor(u,a,e,h,X){this.route=u,this.router=a,this.authService=e,this.cartService=h,this.notificationService=X,this.logoUrl="/assets/icons/ledka-icon.jpg",this.title="\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F",this.descriptionPrefix="\u06A9\u062F \u067E\u06CC\u0627\u0645\u06A9 \u0634\u062F\u0647 \u0628\u0647 \u0634\u0645\u0627\u0631\u0647",this.descriptionSuffix="\u0631\u0627 \u0648\u0627\u0631\u062F \u06A9\u0646\u06CC\u062F.",this.phoneNumber="",this.isSubmitting=!1,this.returnUrl="/",this.destroy$=new _,this.codeLength=6,this.timerDuration=120,this.isTimerActive=!1,this.formattedTime=""}ngOnInit(){this.route.queryParams.pipe(v(1)).subscribe(u=>{this.phoneNumber=u.phoneNumber,this.returnUrl=u.returnUrl||"/",this.phoneNumber||this.router.navigate(["/auth"])}),this.codeForm=new D({verificationCode:new U("",[c.required,c.minLength(this.codeLength),c.maxLength(this.codeLength),c.pattern("^[0-9]*$")])}),this.startTimer()}startTimer(){this.isTimerActive=!0;let u=this.timerDuration;B(1e3).pipe(S(this.destroy$),v(this.timerDuration)).subscribe({next:()=>{u--;let a=Math.floor(u/60),e=u%60;this.formattedTime=`${a.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`},complete:()=>{this.isTimerActive=!1}})}goBack(){this.router.navigate(["/auth"])}submitCode(){if(this.codeForm.invalid)return;this.isSubmitting=!0;let u=this.codeForm.get("verificationCode")?.value;this.authService.verifyOtp({phoneNumber:this.phoneNumber,code:u}).pipe(R(()=>this.cartService.getMyCart()),x(()=>this.isSubmitting=!1),S(this.destroy$)).subscribe({next:()=>{this.notificationService.show("\u0648\u0631\u0648\u062F \u0628\u0627 \u0645\u0648\u0641\u0642\u06CC\u062A \u0627\u0646\u062C\u0627\u0645 \u0634\u062F.","success"),this.router.navigateByUrl(this.returnUrl)},error:a=>{let e=a.status===429?"\u062A\u0639\u062F\u0627\u062F \u062A\u0644\u0627\u0634\u200C\u0647\u0627 \u0628\u06CC\u0634 \u0627\u0632 \u062D\u062F \u0645\u062C\u0627\u0632 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u06A9\u062F \u062C\u062F\u06CC\u062F \u062F\u0631\u06CC\u0627\u0641\u062A \u06A9\u0646\u06CC\u062F.":a.error?.message||"\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F \u0646\u0627\u0645\u0639\u062A\u0628\u0631 \u0627\u0633\u062A.";this.notificationService.show(e,"error")}})}resendCode(){this.isTimerActive||(this.isSubmitting=!0,this.authService.login({phoneNumber:this.phoneNumber}).pipe(x(()=>this.isSubmitting=!1)).subscribe({next:()=>{this.notificationService.show("\u06A9\u062F \u062C\u062F\u06CC\u062F \u0627\u0631\u0633\u0627\u0644 \u0634\u062F","success"),this.startTimer()},error:()=>this.notificationService.show("\u062E\u0637\u0627 \u062F\u0631 \u0627\u0631\u0633\u0627\u0644 \u0645\u062C\u062F\u062F \u06A9\u062F","error")}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};s.\u0275fac=function(a){return new(a||s)(l(A),l(T),l(I),l(K),l(w))},s.\u0275cmp=N({type:s,selectors:[["app-token-page"]],decls:32,vars:11,consts:[[1,"flex","min-h-screen","items-center","justify-center","bg-muted/40","p-4"],[1,"w-full","max-w-[400px]","animate-fade-in-up"],[1,"card","card-elevated","overflow-hidden"],[1,"p-6","pb-0"],[1,"flex","items-center","justify-between","mb-6"],["aria-label","\u0628\u0627\u0632\u06AF\u0634\u062A",1,"btn","btn-ghost","btn-icon","rounded-full","hover:bg-muted",3,"click"],[1,"material-icons","text-muted-foreground"],[1,"text-sm","font-medium","text-muted-foreground"],[1,"w-10"],[1,"text-center","space-y-2","mb-8"],[1,"text-2xl","font-bold","tracking-tight","text-foreground"],[1,"text-sm","text-muted-foreground"],[1,"font-bold","text-foreground","dir-ltr","inline-block"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"space-y-2"],["for","verificationCode",1,"sr-only"],["type","tel","inputmode","numeric","id","verificationCode","formControlName","verificationCode","autocomplete","one-time-code","autofocus","",1,"input","h-14","text-3xl","text-center","tracking-[0.5em]","font-mono",3,"maxlength"],[1,"text-center","h-8","flex","items-center","justify-center"],["class","text-sm text-muted-foreground font-variant-numeric tabular-nums",4,"ngIf"],["type","button","class","btn btn-link btn-sm h-auto",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-lg","w-full","font-bold","shadow-md",3,"disabled"],["class","spinner spinner-sm mr-2",4,"ngIf"],[1,"p-6"],[1,"text-sm","text-muted-foreground","font-variant-numeric","tabular-nums"],["type","button",1,"btn","btn-link","btn-sm","h-auto",3,"click"],[1,"spinner","spinner-sm","mr-2"]],template:function(a,e){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),g("click",function(){return e.goBack()}),t(6,"span",6),r(7,"arrow_forward"),i()(),t(8,"span",7),r(9,"\u062A\u0627\u06CC\u06CC\u062F \u0634\u0645\u0627\u0631\u0647"),i(),d(10,"div",8),i(),t(11,"div",9)(12,"h3",10),r(13),i(),t(14,"p",11),r(15),t(16,"span",12),r(17),i(),r(18),i()(),t(19,"form",13),g("ngSubmit",function(){return e.submitCode()}),t(20,"div",14)(21,"label",15),r(22,"\u06A9\u062F \u062A\u0627\u06CC\u06CC\u062F"),i(),d(23,"input",16),i(),t(24,"div",17),f(25,me,2,1,"span",18)(26,le,2,0,"button",19),i(),t(27,"button",20),f(28,pe,1,0,"span",21),t(29,"span"),r(30),i()()()(),d(31,"div",22),i()()()),a&2&&(o(13),b(" ",e.title," "),o(2),b(" ",e.descriptionPrefix," "),o(2),y(e.phoneNumber),o(),b(" ",e.descriptionSuffix," "),o(),m("formGroup",e.codeForm),o(4),m("maxlength",e.codeLength),o(2),m("ngIf",e.isTimerActive),o(),m("ngIf",!e.isTimerActive),o(),m("disabled",e.codeForm.invalid||e.isSubmitting),o(),m("ngIf",e.isSubmitting),o(2),y(e.isSubmitting?"\u062F\u0631 \u062D\u0627\u0644 \u0628\u0631\u0631\u0633\u06CC...":"\u062A\u0627\u06CC\u06CC\u062F \u0648 \u0627\u062F\u0627\u0645\u0647"))},dependencies:[k,F,L,M,E,j,P,G,$,V],encapsulation:2});let n=s;return n})();var Ne=[{path:"",component:Q},{path:"token",component:W}];export{Ne as AUTH_ROUTES};
