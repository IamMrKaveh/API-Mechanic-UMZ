import{a as Ae}from"./chunk-MY3KQRGJ.js";import{a as fe}from"./chunk-LE2SIANP.js";import{a as ve}from"./chunk-QZB3YDQZ.js";import{a as V,b as X}from"./chunk-4HNKDCGE.js";import{a as _e}from"./chunk-A7ZS4YM6.js";import{a as xe,b as be,d as he,e as ye,f as Ce,g as S,i as Se,j as Ie,m as we,p as Pe,q as Ve,r as Ee,s as Fe,y as ke,z as Te}from"./chunk-7OLIJ6IO.js";import{b as ge}from"./chunk-GTLAKDJZ.js";import{a as me}from"./chunk-I4Q63QBA.js";import"./chunk-WNMS36QR.js";import{F as K,b as se,c as Q,d as W,e as q,h as ce,i as J,w as H,y as de,z as pe}from"./chunk-KEVVMOUP.js";import{Aa as ae,Ab as c,B as R,Bb as $,Cb as C,E as ne,Ea as s,F as B,Jb as ue,L as re,M as T,N as E,Nb as w,O as oe,Ob as P,Pa as h,Qb as j,Ua as G,Yb as z,Za as g,ba as x,ca as b,f as N,g as L,gb as p,hb as a,ib as o,j as F,jb as v,n as k,nb as Z,o as U,ob as ee,pb as I,sb as y,tb as m,xb as O,yb as le,z as D,zb as A}from"./chunk-RYHSS54R.js";import{a as M,b as ie}from"./chunk-4CLCTAJ7.js";var Le=()=>[1,2,3,4,5,6];function Ue(n,u){if(n&1&&(a(0,"option",47),c(1),o()),n&2){let t=u.$implicit;p("value",t.id),s(),C(" ",t.name," ")}}function De(n,u){if(n&1&&(a(0,"option",47),c(1),o()),n&2){let t=u.$implicit;p("value",t.id),s(),C(" ",t.name," ")}}function Re(n,u){if(n&1&&(a(0,"div",48)(1,"label",15),v(2,"span",49),c(3," \u06AF\u0631\u0648\u0647 \u062F\u0633\u062A\u0647\u200C\u0628\u0646\u062F\u06CC "),o(),a(4,"select",50)(5,"option",18),c(6,"\u0647\u0645\u0647 \u06AF\u0631\u0648\u0647\u200C\u0647\u0627"),o(),g(7,De,2,2,"option",19),o()()),n&2){let t=u.ngIf;s(5),p("ngValue",null),s(2),p("ngForOf",t)}}function Be(n,u){if(n&1){let t=I();a(0,"button",51),y("click",function(){let i=x(t).$implicit,r=m();return b(r.setSort(i.value))}),c(1),o()}if(n&2){let t,e,i,r,l=u.$implicit,d=m();A("bg-primary",((t=d.searchForm.get("sortBy"))==null?null:t.value)===l.value)("text-primary-foreground",((e=d.searchForm.get("sortBy"))==null?null:e.value)===l.value)("shadow-md",((i=d.searchForm.get("sortBy"))==null?null:i.value)===l.value)("btn-ghost",((r=d.searchForm.get("sortBy"))==null?null:r.value)!==l.value),s(),C(" ",l.label," ")}}function Ge(n,u){if(n&1&&(a(0,"div",52),c(1),o()),n&2){let t=u.ngIf;s(),C(" ",t.totalItems," \u06A9\u0627\u0644\u0627 ")}}function ze(n,u){if(n&1&&v(0,"app-product-card",56),n&2){let t=u.$implicit;p("product",t)}}function Qe(n,u){if(n&1&&(a(0,"div",54),g(1,ze,1,1,"app-product-card",55),o()),n&2){let t=m().ngIf;s(),p("ngForOf",t)}}function We(n,u){if(n&1){let t=I();a(0,"div",57)(1,"div",58)(2,"span",59),c(3,"search_off"),o()(),a(4,"h3",60),c(5,"\u0645\u062D\u0635\u0648\u0644\u06CC \u06CC\u0627\u0641\u062A \u0646\u0634\u062F"),o(),a(6,"p",61),c(7," \u0628\u0627 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627\u06CC \u0641\u0639\u0644\u06CC \u0646\u062A\u06CC\u062C\u0647\u200C\u0627\u06CC \u067E\u06CC\u062F\u0627 \u0646\u0634\u062F. "),o(),a(8,"button",62),y("click",function(){x(t);let i=m(2);return b(i.clearFilters())}),c(9," \u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627 "),o()()}}function qe(n,u){if(n&1&&(Z(0),g(1,Qe,2,1,"div",53)(2,We,10,0,"ng-template",null,1,j),ee()),n&2){let t=u.ngIf,e=O(3);s(),p("ngIf",t.length>0)("ngIfElse",e)}}function Je(n,u){n&1&&(a(0,"div",64),v(1,"div",65),a(2,"div",66),v(3,"div",67)(4,"div",68),a(5,"div",69),v(6,"div",70)(7,"div",71),o()()())}function He(n,u){n&1&&(a(0,"div",54),g(1,Je,8,0,"div",63),o()),n&2&&(s(),p("ngForOf",ue(1,Le)))}function Ke(n,u){if(n&1){let t=I();Z(0),a(1,"button",78),y("click",function(){let i=x(t).$implicit,r=m(3);return b(r.onPageNumberClick(i))}),c(2),o(),ee()}if(n&2){let t=u.$implicit,e=m(2).ngIf;s(),A("bg-primary",e.page===t)("text-primary-foreground",e.page===t)("shadow-md",e.page===t)("hover:bg-muted",e.page!==t&&t!=="..."),p("disabled",t==="..."),s(),C(" ",t," ")}}function Xe(n,u){if(n&1){let t=I();a(0,"nav",74)(1,"button",75),y("click",function(){x(t);let i=m().ngIf,r=m();return b(r.onPageChange(i.page-1))}),a(2,"span",40),c(3,"chevron_right"),o()(),g(4,Ke,3,10,"ng-container",76),a(5,"button",77),y("click",function(){x(t);let i=m().ngIf,r=m();return b(r.onPageChange(i.page+1))}),a(6,"span",40),c(7,"chevron_left"),o()()()}if(n&2){let t=m().ngIf,e=m();s(),p("disabled",t.page===1),s(3),p("ngForOf",e.getPages(t.totalPages,t.page)),s(),p("disabled",t.page===t.totalPages)}}function Ye(n,u){if(n&1&&(a(0,"div",72),g(1,Xe,8,3,"nav",73),o()),n&2){let t=u.ngIf;s(),p("ngIf",t&&t.totalPages>1)}}var te=(()=>{let u=class u{constructor(e,i,r,l,d,f){this.productService=e,this.categoryService=i,this.categoryGroupService=r,this.cdr=l,this.route=d,this.router=f,this.destroy$=new N,this.paginatedResultSubject=new L(null),this.paginatedResult$=this.paginatedResultSubject.asObservable(),this.sortOptions=[{label:"\u062C\u062F\u06CC\u062F\u062A\u0631\u06CC\u0646",value:V.newest},{label:"\u0642\u062F\u06CC\u0645\u06CC\u200C\u062A\u0631\u06CC\u0646",value:V.oldest},{label:"\u0627\u0631\u0632\u0627\u0646\u200C\u062A\u0631\u06CC\u0646",value:V.priceAsc},{label:"\u06AF\u0631\u0627\u0646\u200C\u062A\u0631\u06CC\u0646",value:V.priceDesc},{label:"\u0628\u06CC\u0634\u062A\u0631\u06CC\u0646 \u062A\u062E\u0641\u06CC\u0641",value:V.discountDesc}],this.searchForm=new Ce({name:new S(null),minPrice:new S(null),maxPrice:new S(null),inStock:new S(null),hasDiscount:new S(null),isUnlimited:new S(null),categoryId:new S(null),categoryGroupId:new S(null),sortBy:new S(V.newest),page:new S(1),pageSize:new S(12)}),this.products$=this.paginatedResult$.pipe(k(_=>_?.items??[])),this.categories$=this.categoryService.getCategories(void 0,1,50).pipe(k(_=>_.items??[])),this.categoryGroups$=this.searchForm.get("categoryId").valueChanges.pipe(re(this.searchForm.get("categoryId").value),T(_=>_?this.categoryGroupService.getCategoryGroups(_,void 0,1,100).pipe(k(Y=>Y.items)):F(null)))}ngOnInit(){U([this.route.params,this.route.queryParams]).pipe(E(this.destroy$)).subscribe(([e,i])=>{let r=e.groupId?Number(e.groupId):null,l={name:i.name||null,minPrice:i.minPrice?Number(i.minPrice):null,maxPrice:i.maxPrice?Number(i.maxPrice):null,inStock:i.inStock==="true"?!0:null,hasDiscount:i.hasDiscount==="true"?!0:null,categoryId:i.categoryId?Number(i.categoryId):null,categoryGroupId:r||(i.categoryGroupId?Number(i.categoryGroupId):null),sortBy:i.sortBy||V.newest,page:i.page?Number(i.page):1,pageSize:i.pageSize?Number(i.pageSize):12};this.searchForm.patchValue(l,{emitEvent:!1}),this.loadProducts(this.searchForm.value).subscribe(d=>{this.paginatedResultSubject.next(d)})}),this.searchForm.valueChanges.pipe(R(400),ne((e,i)=>JSON.stringify(e)===JSON.stringify(i)),oe(e=>this.updateUrl(e)),T(e=>this.loadProducts(e)),E(this.destroy$)).subscribe(e=>{this.paginatedResultSubject.next(e),this.cdr.markForCheck()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}updateUrl(e){let i={},r=this.route.snapshot.paramMap.get("groupId");Object.keys(e).forEach(d=>{let f=e[d];if(!(d==="categoryGroupId"&&r&&f==r)&&f!==null&&f!==""&&f!==void 0&&f!==!1){if(d==="page"&&f===1||d==="pageSize"&&f===12||d==="sortBy"&&f===V.newest)return;i[d]=f}});let l=this.searchForm.value.categoryGroupId&&!r?["/products","category-group",this.searchForm.value.categoryGroupId]:["/products"];this.router.navigate(l,{queryParams:i,replaceUrl:!0})}loadProducts(e){let i={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let l=e[r];l!==null&&l!==""&&l!==void 0&&l!==!1&&(i[r]=l)}return this.productService.getProducts(i)}onPageChange(e){this.searchForm.patchValue({page:e})}setSort(e){this.searchForm.patchValue({sortBy:e,page:1})}getPages(e,i){if(e<=7)return Array.from({length:e},(_,Y)=>Y+1);let r=[],l=1,d=i-1-l,f=e-i-l;r.push(1),d>1&&r.push("...");for(let _=Math.max(2,i-l);_<=Math.min(e-1,i+l);_++)r.push(_);return f>1&&r.push("..."),r.push(e),r}onPageNumberClick(e){typeof e=="number"&&this.onPageChange(e)}toggleInStock(){let e=this.searchForm.get("inStock");e&&e.setValue(e.value?null:!0)}clearFilters(){this.searchForm.reset({sortBy:V.newest,page:1,pageSize:12}),this.router.navigate(["/products"])}};u.\u0275fac=function(i){return new(i||u)(h(X),h(fe),h(Ae),h(z),h(H),h(de))},u.\u0275cmp=G({type:u,selectors:[["app-product-list-page"]],decls:76,vars:20,consts:[["loadingState",""],["noProducts",""],[1,"container","py-8"],[1,"grid","grid-cols-1","items-start","gap-8","lg:grid-cols-4"],[1,"hidden","lg:block","lg:col-span-1","lg:sticky","top-24","space-y-6"],[1,"card","p-6","space-y-6",3,"formGroup"],[1,"flex","items-center","gap-2","pb-4","border-b","border-border"],[1,"material-icons","text-primary"],[1,"text-lg","font-bold","text-foreground"],[1,"space-y-6"],[1,"relative"],["type","text","id","name","formControlName","name","placeholder"," ",1,"floating-input","peer"],["for","name",1,"floating-label"],[1,"material-icons","absolute","left-3","top-4","text-muted-foreground","pointer-events-none"],[1,"space-y-2"],[1,"text-sm","font-semibold","text-foreground","flex","items-center","gap-2"],[1,"w-1","h-4","bg-primary","rounded-full"],["id","category","formControlName","categoryId",1,"floating-input","pt-2","pb-2","h-12"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["class","space-y-2 animate-fade-in",4,"ngIf"],[1,"space-y-3"],[1,"w-1","h-4","bg-accent-foreground","rounded-full"],[1,"grid","grid-cols-2","gap-3"],["type","number","formControlName","minPrice","placeholder"," ",1,"floating-input","text-center"],[1,"floating-label","right-auto","left-0","w-full","text-center"],["type","number","formControlName","maxPrice","placeholder"," ",1,"floating-input","text-center"],[1,"space-y-3","pt-4","border-t","border-border"],[1,"flex","items-center","justify-between","cursor-pointer","group","p-2","hover:bg-muted/50","rounded-lg","transition-colors"],[1,"text-sm","font-medium","text-foreground"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"w-11","h-6","bg-muted","peer-focus:outline-none","peer-focus:ring-2","peer-focus:ring-primary/50","rounded-full","peer","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-5","after:w-5","after:transition-all","peer-checked:bg-primary"],["type","checkbox","formControlName","hasDiscount",1,"sr-only","peer"],["type","button",1,"btn","btn-ghost","text-destructive","hover:bg-destructive/10","w-full","rounded-xl",3,"click"],[1,"material-icons","text-sm","me-2"],[1,"col-span-1","lg:col-span-3"],[1,"card","p-4","mb-8","flex","flex-col","sm:flex-row","items-center","justify-between","gap-4","sticky","top-24","z-20"],[1,"flex","items-center","gap-4","w-full","sm:w-auto","overflow-x-auto","pb-1","sm:pb-0","no-scrollbar"],[1,"flex","items-center","gap-1","text-muted-foreground","bg-muted/50","px-3","py-1.5","rounded-lg"],[1,"material-icons","text-sm"],[1,"text-xs","font-bold","whitespace-nowrap"],[1,"flex","gap-1"],["class","btn btn-sm rounded-lg transition-all duration-200 hover:bg-muted font-normal",3,"bg-primary","text-primary-foreground","shadow-md","btn-ghost","click",4,"ngFor","ngForOf"],["class","text-xs font-medium text-muted-foreground whitespace-nowrap bg-muted/30 px-3 py-1.5 rounded-full",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","mt-12 flex justify-center",4,"ngIf"],[3,"value"],[1,"space-y-2","animate-fade-in"],[1,"w-1","h-4","bg-secondary","rounded-full"],["id","categoryGroup","formControlName","categoryGroupId",1,"floating-input","pt-2","pb-2","h-12"],[1,"btn","btn-sm","rounded-lg","transition-all","duration-200","hover:bg-muted","font-normal",3,"click"],[1,"text-xs","font-medium","text-muted-foreground","whitespace-nowrap","bg-muted/30","px-3","py-1.5","rounded-full"],["class","grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",4,"ngIf","ngIfElse"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-3","gap-6"],[3,"product",4,"ngFor","ngForOf"],[3,"product"],[1,"card","flex","flex-col","items-center","justify-center","p-16","text-center","border-dashed"],[1,"w-24","h-24","rounded-full","bg-muted/50","flex","items-center","justify-center","mb-6"],[1,"material-icons","text-5xl","text-muted-foreground/50"],[1,"text-xl","font-bold","text-foreground"],[1,"mt-2","text-muted-foreground"],[1,"btn","btn-primary","mt-6","rounded-full","px-8",3,"click"],["class","card overflow-hidden",4,"ngFor","ngForOf"],[1,"card","overflow-hidden"],[1,"aspect-square","bg-muted/50","animate-pulse"],[1,"p-4","space-y-3"],[1,"h-4","bg-muted/50","rounded","w-3/4","animate-pulse"],[1,"h-4","bg-muted/50","rounded","w-1/2","animate-pulse"],[1,"flex","justify-between","pt-2"],[1,"h-8","w-24","bg-muted/50","rounded","animate-pulse"],[1,"h-10","w-10","rounded-full","bg-muted/50","animate-pulse"],[1,"mt-12","flex","justify-center"],["class","card rounded-full p-1.5 flex items-center gap-1",4,"ngIf"],[1,"card","rounded-full","p-1.5","flex","items-center","gap-1"],["aria-label","\u0635\u0641\u062D\u0647 \u0642\u0628\u0644",1,"btn","btn-icon","rounded-full","hover:bg-muted",3,"click","disabled"],[4,"ngFor","ngForOf"],["aria-label","\u0635\u0641\u062D\u0647 \u0628\u0639\u062F",1,"btn","btn-icon","rounded-full","hover:bg-muted",3,"click","disabled"],[1,"w-9","h-9","rounded-full","flex","items-center","justify-center","text-sm","font-medium","transition-all","duration-200",3,"click","disabled"]],template:function(i,r){if(i&1){let l=I();a(0,"div",2)(1,"div",3)(2,"aside",4)(3,"form",5)(4,"div",6)(5,"span",7),c(6,"tune"),o(),a(7,"h3",8),c(8,"\u0641\u06CC\u0644\u062A\u0631\u0647\u0627"),o()(),a(9,"div",9)(10,"div",10),v(11,"input",11),a(12,"label",12),c(13,"\u062C\u0633\u062A\u062C\u0648\u06CC \u0645\u062D\u0635\u0648\u0644..."),o(),a(14,"span",13),c(15,"search"),o()(),a(16,"div",14)(17,"label",15),v(18,"span",16),c(19," \u062F\u0633\u062A\u0647\u200C\u0628\u0646\u062F\u06CC "),o(),a(20,"div",10)(21,"select",17)(22,"option",18),c(23,"\u0647\u0645\u0647 \u062F\u0633\u062A\u0647\u200C\u0647\u0627"),o(),g(24,Ue,2,2,"option",19),w(25,"async"),o()()(),g(26,Re,8,2,"div",20),w(27,"async"),a(28,"div",21)(29,"label",15),v(30,"span",22),c(31," \u0645\u062D\u062F\u0648\u062F\u0647 \u0642\u06CC\u0645\u062A (\u062A\u0648\u0645\u0627\u0646) "),o(),a(32,"div",23)(33,"div",10),v(34,"input",24),a(35,"label",25),c(36,"\u0627\u0632"),o()(),a(37,"div",10),v(38,"input",26),a(39,"label",25),c(40,"\u062A\u0627"),o()()()(),a(41,"div",27)(42,"label",28)(43,"span",29),c(44,"\u0641\u0642\u0637 \u06A9\u0627\u0644\u0627\u0647\u0627\u06CC \u0645\u0648\u062C\u0648\u062F"),o(),a(45,"div",30)(46,"input",31),y("change",function(){return x(l),b(r.toggleInStock())}),o(),v(47,"div",32),o()(),a(48,"label",28)(49,"span",29),c(50,"\u0645\u062D\u0635\u0648\u0644\u0627\u062A \u062A\u062E\u0641\u06CC\u0641\u200C\u062F\u0627\u0631"),o(),a(51,"div",30),v(52,"input",33)(53,"div",32),o()()()(),a(54,"button",34),y("click",function(){return x(l),b(r.clearFilters())}),a(55,"span",35),c(56,"clear_all"),o(),c(57," \u067E\u0627\u06A9 \u06A9\u0631\u062F\u0646 \u0641\u06CC\u0644\u062A\u0631\u0647\u0627 "),o()()(),a(58,"main",36)(59,"div",37)(60,"div",38)(61,"div",39)(62,"span",40),c(63,"sort"),o(),a(64,"span",41),c(65,"\u0645\u0631\u062A\u0628\u200C\u0633\u0627\u0632\u06CC:"),o()(),a(66,"div",42),g(67,Be,2,9,"button",43),o()(),g(68,Ge,2,1,"div",44),w(69,"async"),o(),g(70,qe,4,2,"ng-container",45),w(71,"async"),g(72,He,2,2,"ng-template",null,0,j)(74,Ye,2,1,"div",46),w(75,"async"),o()()()}if(i&2){let l,d=O(73);s(3),p("formGroup",r.searchForm),s(19),p("ngValue",null),s(2),p("ngForOf",P(25,10,r.categories$)),s(2),p("ngIf",P(27,12,r.categoryGroups$)),s(20),p("checked",(l=r.searchForm.get("inStock"))==null?null:l.value),s(21),p("ngForOf",r.sortOptions),s(),p("ngIf",P(69,14,r.paginatedResult$)),s(2),p("ngIf",P(71,16,r.products$))("ngIfElse",d),s(4),p("ngIf",P(75,18,r.paginatedResult$))}},dependencies:[J,Q,W,K,Te,Se,Ee,Fe,be,Ie,xe,Ve,he,ye,we,Pe,ve,q],encapsulation:2});let n=u;return n})();function Ze(n,u){if(n&1&&(a(0,"div",35),c(1),o()),n&2){let t=m(2).ngIf,e=m();s(),C(" ",e.getDiscountPercentage(t.selectedVariant),"% ")}}function et(n,u){if(n&1&&(a(0,"span",36),c(1),w(2,"number"),o()),n&2){let t=m(2).ngIf;s(),C(" ",P(2,1,t.selectedVariant==null?null:t.selectedVariant.originalPrice)," ")}}function tt(n,u){if(n&1){let t=I();a(0,"button",44),y("click",function(){let i=x(t).$implicit,r=m(2).$implicit,l=m(3);return b(l.selectAttribute(r.name,i.id))}),o()}if(n&2){let t=u.$implicit,e=m(2).$implicit,i=m(2).ngIf;le("background-color",t.hexCode),A("ring-2",i.selectedAttributes[e.name]===t.id)("ring-primary",i.selectedAttributes[e.name]===t.id)("ring-offset-2",i.selectedAttributes[e.name]===t.id)}}function it(n,u){if(n&1&&(a(0,"div",42),g(1,tt,1,8,"button",43),o()),n&2){let t=m().$implicit;s(),p("ngForOf",t.values)}}function nt(n,u){if(n&1){let t=I();a(0,"button",47),y("click",function(){let i=x(t).$implicit,r=m(2).$implicit,l=m(3);return b(l.selectAttribute(r.name,i.id))}),c(1),o()}if(n&2){let t=u.$implicit,e=m(2).$implicit,i=m(2).ngIf;A("bg-primary",i.selectedAttributes[e.name]===t.id)("text-primary-foreground",i.selectedAttributes[e.name]===t.id)("border-primary",i.selectedAttributes[e.name]===t.id)("bg-background",i.selectedAttributes[e.name]!==t.id)("text-foreground",i.selectedAttributes[e.name]!==t.id)("border-border",i.selectedAttributes[e.name]!==t.id)("hover:border-primary",i.selectedAttributes[e.name]!==t.id),s(),C(" ",t.displayValue," ")}}function rt(n,u){if(n&1&&(a(0,"div",45),g(1,nt,2,15,"button",46),o()),n&2){let t=m().$implicit;s(),p("ngForOf",t.values)}}function ot(n,u){if(n&1&&(a(0,"div",37)(1,"div",38)(2,"span",21),c(3),o(),a(4,"span",39),c(5),o()(),g(6,it,2,1,"div",40)(7,rt,2,1,"div",41),o()),n&2){let t=u.$implicit,e=m(2).ngIf;s(3),$(t.displayName),s(2),$(e.selectedVariant==null||e.selectedVariant.attributes==null||e.selectedVariant.attributes[t.name]==null?null:e.selectedVariant.attributes[t.name].displayValue),s(),p("ngIf",t.name==="color"),s(),p("ngIf",t.name!=="color")}}function at(n,u){if(n&1){let t=I();a(0,"div",48)(1,"button",49),y("click",function(){x(t);let i=m(2).ngIf,r=m();return b(r.increaseQuantity(i.cartItem,i.product,i.selectedVariant))}),c(2," + "),o(),a(3,"span",50),c(4),o(),a(5,"button",49),y("click",function(){x(t);let i=m(2).ngIf,r=m();return b(r.decreaseQuantity(i.cartItem))}),c(6," \u2212 "),o()()}if(n&2){let t=m(2).ngIf;s(),p("disabled",t.isUpdatingCart),s(3),$(t.cartItem.quantity),s(),p("disabled",t.isUpdatingCart)}}function lt(n,u){n&1&&(a(0,"span",55)(1,"span",56),c(2,"add_shopping_cart"),o(),c(3," \u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F "),o())}function ut(n,u){n&1&&(a(0,"span",57),c(1,"sync"),o())}function st(n,u){if(n&1){let t=I();a(0,"div",51)(1,"button",52),y("click",function(){x(t);let i=m(2).ngIf,r=m();return b(r.addToCart(i.product,i.selectedVariant))}),g(2,lt,4,0,"span",53)(3,ut,2,0,"span",54),o()()}if(n&2){let t=m(2).ngIf,e=m();s(),p("disabled",t.isUpdatingCart||!e.isInStock(t.selectedVariant)||!t.selectedVariant),s(),p("ngIf",!t.isUpdatingCart),s(),p("ngIf",t.isUpdatingCart)}}function ct(n,u){n&1&&(a(0,"div",58)(1,"a",59),c(2," \u0645\u0634\u0627\u0647\u062F\u0647 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F "),o()())}function dt(n,u){if(n&1&&(a(0,"div",10)(1,"div",11)(2,"div",12),v(3,"img",13),g(4,Ze,2,1,"div",14),o()(),a(5,"div",15)(6,"div",16)(7,"h1",17),c(8),o(),a(9,"div",18)(10,"div",19)(11,"span",20),c(12,"star"),o(),a(13,"span",21),c(14,"4.8"),o()(),v(15,"span",22),a(16,"div",23),c(17),o()(),a(18,"div",24)(19,"span",25),c(20),w(21,"number"),a(22,"span",26),c(23,"\u062A\u0648\u0645\u0627\u0646"),o()(),g(24,et,3,3,"span",27),o()(),a(25,"div",28),g(26,ot,8,4,"div",29),o(),a(27,"div",30)(28,"div",31),g(29,at,7,3,"div",32)(30,st,4,3,"div",33)(31,ct,3,0,"div",34),o()()()()),n&2){let t=m().ngIf,e=m();s(3),p("src",e.getProductIcon(t.product),ae)("alt",t.product.name),s(),p("ngIf",e.hasDiscount(t.selectedVariant)),s(4),$(t.product.name),s(8),p("ngClass",e.isInStock(t.selectedVariant)?"bg-success/5 text-success border-success/20":"bg-destructive/5 text-destructive border-destructive/20"),s(),C(" ",t.selectedVariant!=null&&t.selectedVariant.isUnlimited?"\u0645\u0648\u062C\u0648\u062F":e.isInStock(t.selectedVariant)?"\u0645\u0648\u062C\u0648\u062F \u062F\u0631 \u0627\u0646\u0628\u0627\u0631":"\u0646\u0627\u0645\u0648\u062C\u0648\u062F"," "),s(3),C(" ",P(21,12,(t.selectedVariant==null?null:t.selectedVariant.sellingPrice)||t.product.minPrice)," "),s(4),p("ngIf",e.hasDiscount(t.selectedVariant)),s(2),p("ngForOf",e.attributeTypes),s(3),p("ngIf",t.cartItem&&t.selectedVariant),s(),p("ngIf",!t.cartItem),s(),p("ngIf",t.cartItem)}}function pt(n,u){if(n&1&&(a(0,"div",3)(1,"nav",4)(2,"a",5),c(3,"\u062E\u0627\u0646\u0647"),o(),a(4,"span",6),c(5,"/"),o(),a(6,"a",7),c(7,"\u0645\u062D\u0635\u0648\u0644\u0627\u062A"),o(),a(8,"span",6),c(9,"/"),o(),a(10,"span",8),c(11),o()(),g(12,dt,32,14,"div",9),o()),n&2){let t=u.ngIf;s(11),$(t.product==null?null:t.product.name),s(),p("ngIf",t.product&&!t.isLoading)}}function mt(n,u){n&1&&(a(0,"div",60)(1,"span",61),c(2,"sync"),o()())}var $e=(()=>{let u=class u{constructor(e,i,r,l,d,f){this.route=e,this.productService=i,this.cartService=r,this.notificationService=l,this.mediaService=d,this.cdr=f,this.destroy$=new N,this.quantityUpdate$=new N,this.state={product:null,selectedVariant:null,selectedAttributes:{},cartItem:null,isLoading:!0,isUpdatingCart:!1,error:null},this.attributeTypes=[]}ngOnInit(){this.vm$=new L(this.state),U([this.route.paramMap,this.cartService.cart$]).pipe(T(([e,i])=>(this.id=e.get("id"),this.updateViewModel({isLoading:!0}),this.productService.getProductById(Number(this.id)).pipe(k(r=>({product:r,cart:i})),D(r=>{let l=r?.error?.message||"\u0645\u062D\u0635\u0648\u0644 \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F.";return this.updateViewModel({isLoading:!1,error:l}),F(null)})))),E(this.destroy$)).subscribe(e=>{if(e){let{product:i,cart:r}=e;this.extractAttributes(i);let l={};this.attributeTypes.forEach(_=>{l[_.name]=_.values[0]?.id||null});let d=this.findVariant(i,l),f=d&&r?.cartItems.find(_=>_.variantId===d.id)||null;this.updateViewModel({product:i,selectedVariant:d,selectedAttributes:l,cartItem:f,isLoading:!1,error:null})}}),this.quantityUpdate$.pipe(R(500),T(({item:e,quantity:i})=>(this.updateViewModel({isUpdatingCart:!0}),this.cartService.updateCartItem(e.id,{quantity:i,rowVersion:e.rowVersion}).pipe(B(()=>this.updateViewModel({isUpdatingCart:!1})),D(()=>F(null))))),E(this.destroy$)).subscribe()}updateViewModel(e){this.state=M(M({},this.state),e),this.vm$.next(this.state),this.cdr.markForCheck()}extractAttributes(e){let i=new Map;e.variants.forEach(r=>{for(let l in r.attributes){let d=r.attributes[l];i.has(d.typeName)||i.set(d.typeName,{id:0,name:d.typeName,displayName:d.typeDisplayName,values:[]});let f=i.get(d.typeName);f.values.some(_=>_.id===d.id)||f.values.push({id:d.id,value:d.value,displayValue:d.displayValue,hexCode:d.hexCode})}}),this.attributeTypes=Array.from(i.values())}findVariant(e,i){return e.variants.find(r=>Object.keys(i).every(l=>{let d=i[l];return d===null?!0:r.attributes[l.toLowerCase()]?.id===d}))||e.variants[0]||null}selectAttribute(e,i){let r=ie(M({},this.state.selectedAttributes),{[e]:i}),l=this.findVariant(this.state.product,r),d=l&&this.cartService.currentCartValue?.cartItems.find(f=>f.variantId===l.id)||null;this.updateViewModel({selectedAttributes:r,selectedVariant:l,cartItem:d})}getProductIcon(e){let r=e.images?.find(l=>l.isPrimary)?.url||e.iconUrl||e.images?.[0]?.url;return this.mediaService.getMediaUrl(r)}hasDiscount(e){return!!e&&e.originalPrice>e.sellingPrice}getDiscountPercentage(e){return e?Math.round((e.originalPrice-e.sellingPrice)/e.originalPrice*100):0}isInStock(e){return!!e&&(e.isUnlimited||e.stock>0)}isStockAvailableForIncrease(e,i){return e.isUnlimited?!0:i?e.stock>i.quantity:e.stock>0}addToCart(e,i){this.updateViewModel({isUpdatingCart:!0});let r=i.rowVersion||i.RowVersion;this.cartService.addToCart({variantId:i.id,quantity:1,variantRowVersion:r}).pipe(B(()=>this.updateViewModel({isUpdatingCart:!1}))).subscribe({error:l=>{l.status===409?(this.notificationService.show("\u0645\u0648\u062C\u0648\u062F\u06CC \u06CC\u0627 \u0642\u06CC\u0645\u062A \u0645\u062D\u0635\u0648\u0644 \u062A\u063A\u06CC\u06CC\u0631 \u06A9\u0631\u062F\u0647 \u0627\u0633\u062A. \u0644\u0637\u0641\u0627 \u062F\u0648\u0628\u0627\u0631\u0647 \u062A\u0644\u0627\u0634 \u06A9\u0646\u06CC\u062F.","info"),this.reloadProduct()):this.notificationService.show(l?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F","error")}})}increaseQuantity(e,i,r){this.isStockAvailableForIncrease(r,e)&&this.quantityUpdate$.next({item:e,quantity:e.quantity+1})}decreaseQuantity(e){e.quantity>1?this.quantityUpdate$.next({item:e,quantity:e.quantity-1}):(this.updateViewModel({isUpdatingCart:!0}),this.cartService.removeFromCart(e.id).pipe(B(()=>this.updateViewModel({isUpdatingCart:!1}))).subscribe())}reloadProduct(){this.updateViewModel({isLoading:!0,error:null}),this.productService.getProductById(Number(this.id)).pipe(E(this.destroy$),D(e=>{let i=e?.error?.message||"\u0645\u062D\u0635\u0648\u0644 \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F.";return this.updateViewModel({isLoading:!1,error:i}),F(null)})).subscribe(e=>{if(e){let i=this.cartService.currentCartValue;this.extractAttributes(e);let r=this.findVariant(e,this.state.selectedAttributes),l=r&&i?.cartItems.find(d=>d.variantId===r.id)||null;this.updateViewModel({product:e,selectedVariant:r,cartItem:l,isLoading:!1})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};u.\u0275fac=function(i){return new(i||u)(h(H),h(X),h(ge),h(me),h(_e),h(z))},u.\u0275cmp=G({type:u,selectors:[["app-product-page"]],inputs:{id:"id"},decls:5,vars:4,consts:[["loadingOrError",""],[1,"min-h-screen","pb-12","bg-background"],["class","container py-8",4,"ngIf","ngIfElse"],[1,"container","py-8"],[1,"flex","items-center","text-sm","text-muted-foreground","mb-8","gap-2"],["routerLink","/",1,"hover:text-foreground","transition-colors"],[1,"text-xs","opacity-50"],["routerLink","/products",1,"hover:text-foreground","transition-colors"],[1,"text-foreground","font-medium","truncate"],["class","grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12",4,"ngIf"],[1,"grid","grid-cols-1","lg:grid-cols-12","gap-8","lg:gap-12"],[1,"lg:col-span-5"],[1,"aspect-square","bg-white","rounded-2xl","border","border-border","p-8","flex","items-center","justify-center","relative","overflow-hidden"],[1,"max-w-full","max-h-full","object-contain","mix-blend-multiply",3,"src","alt"],["class","absolute top-4 left-4 bg-destructive text-white px-3 py-1 rounded text-sm font-bold",4,"ngIf"],[1,"lg:col-span-7","space-y-8"],[1,"border-b","border-border","pb-6","space-y-4"],[1,"text-3xl","font-black","text-foreground"],[1,"flex","items-center","gap-4","text-sm"],[1,"flex","items-center","gap-1","text-yellow-500"],[1,"material-icons","text-lg"],[1,"font-bold","text-foreground"],[1,"w-1","h-1","bg-border","rounded-full"],[1,"px-2.5","py-0.5","rounded","text-xs","font-medium","border",3,"ngClass"],[1,"flex","items-baseline","gap-3","pt-2"],[1,"text-3xl","font-bold","text-foreground"],[1,"text-sm","font-normal","text-muted-foreground"],["class","text-lg text-muted-foreground line-through decoration-destructive/50",4,"ngIf"],[1,"space-y-6"],["class","space-y-3",4,"ngFor","ngForOf"],[1,"fixed","bottom-0","left-0","right-0","p-4","bg-background","border-t","border-border","lg:static","lg:border-none","lg:p-0","lg:bg-transparent","z-20"],[1,"container","lg:px-0","flex","gap-4"],["class","flex items-center border border-border rounded-lg h-12 bg-background",4,"ngIf"],["class","flex-1",4,"ngIf"],["class","flex-1 lg:flex-none",4,"ngIf"],[1,"absolute","top-4","left-4","bg-destructive","text-white","px-3","py-1","rounded","text-sm","font-bold"],[1,"text-lg","text-muted-foreground","line-through","decoration-destructive/50"],[1,"space-y-3"],[1,"flex","justify-between","text-sm"],[1,"text-muted-foreground"],["class","flex flex-wrap gap-3",4,"ngIf"],["class","flex flex-wrap gap-2",4,"ngIf"],[1,"flex","flex-wrap","gap-3"],["class","w-8 h-8 rounded-full border border-border shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all",3,"backgroundColor","ring-2","ring-primary","ring-offset-2","click",4,"ngFor","ngForOf"],[1,"w-8","h-8","rounded-full","border","border-border","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary","transition-all",3,"click"],[1,"flex","flex-wrap","gap-2"],["class","px-4 py-2 rounded-lg text-sm border transition-all focus:outline-none",3,"bg-primary","text-primary-foreground","border-primary","bg-background","text-foreground","border-border","hover:border-primary","click",4,"ngFor","ngForOf"],[1,"px-4","py-2","rounded-lg","text-sm","border","transition-all","focus:outline-none",3,"click"],[1,"flex","items-center","border","border-border","rounded-lg","h-12","bg-background"],[1,"w-12","h-full","flex","items-center","justify-center","text-primary","hover:bg-muted","text-xl","font-bold","transition-colors",3,"click","disabled"],[1,"w-10","text-center","font-bold","text-lg","tabular-nums"],[1,"flex-1"],[1,"btn","btn-primary","btn-lg","w-full","font-bold","text-base",3,"click","disabled"],["class","flex items-center justify-center gap-2",4,"ngIf"],["class","material-icons animate-spin",4,"ngIf"],[1,"flex","items-center","justify-center","gap-2"],[1,"material-icons"],[1,"material-icons","animate-spin"],[1,"flex-1","lg:flex-none"],["routerLink","/cart",1,"btn","btn-outline","btn-lg","w-full","lg:w-auto","font-bold"],[1,"container","py-20","flex","justify-center"],[1,"material-icons","animate-spin","text-muted-foreground","text-4xl"]],template:function(i,r){if(i&1&&(a(0,"div",1),g(1,pt,13,2,"div",2),w(2,"async"),g(3,mt,3,0,"ng-template",null,0,j),o()),i&2){let l=O(4);s(),p("ngIf",P(2,2,r.vm$))("ngIfElse",l)}},dependencies:[J,se,Q,W,K,pe,ke,q,ce],encapsulation:2});let n=u;return n})();var Mt=[{path:"",component:te},{path:"category-group/:groupId",component:te},{path:":id",component:$e}];export{Mt as PRODUCTS_ROUTES};
