import{a as I}from"./chunk-U4BXHFS4.js";import{a as C}from"./chunk-ISFWZGBK.js";import{q as v}from"./chunk-QOTKPPKC.js";import{N as n,S,W as d,g as l,j as c,k as p,z as u}from"./chunk-6VZDFBBI.js";var o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));function x(e,r=0){return(o[e[r+0]]+o[e[r+1]]+o[e[r+2]]+o[e[r+3]]+"-"+o[e[r+4]]+o[e[r+5]]+"-"+o[e[r+6]]+o[e[r+7]]+"-"+o[e[r+8]]+o[e[r+9]]+"-"+o[e[r+10]]+o[e[r+11]]+o[e[r+12]]+o[e[r+13]]+o[e[r+14]]+o[e[r+15]]).toLowerCase()}var m,y=new Uint8Array(16);function h(){if(!m){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");m=crypto.getRandomValues.bind(crypto)}return m(y)}var b=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),f={randomUUID:b};function U(e,r,i){e=e||{};let t=e.random??e.rng?.()??h();if(t.length<16)throw new Error("Random bytes length must be >= 16");if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,r){if(i=i||0,i<0||i+16>r.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let a=0;a<16;++a)r[i+a]=t[a];return r}return x(t)}function w(e,r,i){return f.randomUUID&&!r&&!e?f.randomUUID():U(e,r,i)}var g=w;var J=(()=>{let r=class r{constructor(t,a){this.http=t,this.notificationService=a,this.cartsUrl=`${C.API_URL}Carts`,this.cartItemsUrl=`${this.cartsUrl}/items`,this.cartSubject=new l(null),this.cart$=this.cartSubject.asObservable(),this.cartItemCountSubject=new l(0),this.cartItemCount$=this.cartItemCountSubject.asObservable(),this.loadCartFromStorage()}static getGuestToken(){if(typeof window<"u"){let t=localStorage.getItem("guest_token");return t||(t=g(),localStorage.setItem("guest_token",t)),t}return null}removeGuestToken(){typeof window<"u"&&localStorage.removeItem("guest_token")}loadCartFromStorage(){if(typeof window<"u"){let t=localStorage.getItem("cart");if(t){let a=JSON.parse(t);this.updateCartState(a)}}}saveCartToStorage(t){typeof window<"u"&&(t?localStorage.setItem("cart",JSON.stringify(t)):localStorage.removeItem("cart"))}get currentCartValue(){return this.cartSubject.value}updateCartState(t){this.cartSubject.next(t),this.cartItemCountSubject.next(t?.totalItems??0),this.saveCartToStorage(t)}getMyCart(){return this.http.get(this.cartsUrl).pipe(n(t=>this.updateCartState(t)),u(t=>t.status===404?c(null):c(null)))}addToCart(t){return this.http.post(this.cartItemsUrl,t).pipe(n(a=>{this.updateCartState(a),this.notificationService.show("\u0645\u062D\u0635\u0648\u0644 \u0628\u0647 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F \u0627\u0636\u0627\u0641\u0647 \u0634\u062F","success")}),u(a=>(a.status===409&&a.error?.cart&&this.updateCartState(a.error.cart),p(()=>a))))}updateCartItem(t,a){return this.http.put(`${this.cartItemsUrl}/${t}`,a).pipe(n(s=>{this.updateCartState(s),this.notificationService.show("\u0633\u0628\u062F \u062E\u0631\u06CC\u062F \u0628\u0631\u0648\u0632\u0631\u0633\u0627\u0646\u06CC \u0634\u062F","success")}),u(s=>(s.status===409&&s.error?.cart?this.updateCartState(s.error.cart):this.getMyCart().subscribe(),p(()=>s))))}removeFromCart(t){return this.http.delete(`${this.cartItemsUrl}/${t}`).pipe(n(a=>{this.updateCartState(a),this.notificationService.show("\u06A9\u0627\u0644\u0627 \u0627\u0632 \u0633\u0628\u062F \u062D\u0630\u0641 \u0634\u062F","success")}),u(a=>(this.getMyCart().subscribe(),p(()=>a))))}clearCart(){return this.http.delete(`${this.cartsUrl}/clear`).pipe(n(()=>{this.updateCartState(null)}))}getCartItemsCount(){return this.http.get(`${this.cartsUrl}/items/count`).pipe(n(t=>this.cartItemCountSubject.next(t)),u(()=>(this.cartItemCountSubject.next(0),c(0))))}clearLocalCart(){this.updateCartState(null)}};r.\u0275fac=function(a){return new(a||r)(d(v),d(I))},r.\u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"});let e=r;return e})();export{g as a,J as b};
