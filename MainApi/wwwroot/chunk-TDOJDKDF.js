import{a as C}from"./chunk-VFPNDJXC.js";import{a as w}from"./chunk-WNMS36QR.js";import{k as y,q as U}from"./chunk-LWZJ36Z2.js";import{P as u,U as g,Y as p,g as h,j as m,wa as x,z as s}from"./chunk-7ZDO2SPF.js";var o=[];for(let r=0;r<256;++r)o.push((r+256).toString(16).slice(1));function b(r,t=0){return(o[r[t+0]]+o[r[t+1]]+o[r[t+2]]+o[r[t+3]]+"-"+o[r[t+4]]+o[r[t+5]]+"-"+o[r[t+6]]+o[r[t+7]]+"-"+o[r[t+8]]+o[r[t+9]]+"-"+o[r[t+10]]+o[r[t+11]]+o[r[t+12]]+o[r[t+13]]+o[r[t+14]]+o[r[t+15]]).toLowerCase()}var f,T=new Uint8Array(16);function v(){if(!f){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");f=crypto.getRandomValues.bind(crypto)}return f(T)}var E=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),S={randomUUID:E};function $(r,t,n){r=r||{};let e=r.random??r.rng?.()??v();if(e.length<16)throw new Error("Random bytes length must be >= 16");if(e[6]=e[6]&15|64,e[8]=e[8]&63|128,t){if(n=n||0,n<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let i=0;i<16;++i)t[n+i]=e[i];return t}return b(e)}function R(r,t,n){return S.randomUUID&&!t&&!r?S.randomUUID():$(r,t,n)}var I=R;var Q=(()=>{let t=class t{constructor(e,i,a){this.http=e,this.notificationService=i,this.platformId=a,this.cartsUrl=`${w.API_URL}Carts`,this.cartSubject=new h(null),this.cart$=this.cartSubject.asObservable(),this.cartItemCountSubject=new h(0),this.cartItemCount$=this.cartItemCountSubject.asObservable()}static getGuestToken(){if(typeof window<"u"){let e=localStorage.getItem(t.GUEST_TOKEN_KEY);return e||(e=I(),localStorage.setItem(t.GUEST_TOKEN_KEY,e)),e}return null}removeGuestToken(){y(this.platformId)&&localStorage.removeItem(t.GUEST_TOKEN_KEY)}get currentCartValue(){return this.cartSubject.value}getMyCart(){return this.http.get(this.cartsUrl).pipe(u(e=>this.updateCartState(e)),s(()=>(this.updateCartState(null),m(null))))}addToCart(e,i,a,c){t.getGuestToken();let l;return typeof e=="object"?l=e:l={variantId:e,quantity:i,variantRowVersion:a,cartItemRowVersion:c},this.http.post(`${this.cartsUrl}/items`,l).pipe(u(d=>{this.updateCartState(d),this.notificationService.show("\u0645\u062D\u0635\u0648\u0644 \u0628\u0647 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F \u0627\u0636\u0627\u0641\u0647 \u0634\u062F","success")}),s(d=>{let j=d?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0627\u0641\u0632\u0648\u062F\u0646 \u0628\u0647 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F";return this.notificationService.show(j,"error"),m(null)}))}addItem(e,i,a,c){return this.addToCart(e,i,a,c)}updateItem(e,i,a){return this.updateCartItem(e,{quantity:i,rowVersion:a})}updateCartItem(e,i){return this.http.put(`${this.cartsUrl}/items/${e}`,i).pipe(u(a=>this.updateCartState(a)),s(a=>{throw this.notificationService.show(a?.error?.message||"\u062E\u0637\u0627 \u062F\u0631 \u0648\u06CC\u0631\u0627\u06CC\u0634 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F","error"),a}))}removeItem(e){return this.removeFromCart(e)}removeFromCart(e){return this.http.delete(`${this.cartsUrl}/items/${e}`).pipe(u(i=>{this.updateCartState(i),this.notificationService.show("\u0645\u062D\u0635\u0648\u0644 \u0627\u0632 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F \u062D\u0630\u0641 \u0634\u062F","success")}),s(i=>{throw this.notificationService.show("\u062E\u0637\u0627 \u062F\u0631 \u062D\u0630\u0641 \u0645\u062D\u0635\u0648\u0644","error"),i}))}clearCart(){return this.http.delete(`${this.cartsUrl}/clear`).pipe(u(()=>{this.updateCartState(null),this.notificationService.show("\u0633\u0628\u062F \u062E\u0631\u06CC\u062F \u062E\u0627\u0644\u06CC \u0634\u062F","success")}),s(()=>(this.notificationService.show("\u062E\u0637\u0627 \u062F\u0631 \u062E\u0627\u0644\u06CC \u06A9\u0631\u062F\u0646 \u0633\u0628\u062F \u062E\u0631\u06CC\u062F","error"),m(void 0))))}getCartItemsCount(){return this.http.get(`${this.cartsUrl}/items/count`).pipe(u(e=>this.cartItemCountSubject.next(e)),s(()=>m(0)))}clearLocalCart(){this.cartSubject.next(null),this.cartItemCountSubject.next(0)}updateCartState(e){this.cartSubject.next(e);let i=e?.cartItems?.reduce((a,c)=>a+c.quantity,0)??0;this.cartItemCountSubject.next(i)}};t.GUEST_TOKEN_KEY="guest_token",t.\u0275fac=function(i){return new(i||t)(p(U),p(C),p(x))},t.\u0275prov=g({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();export{I as a,Q as b};
